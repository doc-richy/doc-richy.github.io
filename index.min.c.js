import{game}from"./library/engine.js";import*as scene from"./library/level.js";import*as moveModule from"./library/move.js";import"./typedef.js";let main=document.getElementById("main"),infoDiv=document.getElementById("infodiv"),infoIframe=document.getElementById("infoframe"),std={scaleCanvas:1,scaleX:1,scaleY:2,boxSize:90,boxViewQuantity:12,scaleFactor:()=>std.boxSize/512,quota:void 0},gameInfo={t:0,s:0,b:-1},gameInfoLast={t:0,bt:-1,s:0,bs:-1,b:-1,bb:-1},dataSave=[],data=void 0,isSaved=!1,isExit=!1,fromOpen=!1,fromSave=!1,btn_1=document.getElementById("btn-1"),btn_2=document.getElementById("btn-2"),menu=document.getElementsByClassName("floating-menu")[0],btn_2_hideS_up,btn_2_hideS_over,btn_2_showS_up,btn_2_showS_over,isSoundOn=!1,gameWidth=1920,gameHeight=1080,cellWidth=90,cellHeight=90,gridWidth=12,gridHeight=12,stepWidth=64,scaleButton=.2,scalePad=.75,estimateKeyboard=[[{s:70,t:15.93,csec:15930},{s:106,t:80.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}],[{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}],[{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}]],estimateCell=[[{s:65,t:1918.02},{s:76,t:80.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}],[{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}],[{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}]],music,bounceSound,message,titleScene,title,playButton,infoButton,menuShow,menuHide,fullscreenState,levelInfoBox,levelMsg,levelUpButton,levelDownButton,levelInfoBoxGroup,sceneInfoBox,sceneMsg,sceneUpButton,sceneDownButton,sceneInfoBoxGroup,blocks,arrayImages,img1,gameScene,img2,img3,blocksImg_12,blocksImg_14,blocksImg_16,infoBox1,msgGroup,msg11,msg21,msg31,MsgInfo,MsgInfo1,MsgInfo2,homeButton,restartButton,saveToDiskButton,pauseButton,pauseOnButton,saveButton,saveInButton,saveOutButton,saveGroup,saveOkCancelGroup,saveMsgGroup,saveImgBorder,saveImgInBorder,saveMsg_1,saveMsg_2,saveMsg_3,saveMsg_4,saveMsg_5,saveMsg_6,saveMsg_11,saveMsg_21,saveMsg_31,saveOkButton,saveCancelButton,infoGameButton,infoBox1Group,infoBox2,msgGroup2,infoBox2Group,infoBox3,infoBox3Group,infoBox4,msg41,sceneMsgDim=["12x12","14x14","16x16"],msg42,infoBox4Group,groupInfo,secondPage,infoGamePNG,infoGameMsg,infoGameGroup,yo={},walk=[],stepArray=[],scenePlaying=1,levelPlaying=1,levelToPlay=scene.level[scenePlaying-1][levelPlaying-1],scaleAllButtons=1,scaleText=1,intervalId=setInterval(()=>g.progressBar.update(),5),padDimension=(document.addEventListener("myProper",e=>console.log("From my proper ",e.text)),512),padArray=[],buttonsMoveArr=[],buttonsToShowHide=[],pad_1_group,pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_group,pad_2_up,pad_2_down,pad_2_right,pad_2_left,isMobile=/Mobile/i.test(navigator.userAgent),pixelRatio=window.devicePixelRatio.toFixed(2),isTouch=!1,g=(("ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints||"ontouchstart"in document.documentElement||"touchstart"in document.documentElement)&&(isTouch=!0),isMobile&&(scaleText=3.5<=pixelRatio&&pixelRatio<=4.2?scaleAllButtons=1.2:2.8<=pixelRatio&&pixelRatio<3.5?(scaleAllButtons=1.5,1.2):(scaleAllButtons=1.6,1.5)),new game(gameWidth,gameHeight,setup,["images/walk_512.json","images/info_box.png","images/info_level_box.png","images/view_420x1080.png","images/blocksBorder_12x12.png","images/blocksBorder_14x14.png","images/blocksBorder_16x16.png","images/b_info_up.png","images/b_info_over.png","images/b_scene_up.png","images/b_scene_over.png","images/b_scene_top_up.png","images/b_scene_top_over.png","images/b_play_up.png","images/b_play_over.png","images/infogame.png","images/yo_level_512.png","images/save_img.png","images/save_img_in.png","images/save_ok_512_up.png","images/save_ok_512_over.png","images/save_cancel_512_up.png","images/save_cancel_512_over.png","images/save_512_up.png","images/save_512_over.png","images/save_512_in_up.png","images/save_512_in_over.png","images/save_512_out_up.png","images/save_512_out_over.png","images/infogame_512_up.png","images/infogame_512_over.png","images/restart_512_up.png","images/restart_512_over.png","images/pause_512_up.png","images/pause_512_over.png","images/pause_on_512_up.png","images/pause_on_512_over.png","images/home_512_up.png","images/home_512_over.png","images/menu_512_up.png","images/menu_512_over.png","images/menu_open_512_up.png","images/menu_open_512_over.png","images/road_512.png","images/forest_512.png","images/forest.png","images/forest24.jpg","images/box_512.png","images/bananas_0_512.png","images/bananas_512_neutral.png","images/fond_ecran_950.jpg","images/emoji_yo.png","sounds/bounce.wav","sounds/music.wav","fonts/puzzler.otf","images/pad_512_up_up.png","images/pad_512_up_over.png","images/pad_512_down_up.png","images/pad_512_down_over.png","images/pad_512_right_up.png","images/pad_512_right_over.png","images/pad_512_left_up.png","images/pad_512_left_over.png","images/step_512_neutral.png","images/time_512_neutral.png","images/fullscreen_on_512_up.png","images/fullscreen_on_512_over.png","images/fullscreen_off_512_up.png","images/fullscreen_off_512_over.png","images/sound_yes_240_up.png","images/sound_yes_240_over.png","images/sound_no_240_up.png","images/sound_no_240_over.png","images/b_about_up_128.png","images/b_about_over_128.png"],load)),leftArrow=(main.appendChild(g.canvas),window.infoHide=event=>{infoDiv.classList.remove("show"),infoDiv.classList.add("hide")},window.about=event=>{infoIframe.src="./html_page/about.html"},window.general=event=>{infoIframe.src="./html_page/general.html"},window.buttonsExplained=event=>{infoIframe.src="./html_page/buttonsexplained.html"},window.spareButton=event=>{infoIframe.src="./html_page/sparebutton.html"},g.keyboard(37)),upArrow=g.keyboard(38),rightArrow=g.keyboard(39),downArrow=g.keyboard(40),keyboard={leftArrow:leftArrow,upArrow:upArrow,rightArrow:rightArrow,downArrow:downArrow};function load(){0===g.progressBar.counter&&(g.progressBar.setBackgroundColor("#FFA80F"),g.progressBar.setForegroundColor("#FFEC4B"),g.progressBar.create(g.canvas,g.assets,g.canvas.width/2,100)),g.progressBar.update()}function setup(){g.progressBar.remove(),clearInterval(intervalId),createButtonMenu(),arrayImages=[g.assets["walkDownRight.png"],g.assets["images/road_512.png"],g.assets["images/forest_512.png"],g.assets["images/box_512.png"],g.assets["images/bananas_0_512.png"],g.assets["walkUpRight.png"],g.assets["walkUpLeft.png"],g.assets["walkUpRightPush.png"],g.assets["walkUpLeftPush.png"],g.assets["walkDownRight.png"],g.assets["walkDownLeft.png"],g.assets["walkDownRightPush.png"],g.assets["walkDownLeftPush.png"],g.assets["walkRightRight.png"],g.assets["walkRightLeft.png"],g.assets["walkRightRightPush.png"],g.assets["walkRightLeftPush.png"],g.assets["walkLeftRight.png"],g.assets["walkLeftLeft.png"],g.assets["walkLeftRightPush.png"],g.assets["walkLeftLeftPush.png"]],yo.setVisible=()=>{walk.forEach(pose=>{pose===yo.activeSprite?pose.visible=!0:(pose.visible=!1,pose.gridX=-10,pose.gridY=-10)})},yo.layer=3,yo.bananasToEat=0,yo.move=moveModule.moveScene,initialiseMusic(),buildFirstPage(),buildGroupInfo1(),setFirstTime(1,1),buildSaveGoup(),updateCSSVariables(),rightArrow.press=()=>{yo.move("right",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"r"})},upArrow.press=()=>{yo.move("up",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"u"})},leftArrow.press=()=>{yo.move("left",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"l"})},downArrow.press=()=>{yo.move("down",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"d"})},buttonsMoveArr=[upArrow,downArrow,rightArrow,leftArrow,pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_up,pad_2_down,pad_2_right,pad_2_left],g.setButtonsMove(buttonsMoveArr,pauseButton)}function play(){0===yo.bananasToEat&&(g.pause(),g.endGame(),g.wait(1e3).then(()=>end()))}function end(){music.volume=.3,updateGameInfo("end")}function homePress(){MsgInfo.visible=!0,MsgInfo1.visible=!0,MsgInfo2.visible=!0,infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(pad=>pad.interactive=!0)),resetAllParameters(scenePlaying,levelPlaying,"homePress"),updateFirstPage(scenePlaying,levelPlaying),g.slide(secondPage,-g.canvas.width,g.canvas.height,30,["decelerationCubed"]).onComplete=()=>{updatePolygonPoinst()},g.slide(titleScene,0,0,30,["decelerationCubed"]),g.endGame()}function stopAllPressed(){0!==gameInfo.t&&g.isPlaying?(pauseButton.visible?(g.pause(),pauseButton.visible=!1,pauseOnButton.visible=!0):(g.resume(),pauseButton.visible=!0,pauseOnButton.visible=!1),resetAllParameters(scenePlaying,levelPlaying,"restart"),g.slide(secondPage,0,0,30,["decelerationCubed"]),g.state=play):(pauseButton.visible=!0,pauseOnButton.visible=!1)}function restart(){resetAllParameters(scenePlaying,levelPlaying,"restart"),g.slide(secondPage,0,0,30,["decelerationCubed"]),g.state=play}function menuShowPress(){if(infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(pad=>pad.interactive=!0)),menuShow.visible){menuShow.visible=!1,menuHide.visible=!0,g.fadeIn(menuHide,30);g.fadeOut(menuShow,30);menu.classList.remove("hide"),menu.classList.add("show")}else{menuShow.visible=!0,menuHide.visible=!1,g.fadeIn(menuShow,30);g.fadeOut(menuHide,30);menu.classList.remove("show"),menu.classList.add("hide")}}function savePress(){infoGameGroup.visible&&(infoGameGroup.visible=!1),updateSaveGoup(),g.slide(saveGroup,.5*g.canvas.width-380,.5*g.canvas.height-256,30)}function pausePressed(){10<gameInfo.t&&(g.isPlaying?g.pause():g.resume()),pauseButton.visible?(pauseButton.visible=!1,pauseOnButton.visible=!0,setTimeout(()=>{pauseButton.interactive=!1,pauseOnButton.interactive=!0,buttonsToShowHide.forEach((btn,i)=>{i<=2?(btn.visible=!0,btn.interactive=!0):btn.visible=!0})},200)):(pauseButton.visible=!0,pauseOnButton.visible=!1,setTimeout(()=>{pauseButton.interactive=!0,pauseOnButton.interactive=!1,buttonsToShowHide.forEach((btn,i)=>{i<=2?(btn.visible=!1,btn.interactive=!1):btn.visible=!1})},200))}function home(){resetAllParameters(scenePlaying,levelPlaying,"home"),updateFirstPage(scenePlaying,levelPlaying),g.slide(secondPage,-g.canvas.width,g.canvas.height,30,["decelerationCubed"]),g.slide(titleScene,0,0,30,["decelerationCubed"]),g.endGame(),end()}function resetAllParameters(sceneToSet,levelToSet,from){if(sceneToSet<1&&4<sceneToSet)throw new Error(`This level : ${sceneToSet} is not developped yet.`);if(1===sceneToSet){if(levelToSet<1&&9<levelToSet)throw new Error(`This level : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=12}else if(2===sceneToSet){if(levelToSet<1&&9<levelToSet)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=14}else{if(3!==sceneToSet)throw new Error(`This scene : ${sceneToSet} is not developped yet.`);if(levelToSet<1&&9<levelToSet)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=16}if(levelToPlay=scene.level[sceneToSet-1][levelToSet-1],levelPlaying=levelToSet,scenePlaying=sceneToSet,saveGameInfoLast(),gameScene.remove(blocks),yo.bananasToEat=0,blocks=g.gridSpecial(gridWidth,gridHeight,cellWidth,cellHeight,levelToPlay,arrayImages,yo,walk,std.scaleFactor(),!1,0,0),yo.activeSprite=walk[4],yo.setVisible(),(stepArray=[]).push({x:yo.activeSprite.gridX,y:yo.activeSprite.gridY,d:"s"}),g.setYo(yo),g.setStepArray(stepArray),updateGameInfo("resetAll"),gameInfo.t=0,gameInfo.s=0,gameInfo.b=yo.bananasToEat,g.setGameInfo(gameInfo),updateGameInfoMsgs(),1===scenePlaying)blocksImg_12.visible=!0,blocksImg_14.visible=!1,blocksImg_16.visible=!1,blocks.addChild(blocksImg_12);else if(2===scenePlaying)blocksImg_12.visible=!1,blocksImg_14.visible=!0,blocksImg_16.visible=!1,blocks.addChild(blocksImg_14);else{if(3!==scenePlaying)throw new Error(`Scene playing : ${scenePlaying} not possible.`);blocksImg_12.visible=!1,blocksImg_14.visible=!1,blocksImg_16.visible=!0,blocks.addChild(blocksImg_16)}gameScene.addChild(blocks),moveModule.setScene(sceneToSet,std),msg11.content=" "+(stepArray.length-1),msg31.content=" "+yo.bananasToEat,menu.classList.contains("show")&&menuShow.press()}function setFirstTime(sceneToSet,levelToSet){if(sceneToSet<1&&3<sceneToSet)throw new Error(`This level : ${sceneToSet} is not developped yet.`);if(1===sceneToSet){if(levelToSet<1&&9<levelToSet)throw new Error(`This level : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=12}else if(2===sceneToSet){if(levelToSet<1&&9<levelToSet)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=14}else{if(3!==sceneToSet)throw new Error(`This scene : ${sceneToSet} is not developped yet.`);if(levelToSet<1&&9<levelToSet)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=16}if(levelToPlay=scene.level[sceneToSet-1][levelToSet-1],levelPlaying=levelToSet,scenePlaying=sceneToSet,blocks=g.gridSpecial(gridWidth,gridHeight,cellWidth,cellHeight,levelToPlay,arrayImages,yo,walk,std.scaleFactor(),!1,0,0),yo.activeSprite=walk[4],yo.setVisible(),stepArray=[],g.setYo(yo),g.setStepArray(stepArray),gameInfo.b=yo.bananasToEat,g.setGameInfo(gameInfo),(img1=g.sprite(g.assets["images/forest24.jpg"])).layer=-1,img1.pivotX=0,img1.pivotY=0,blocksImg_12=g.sprite(g.assets["images/blocksBorder_12x12.png"]),blocksImg_14=g.sprite(g.assets["images/blocksBorder_14x14.png"]),blocksImg_16=g.sprite(g.assets["images/blocksBorder_16x16.png"]),blocksImg_12.layer=blocksImg_14.layer=blocksImg_16.layer=4,1===scenePlaying)blocksImg_12.visible=!0,blocksImg_14.visible=!1,blocksImg_16.visible=!1,blocks.addChild(blocksImg_12);else if(2===scenePlaying)blocksImg_12.visible=!1,blocksImg_14.visible=!0,blocksImg_16.visible=!1,blocks.addChild(blocksImg_14);else{if(3!==scenePlaying)throw new Error(`Scene playing : ${scenePlaying} not possible.`);blocksImg_12.visible=!1,blocksImg_14.visible=!1,blocksImg_16.visible=!0,blocks.addChild(blocksImg_16)}(gameScene=g.group(img1,blocks)).x=420,gameScene.layer=2,(secondPage=g.group(gameScene,groupInfo)).x=-g.canvas.width,secondPage.y=g.canvas.height,secondPage.layer=-1,updatePolygonPoinst(),moveModule.setScene(sceneToSet,std),menuShowPress()}function initialiseMusic(){bounceSound=g.assets["sounds/bounce.wav"],(music=g.assets["sounds/music.wav"]).loop=!0}function buildFirstPage(){(MsgInfo=g.text("First","40px puzzler","deepskyblue")).y=g.canvas.height-135,(MsgInfo1=g.text("First","40px puzzler","deepskyblue")).y=g.canvas.height-90,(MsgInfo2=g.text("First","40px puzzler","deepskyblue")).y=g.canvas.height-45;(title=g.sprite(g.assets["images/fond_ecran_950.jpg"])).x=(g.canvas.width-title.width)/2,title.y=(g.canvas.height-title.height)/2,scenePlaying=scenePlaying||1,levelPlaying=levelPlaying||1;(menuHide=g.button([g.assets["images/menu_open_512_up.png"],g.assets["images/menu_open_512_over.png"],g.assets["images/menu_open_512_up.png"]])).x=10,menuHide.y=10,menuHide.pivotX=0,menuHide.pivotY=0,menuHide.scaleX=scaleButton,menuHide.scaleY=scaleButton,menuHide.layer=20,menuHide.visible=!1,menuHide.interactive=!1,(menuShow=g.button([g.assets["images/menu_512_up.png"],g.assets["images/menu_512_over.png"],g.assets["images/menu_512_up.png"]])).x=10,menuShow.y=10,menuShow.pivotX=0,menuShow.pivotY=0,menuShow.scaleX=scaleButton,menuShow.scaleY=scaleButton,menuShow.layer=20,menuShow.press=()=>menuShowPress(),sceneInfoBox=g.sprite(g.assets["images/info_level_box.png"]),(sceneMsg=g.text("12x12","50px puzzler","black",20,40)).content=sceneMsgDim[scenePlaying-1],sceneMsg.x=sceneInfoBox.width/4,sceneMsg.y=sceneInfoBox.height/2-25,(sceneUpButton=g.button([g.assets["images/b_scene_top_up.png"],g.assets["images/b_scene_top_over.png"],g.assets["images/b_scene_top_up.png"]])).x=sceneInfoBox.width/2-sceneUpButton.width/2,sceneUpButton.y=sceneInfoBox.height/4-sceneUpButton.height/2,sceneUpButton.press=()=>{scenePlaying<3&&(resetAllParameters(scenePlaying+=1,levelPlaying,"scenePress"),g.slide(sceneMsg,sceneMsg.x,sceneMsg.y-40,10,["smoothstep"]),g.fadeOut(sceneMsg,10),setTimeout(()=>{sceneMsg.content=sceneMsgDim[scenePlaying-1],sceneMsg.y+=80,g.slide(sceneMsg,sceneMsg.x,sceneInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(sceneMsg,15)},100))},(sceneDownButton=g.button([g.assets["images/b_scene_up.png"],g.assets["images/b_scene_over.png"],g.assets["images/b_scene_up.png"]])).x=sceneInfoBox.width/2-sceneDownButton.width/2,sceneDownButton.y=3*sceneInfoBox.height/4-sceneUpButton.height/2,sceneDownButton.press=()=>{1<scenePlaying&&(resetAllParameters(--scenePlaying,levelPlaying,"scenePress"),g.slide(sceneMsg,sceneMsg.x,sceneMsg.y+40,10,["smoothstep"]),g.fadeOut(sceneMsg,10),setTimeout(()=>{sceneMsg.content=sceneMsgDim[scenePlaying-1],sceneMsg.y-=80,g.slide(sceneMsg,sceneMsg.x,sceneInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(sceneMsg,15)},200))},(sceneInfoBoxGroup=g.group(sceneInfoBox,sceneMsg,sceneUpButton,sceneDownButton)).x=-g.canvas.width,sceneInfoBoxGroup.y=-g.canvas.height,levelInfoBox=g.sprite(g.assets["images/info_level_box.png"]),(levelMsg=g.text("Level "+levelPlaying,"50px puzzler","black",20,40)).x=sceneInfoBox.width/4,levelMsg.y=sceneInfoBox.height/2-25,(levelUpButton=g.button([g.assets["images/b_scene_top_up.png"],g.assets["images/b_scene_top_over.png"],g.assets["images/b_scene_top_up.png"]])).press=()=>{levelPlaying<9&&(levelPlaying+=1,resetAllParameters(scenePlaying,levelPlaying,"levelPress"),g.slide(levelMsg,levelMsg.x,levelMsg.y-40,10,["smoothstep"]),g.fadeOut(levelMsg,10),setTimeout(()=>{levelMsg.content="Level "+levelPlaying,levelMsg.y+=80,g.slide(levelMsg,levelMsg.x,levelInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(levelMsg,15)},100))},levelUpButton.x=levelInfoBox.width/2-levelUpButton.width/2,levelUpButton.y=levelInfoBox.height/4-levelUpButton.height/2,(levelDownButton=g.button([g.assets["images/b_scene_up.png"],g.assets["images/b_scene_over.png"],g.assets["images/b_scene_up.png"]])).x=levelInfoBox.width/2-levelDownButton.width/2,levelDownButton.y=3*levelInfoBox.height/4-levelUpButton.height/2,levelDownButton.press=()=>{1<levelPlaying&&(--levelPlaying,resetAllParameters(scenePlaying,levelPlaying,"levelPress"),g.slide(levelMsg,levelMsg.x,levelMsg.y+40,10,["smoothstep"]),g.fadeOut(levelMsg,10),setTimeout(()=>{levelMsg.content="Level "+levelPlaying,levelMsg.y-=80,g.slide(levelMsg,levelMsg.x,levelInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(levelMsg,15)},100))},levelMsg.y=levelInfoBox.height/2-25,(levelInfoBoxGroup=g.group(levelInfoBox,levelMsg,levelUpButton,levelDownButton)).x=g.canvas.width,levelInfoBoxGroup.y=-g.canvas.height,(infoButton=g.button([g.assets["images/b_info_up.png"],g.assets["images/b_info_over.png"],g.assets["images/b_info_up.png"]])).x=(g.canvas.width-title.width)/4-.5*infoButton.width*scaleAllButtons/2,infoButton.y=gameHeight-infoButton.width,infoButton.scaleX=.5*scaleAllButtons,infoButton.scaleY=.5*scaleAllButtons,infoButton.press=()=>{let s=g.rectangle(10,10,"#F7E9B8");s.pivotX=0,s.pivotY=0,s.x=infoButton.x+infoButton.width/2,s.y=infoButton.y+infoButton.height/2;var tween1=g.slide(s,s.x,100,30);g.tweenProperty(s,"scaleX",s.scaleX,180,30),g.tweenProperty(s,"scaleY",s.scaleY,80,30);tween1.onComplete=()=>{infoDiv.classList.remove("hide"),infoDiv.classList.add("show"),updateInfoIframe(),g.remove(s)}},(playButton=g.button([g.assets["images/b_play_up.png"],g.assets["images/b_play_over.png"],g.assets["images/b_play_up.png"]])).x=gameWidth,playButton.y=gameHeight,playButton.scaleX=scaleAllButtons,playButton.scaleY=scaleAllButtons,playButton.press=()=>{MsgInfo.visible=!1,MsgInfo1.visible=!1,MsgInfo2.visible=!1,g.slide(titleScene,g.canvas.width,g.canvas.height,30,["decelerationCubed"]),g.slide(secondPage,0,0,30,["decelerationCubed"]).onComplete=()=>{updatePolygonPoinst()},scenePlaying=scenePlaying||1,levelPlaying=levelPlaying||1,sceneMsg.content=sceneMsgDim[scenePlaying-1],levelMsg.content="Level "+levelPlaying,resetAllParameters(scenePlaying,levelPlaying,"playPress"),updateFirstPage(scenePlaying,levelPlaying),g.state=play},g.slide(playButton,g.canvas.width-(g.canvas.width-title.width)/4-playButton.width/2,.75*g.canvas.height-playButton.width/2,30,["decelerationCubed"]),g.slide(sceneInfoBoxGroup,(g.canvas.width-title.width)/4-sceneInfoBoxGroup.width/2,title.y+sceneInfoBoxGroup.height/2,30,["decelerationCubed"]),g.slide(levelInfoBoxGroup,g.canvas.width-(g.canvas.width-title.width)/4-levelInfoBoxGroup.width/2,title.y+levelInfoBoxGroup.height/2,30,["decelerationCubed"]),titleScene=g.group(title,infoButton,playButton,levelInfoBoxGroup,sceneInfoBoxGroup,menuShow,menuHide)}function updateFirstPage(scene,level){scenePlaying=scene,levelPlaying=level,sceneMsg.content=sceneMsgDim[scenePlaying-1],levelMsg.content="Level "+levelPlaying}function updateMsgInfo(){MsgInfo.layer=100,MsgInfo1.layer=100,MsgInfo2.layer=100,MsgInfo.content=`is_M=${isMobile} & is_T=${isTouch} | DPI=${pixelRatio} `,MsgInfo1.content=`WA=${window.screen.availWidth},HA=`+window.screen.availHeight,MsgInfo1.content+=` | WW=${window.innerWidth},WH=`+window.innerHeight,MsgInfo1.content+=` | VW=${visualViewport.width},VH=`+visualViewport.height,MsgInfo2.content=`S_C=${std.scaleCanvas.toFixed(2)} & S_X= ${std.scaleX.toFixed(2)} & S_Y= `+std.scaleY.toFixed(2)}function buildGroupInfo1(){infoGamePNG=g.sprite(g.assets["images/infogame.png"]),infoGameGroup=g.group(infoGamePNG);var fontMsg="60px puzzler";(infoGameMsg=[[g.text("First",fontMsg,"black",355,337),g.text("First",fontMsg,"black",621,337),g.text("First",fontMsg,"black",789,337),g.text("First",fontMsg,"black",1077,337),g.text("First",fontMsg,"black",1240,337),g.text("First",fontMsg,"black",1489,337),g.text("First",fontMsg,"black",1656,337)],[g.text("First",fontMsg,"black",355,564),g.text("First",fontMsg,"black",621,564),g.text("First",fontMsg,"black",789,564),g.text("First",fontMsg,"black",1077,564),g.text("First",fontMsg,"black",1240,564),g.text("First",fontMsg,"black",1489,564),g.text("First",fontMsg,"black",1656,564)],[g.text("First",fontMsg,"black",355,786),g.text("First",fontMsg,"black",621,786),g.text("First",fontMsg,"black",789,786),g.text("First",fontMsg,"black",1077,786),g.text("First",fontMsg,"black",1240,786),g.text("First",fontMsg,"black",1489,786),g.text("First",fontMsg,"black",1656,786)]]).forEach(msg=>{msg.forEach(m=>{m.pivotX=m.pivotY=.5})}),infoGameMsg[0][0].content="23.82",infoGameMsg[0][1].content="=";for(let i=0;i<3;i++)for(let j=0;j<7;j++)infoGameGroup.add(infoGameMsg[i][j]);infoGameGroup.visible=!1,infoGameGroup.x=(g.canvas.width-1888)/2,infoGameGroup.y=menuShow.y+menuShow.height*scaleButton+10,(homeButton=g.button([g.assets["images/home_512_up.png"],g.assets["images/home_512_over.png"],g.assets["images/home_512_up.png"]])).press=()=>homePress(),homeButton.x=g.canvas.width-1.1*homeButton.width*scaleButton,homeButton.y=10,homeButton.scaleX=scaleButton,homeButton.scaleY=scaleButton,(infoGameButton=g.button([g.assets["images/infogame_512_up.png"],g.assets["images/infogame_512_over.png"],g.assets["images/infogame_512_up.png"]])).press=()=>{infoGameGroup.visible?(infoGameGroup.visible=!1,padArray.forEach(pad=>pad.interactive=!0)):(infoGameGroup.visible=!0,updateGameInfo("infoBtn"),padArray.forEach(pad=>pad.interactive=!1))},infoGameButton.x=homeButton.x-1.1*infoGameButton.width*scaleButton,infoGameButton.y=10,infoGameButton.scaleX=scaleButton,infoGameButton.scaleY=scaleButton,infoGameButton.visible=!1,infoGameButton.interactive=!1,buttonsToShowHide.push(infoGameButton),(pauseButton=g.button([g.assets["images/pause_512_up.png"],g.assets["images/pause_512_over.png"],g.assets["images/pause_512_up.png"]])).press=()=>pausePressed(),infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(pad=>pad.interactive=!0)),pauseButton.x=menuShow.x,pauseButton.y=10,pauseButton.scaleX=scaleButton,pauseButton.scaleY=scaleButton,(pauseOnButton=g.button([g.assets["images/pause_on_512_up.png"],g.assets["images/pause_on_512_over.png"],g.assets["images/pause_on_512_up.png"]])).press=()=>pausePressed(),infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(pad=>pad.interactive=!0)),pauseOnButton.x=menuShow.x,pauseOnButton.y=10,pauseOnButton.scaleX=scaleButton,pauseOnButton.scaleY=scaleButton,pauseOnButton.visible=!1,pauseOnButton.interactive=!1,(restartButton=g.button([g.assets["images/restart_512_up.png"],g.assets["images/restart_512_over.png"],g.assets["images/restart_512_up.png"]])).press=()=>{infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(pad=>pad.interactive=!0)),restart()},restartButton.x=menuShow.x+1.1*menuShow.width*scaleButton,restartButton.y=10,restartButton.scaleX=scaleButton,restartButton.scaleY=scaleButton,restartButton.visible=!1,restartButton.interactive=!1,buttonsToShowHide.push(restartButton),(saveButton=g.button([g.assets["images/save_512_up.png"],g.assets["images/save_512_over.png"],g.assets["images/save_512_up.png"]])).press=()=>savePress(),saveButton.x=restartButton.x+1.1*saveButton.width*scaleButton,saveButton.y=10,saveButton.scaleX=scaleButton,saveButton.scaleY=scaleButton,saveButton.visible=!1,saveButton.interactive=!1,buttonsToShowHide.push(saveButton),(saveToDiskButton=g.button([g.assets["images/b_about_up_128.png"],g.assets["images/b_about_over_128.png"],g.assets["images/b_about_up_128.png"]])).press=()=>saveToDisk(),saveToDiskButton.x=restartButton.x,saveToDiskButton.y=g.canvas.height-saveToDiskButton.height-10,img2=g.sprite(g.assets["images/view_420x1080.png"]),(img3=g.sprite(g.assets["images/view_420x1080.png"])).x=1500,(infoBox1=g.sprite(g.assets["images/step_512_neutral.png"])).x=0,infoBox1.y=0,infoBox1.scaleX=scaleButton,infoBox1.scaleY=scaleButton,(msg11=g.text(" : "+(stepArray.length-1),"60px puzzler","black")).x=infoBox1.width*scaleButton+10,msg11.y=infoBox1.height*scaleButton/2-30,msg11.pivotX=0,msg11.pivotY=0,msg11.scaleX=scaleText,msg11.scaleY=scaleText,g.pushMessage(msg11),(infoBox2=g.sprite(g.assets["images/time_512_neutral.png"])).x=0,infoBox2.y=0,infoBox2.scaleX=scaleButton,infoBox2.scaleY=scaleButton,(msg21=g.text(" : ","60px puzzler","black")).x=infoBox2.width*scaleButton+10,msg21.y=infoBox2.height*scaleButton/2-30,msg21.pivotX=0,msg21.pivotY=0,msg21.scaleX=scaleText,msg21.scaleY=scaleText,g.pushMessage(msg21),(infoBox3=g.sprite(g.assets["images/bananas_512_neutral.png"])).x=0,infoBox3.y=0,infoBox3.scaleX=scaleButton,infoBox3.scaleY=scaleButton,(msg31=g.text(" : "+yo.bananasToEat,"60px puzzler","black")).x=infoBox3.width*scaleButton+10,msg31.y=infoBox3.height*scaleButton/2-30,msg31.pivotX=0,msg31.pivotY=0,msg31.scaleX=scaleText,msg31.scaleY=scaleText,g.pushMessage(msg31),(infoBox4=g.sprite(g.assets["images/yo_level_512.png"])).x=0,infoBox4.y=0,infoBox4.scaleX=scaleButton,infoBox4.scaleY=scaleButton,(msg41=g.text("","40px puzzler","black")).x=infoBox4.width*scaleButton+10,msg41.y=infoBox4.height*scaleButton/2-40,msg41.pivotX=0,msg41.pivotY=0,msg41.scaleX=scaleText,msg41.scaleY=scaleText,(msg42=g.text("","40px puzzler","black")).x=infoBox4.width*scaleButton+10,msg42.y=infoBox4.height*scaleButton/2+10,msg42.pivotX=0,msg42.pivotY=0,msg42.scaleX=scaleText,msg42.scaleY=scaleText,updateGameInfoMsgs(),updateMsgInfo(),(infoBox1Group=g.group(infoBox1,msg11)).x=0,infoBox1Group.y=0,(infoBox2Group=g.group(infoBox2,msg21)).x=0,infoBox2Group.y=0,(infoBox3Group=g.group(infoBox3,msg31)).x=0,infoBox3Group.y=infoBox1Group.height*scaleButton*1.1+infoBox1Group.y,infoBox3Group.visible=!1,buttonsToShowHide.push(infoBox3Group),(infoBox4Group=g.group(infoBox4,msg41,msg42)).x=0,infoBox4Group.y=infoBox2Group.height*scaleButton*1.1+infoBox2Group.y,infoBox4Group.visible=!1,buttonsToShowHide.push(infoBox4Group),(pad_1_up=g.button([g.assets["images/pad_512_up_up.png"],g.assets["images/pad_512_up_over.png"],g.assets["images/pad_512_up_up.png"]],[])).press=()=>{upArrow.press()},(pad_1_down=g.button([g.assets["images/pad_512_down_up.png"],g.assets["images/pad_512_down_over.png"],g.assets["images/pad_512_down_up.png"]],[])).press=()=>{downArrow.press()},(pad_1_right=g.button([g.assets["images/pad_512_right_up.png"],g.assets["images/pad_512_right_over.png"],g.assets["images/pad_512_right_up.png"]],[])).press=()=>{rightArrow.press()},(pad_1_left=g.button([g.assets["images/pad_512_left_up.png"],g.assets["images/pad_512_left_over.png"],g.assets["images/pad_512_left_up.png"]],[])).press=()=>{leftArrow.press()},(pad_1_group=g.group(pad_1_up,pad_1_down,pad_1_right,pad_1_left)).x=10,pad_1_group.y=g.canvas.height/2-pad_1_group.height/4*scalePad,pad_1_group.scaleX=pad_1_group.scaleY=scalePad,(pad_2_up=g.button([g.assets["images/pad_512_up_up.png"],g.assets["images/pad_512_up_over.png"],g.assets["images/pad_512_up_up.png"]],[])).press=()=>{upArrow.press()},(pad_2_down=g.button([g.assets["images/pad_512_down_up.png"],g.assets["images/pad_512_down_over.png"],g.assets["images/pad_512_down_up.png"]],[])).press=()=>{downArrow.press()},(pad_2_right=g.button([g.assets["images/pad_512_right_up.png"],g.assets["images/pad_512_right_over.png"],g.assets["images/pad_512_right_up.png"]],[])).press=()=>{rightArrow.press()},(pad_2_left=g.button([g.assets["images/pad_512_left_up.png"],g.assets["images/pad_512_left_over.png"],g.assets["images/pad_512_left_up.png"]],[])).press=()=>{leftArrow.press()},(pad_2_group=g.group(pad_2_up,pad_2_down,pad_2_right,pad_2_left)).x=g.canvas.width-pad_2_group.width*scalePad-10,pad_2_group.y=g.canvas.height/2-pad_2_group.height/4*scalePad,pad_2_group.scaleX=scalePad,pad_2_group.scaleY=scalePad,padArray.push(pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_up,pad_2_down,pad_2_right,pad_2_left),(msgGroup=g.group(infoBox1Group,infoBox3Group)).x=10,msgGroup.y=1.1*menuShow.height*scaleButton,(msgGroup2=g.group(infoBox2Group,infoBox4Group)).x=g.canvas.width-img2.width+10,msgGroup2.y=1.1*infoGameButton.height*scaleButton,(groupInfo=g.group(img2,img3,msgGroup,msgGroup2,homeButton,infoGameButton,restartButton,pauseButton,pauseOnButton,saveButton,pad_1_group,pad_2_group,infoGameGroup,saveToDiskButton)).layer=5,updatePolygonPoinst()}function updateGameInfoMsgs(){msg11.content=" "+(stepArray.length-1),msg21.content=gameInfo.t<=0?" : .....":timeToString(gameInfo.t),msg31.content=" "+yo.bananasToEat,msg41.content=sceneMsgDim[scenePlaying-1],msg42.content="     "+levelPlaying}function updatePolygonPoinst(){var padFactor=padDimension*scalePad;pad_1_up.points=[{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.406*padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+0*padFactor},{x:pad_1_group.gx+padFactor,y:pad_1_group.gy+0*padFactor},{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.406*padFactor}],pad_1_down.points=[{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.6*padFactor},{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.6*padFactor},{x:pad_1_group.gx+padFactor,y:pad_1_group.gy+padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+padFactor}],pad_1_right.points=[{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.406*padFactor},{x:pad_1_group.gx+padFactor,y:pad_1_group.gy+0*padFactor},{x:pad_1_group.gx+padFactor,y:pad_1_group.gy+padFactor},{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.6*padFactor}],pad_1_left.points=[{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.406*padFactor},{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.6*padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+0*padFactor}],pad_2_up.points=[{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.406*padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+0*padFactor},{x:pad_2_group.gx+padFactor,y:pad_2_group.gy+0*padFactor},{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.406*padFactor}],pad_2_down.points=[{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.6*padFactor},{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.6*padFactor},{x:pad_2_group.gx+padFactor,y:pad_2_group.gy+padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+padFactor}],pad_2_right.points=[{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.406*padFactor},{x:pad_2_group.gx+padFactor,y:pad_2_group.gy+0*padFactor},{x:pad_2_group.gx+padFactor,y:pad_2_group.gy+padFactor},{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.6*padFactor}],pad_2_left.points=[{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.406*padFactor},{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.6*padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+0*padFactor}]}function setResart(){}function putBackgroundCanvas(image,x,y,width,height){g.canvas.style.background=`url(${image}) no-repeat`,g.canvas.style.backgroundPosition=x+`px ${y}px`,g.canvas.style.backgroundSize=width+`px ${height}px`}function pixelToVw(pixel){return(pixel/window.innerWidth*100).toFixed(2)}function pixelToVh(pixel){return(pixel/window.innerHeight*100).toFixed(2)}function updateCSSVariables(){var r=document.querySelector(":root"),btn_width=(getComputedStyle(r),Math.floor(menuShow.width*scaleButton*std.scaleCanvas)),btn_height=Math.floor(menuShow.width*scaleButton*std.scaleCanvas);g.canvas.offsetTop;let menu_gap=10,border_iframe=10,top=g.canvas.offsetTop+menuShow.y,left=g.canvas.offsetLeft+menuShow.width*scaleButton*std.scaleX+10;isMobile&&(menu_gap=5,border_iframe=5,top=5,left-=10),r.style.setProperty("--btn-width",btn_width+"px"),r.style.setProperty("--btn-height",btn_height+"px"),r.style.setProperty("--menu-top",top+"px"),r.style.setProperty("--menu-left",left+"px"),r.style.setProperty("--menu-gap",menu_gap+"px"),r.style.setProperty("--border-iframe",border_iframe+"px")}function updateInfoIframe(){var top=g.canvas.offsetTop+menuShow.height*scaleButton*std.scaleCanvas+10,h=.95*(window.innerHeight-top),w=.8*window.innerWidth,rootvar=document.getElementById("infoframe").contentWindow.document.querySelector(":root"),rootvar=(isMobile&&(rootvar.style.setProperty("--font-p","15px"),rootvar.style.setProperty("--margin-p-v","5px"),rootvar.style.setProperty("--margin-p-h","10px"),rootvar.style.setProperty("--font-header","15px"),rootvar.style.setProperty("--font-footer","15px"),rootvar.style.setProperty("--font-buttons","12px"),rootvar.style.setProperty("--btn-width","80px"),rootvar.style.setProperty("--bnt-height","25px"),rootvar.style.setProperty("--img-w","64px"),rootvar.style.setProperty("--img-h","64px"),rootvar.style.setProperty("--margin-flex","5%"),rootvar.style.setProperty("--margin-line","5px")),.1*window.innerWidth);infoDiv.style.top=top+"px",infoDiv.style.width=w+"px",infoDiv.style.height=h+"px",infoDiv.style.margin=`0  ${rootvar}px`}function createButtonMenu(){btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src,btn_1.style.width="64px",btn_2.src=g.assets["images/sound_no_240_up.png"].src,btn_2.style.width="64px",btn_1.onclick=()=>{document.fullscreenElement?(document.exitFullscreen(),btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src):(main.requestFullscreen().catch(e=>console.log(e)),btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src)},btn_1.ontouchstart=()=>{document.fullscreenElement?(document.exitFullscreen(),btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src):(main.requestFullscreen().catch(e=>console.log(e)),btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src)},btn_1.addEventListener("mouseover",()=>{fullscreenState?btn_1.src=g.assets["images/fullscreen_off_512_over.png"].src:btn_1.src=g.assets["images/fullscreen_on_512_over.png"].src}),btn_1.addEventListener("mouseleave",()=>{fullscreenState?btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src:btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src}),btn_2.onclick=()=>{(isSoundOn=!isSoundOn)?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src},btn_2.ontouchstart=()=>{(isSoundOn=!isSoundOn)?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src},btn_2.addEventListener("mouseover",()=>{isSoundOn?btn_2.src=g.assets["images/sound_yes_240_over.png"].src:btn_2.src=g.assets["images/sound_no_240_over.png"].src}),btn_2.addEventListener("mouseleave",()=>{isSoundOn?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src})}function saveGameInfoLast(){1e3<gameInfo.t&&(gameInfoLast.t=Object.values(gameInfo)[0],gameInfoLast.s=Object.values(gameInfo)[1],gameInfoLast.b=Object.values(gameInfo)[2])}function timeToString(t){var t=(t/1e3).toFixed(1),second_ten=t.toString().substring(t.toString().indexOf(".")+1),t=Math.floor(t),minutes=Math.floor(t/60);let zeroSec="0",zeroMin=9<minutes?"":"0";return 9<t%60&&(zeroSec=""),minutes<=0?""+zeroSec+t%60+"."+second_ten:""+zeroMin+minutes+`:${zeroSec}${t%60}.`+second_ten}function updateGameInfo(from){let obj={};function fillLine(line,o){if(0===line){let first=void 0,second=void 0,third=void 0,fourth=void 0;o.first<=0?(infoGameMsg[line][0].content="?",infoGameMsg[line][0].x=400,infoGameMsg[line][1].content="?"):(first=+(o.first/1e3).toFixed(1),infoGameMsg[line][0].content=timeToString(o.first),infoGameMsg[line][0].x=415-15*timeToString(o.first).length),o.second<0?(infoGameMsg[line][2].content="?",infoGameMsg[line][2].x=849,infoGameMsg[line][3].content="?"):(second=+(o.second/1e3).toFixed(1),infoGameMsg[line][2].content=timeToString(o.second),infoGameMsg[line][2].x=864-15*timeToString(o.second).length),void 0!==first&&void 0!==second&&(first===second?infoGameMsg[line][1].content="=":first<second?infoGameMsg[line][1].content="<":infoGameMsg[line][1].content=">"),o.third<=0?(infoGameMsg[line][4].content="?",infoGameMsg[line][4].x=1285,infoGameMsg[line][3].content="?",infoGameMsg[line][5].content="?"):(third=+(o.third/1e3).toFixed(1),infoGameMsg[line][4].content=timeToString(o.third),infoGameMsg[line][4].x=1300-15*timeToString(o.third).length),void 0!==second&&void 0!==third&&(second===third?infoGameMsg[line][3].content="=":second<third?infoGameMsg[line][3].content="<":infoGameMsg[line][3].content=">"),o.fourth<=0?(infoGameMsg[line][6].content="?",infoGameMsg[line][6].x=1701):(fourth=+(o.fourth/1e3).toFixed(1),infoGameMsg[line][6].content=timeToString(o.fourth),infoGameMsg[line][6].x=1716-15*timeToString(o.fourth).length),void 0!==third&&void 0!==fourth&&(third===fourth?infoGameMsg[line][5].content="=":third<fourth?infoGameMsg[line][5].content="<":infoGameMsg[line][5].content=">")}else if(1===line){let first=void 0,second=void 0,third=void 0,fourth=void 0;o.first<=0?(infoGameMsg[line][0].content="?",infoGameMsg[line][0].x=400,infoGameMsg[line][1].content="?"):(first=o.first,infoGameMsg[line][0].content=o.first.toString(),infoGameMsg[line][0].x=415-15*o.first.toString().length),o.second<0?(infoGameMsg[line][2].content="?",infoGameMsg[line][2].x=849):(second=o.second,infoGameMsg[line][2].content=o.second.toString(),infoGameMsg[line][2].x=864-15*o.second.toString().length),void 0!==first&&void 0!==second&&(o.first===o.second?infoGameMsg[line][1].content="=":o.first<o.second?infoGameMsg[line][1].content="<":infoGameMsg[line][1].content=">"),o.third<=0?(infoGameMsg[line][4].content="?",infoGameMsg[line][4].x=1285,infoGameMsg[line][3].content="?",infoGameMsg[line][5].content="?"):(third=o.third,infoGameMsg[line][4].content=o.third.toString(),infoGameMsg[line][4].x=1300-15*o.third.toString().length),void 0!==second&&void 0!==third&&(o.second===o.third?infoGameMsg[line][3].content="=":o.second<o.third?infoGameMsg[line][3].content="<":infoGameMsg[line][3].content=">"),o.fourth<=0?(infoGameMsg[line][6].content="?",infoGameMsg[line][6].x=1701,infoGameMsg[line][5].content="?"):(fourth=o.fourth,infoGameMsg[line][6].content=o.fourth.toString(),infoGameMsg[line][6].x=1716-15*o.fourth.toString().length),void 0!==third&&void 0!==fourth&&(o.third===o.fourth?infoGameMsg[line][5].content="=":o.third<o.fourth?infoGameMsg[line][5].content="<":infoGameMsg[line][5].content=">")}else if(2===line){let first=void 0,second=void 0,third=void 0,fourth=void 0;o.first<0?(infoGameMsg[line][0].content="?",infoGameMsg[line][0].x=400,infoGameMsg[line][1].content="?"):(first=o.first,infoGameMsg[line][0].content=o.first.toString(),infoGameMsg[line][0].x=415-15*o.first.toString().length),o.second<0?(infoGameMsg[line][2].content="?",infoGameMsg[line][2].x=849):(second=o.second,infoGameMsg[line][2].content=o.second.toString(),infoGameMsg[line][2].x=864-15*o.second.toString().length),void 0!==first&&void 0!==second&&(o.first===o.second?infoGameMsg[line][1].content="=":o.first<o.second?infoGameMsg[line][1].content="<":infoGameMsg[line][1].content=">"),o.third<0?(infoGameMsg[line][4].content="?",infoGameMsg[line][4].x=1285,infoGameMsg[line][3].content="?",infoGameMsg[line][5].content="?"):(third=o.third,infoGameMsg[line][4].content=o.third.toString(),infoGameMsg[line][4].x=1300-15*o.third.toString().length),void 0!==second&&void 0!==third&&(o.second===o.third?infoGameMsg[line][3].content="=":o.second<o.third?infoGameMsg[line][3].content="<":infoGameMsg[line][3].content=">"),o.fourth<0?(infoGameMsg[line][6].content="?",infoGameMsg[line][6].x=1701,infoGameMsg[line][5].content="?"):(fourth=o.fourth,infoGameMsg[line][6].content=o.fourth.toString(),infoGameMsg[line][6].x=1716-15*o.fourth.toString().length),void 0!==third&&void 0!==fourth&&(o.third===o.fourth?infoGameMsg[line][5].content="=":o.third<o.fourth?infoGameMsg[line][5].content="<":infoGameMsg[line][5].content=">")}}!async function(){var quota;navigator.storage&&navigator.storage.estimate&&((quota=await navigator.storage.estimate()).usage,quota.quota,quota=quota.quota-quota.usage,std.quota=(quota/1024/1024).toFixed(1))}();function updateLines(){obj.first=gameInfoLast.t,obj.second=gameInfo.t,obj.third=gameInfoLast.bt,obj.fourth=estimateKeyboard[scenePlaying-1][levelPlaying-1].csec,fillLine(0,obj),obj.first=gameInfoLast.s,obj.second=gameInfo.s,obj.third=gameInfoLast.bs,obj.fourth=estimateKeyboard[scenePlaying-1][levelPlaying-1].s,fillLine(1,obj),obj.first=gameInfoLast.b,obj.second=gameInfo.b,obj.third=gameInfoLast.bb,obj.fourth=0,fillLine(2,obj)}console.log("local space = ",(()=>{let allString="";for(const key of Object.keys(window.localStorage))allString+=window.localStorage[key];return allString?Math.ceil(3+16*allString.length/8192)+" KB":"Empty (0 KB"})()),"restart"===from||"infoBtn"===from?updateLines():"end"===from&&(gameInfoLast.bt=Math.min(gameInfoLast.bt<=0?1/0:gameInfoLast.bt,gameInfo.t),gameInfoLast.bs=Math.min(gameInfoLast.bs<=0?1/0:gameInfoLast.bs,gameInfo.s),gameInfoLast.bb=Math.min(gameInfoLast.bb<=0?1/0:gameInfoLast.bb,gameInfo.b),updateLines())}function measureText(font,text){return g.canvas.ctx.font=font,{width:g.canvas.ctx.measureText(text).width,height:g.canvas.ctx.measureText("M").width}}function buildSaveGoup(){dataSave=[],saveImgBorder=g.sprite(g.assets["images/save_img.png"]),saveImgInBorder=g.sprite(g.assets["images/save_img_in.png"]),saveMsg_1=g.text("temp","30px puzzler","black"),saveMsg_2=g.text("temp","30px puzzler","black"),saveMsg_3=g.text("temp","30px puzzler","black"),saveMsg_4=g.text("temp","30px puzzler","black"),saveMsg_5=g.text("temp","30px puzzler","black"),saveMsg_11=g.text("temp","30px puzzler","black"),saveMsg_21=g.text("temp","30px puzzler","black"),saveMsg_31=g.text("temp","30px puzzler","black"),updateSaveGoup(),(saveCancelButton=g.button([g.assets["images/save_cancel_512_up.png"],g.assets["images/save_cancel_512_over.png"],g.assets["images/save_cancel_512_up.png"]])).x=.25*saveImgInBorder.width-.5*saveCancelButton.width*scaleButton,saveCancelButton.y=saveImgInBorder.height-1.2*saveCancelButton.height*scaleButton-32,saveCancelButton.scaleX=scaleButton,saveCancelButton.scaleY=scaleButton,(saveOkButton=g.button([g.assets["images/save_ok_512_up.png"],g.assets["images/save_ok_512_over.png"],g.assets["images/save_ok_512_up.png"]])).x=.75*saveImgInBorder.width-.5*saveOkButton.width*scaleButton,saveOkButton.y=saveImgInBorder.height-1.2*saveOkButton.height*scaleButton-32,saveOkButton.scaleX=scaleButton,saveOkButton.scaleY=scaleButton,saveOkButton.press=()=>{if(fromSave)(dataSave=[]).push(gameInfo),dataSave.push(stepArray),localStorage.removeItem("data"+scenePlaying+levelPlaying),localStorage.setItem("data"+scenePlaying+levelPlaying,JSON.stringify(dataSave));else{var gInfo=(data=JSON.parse(localStorage.getItem("data"+scenePlaying+levelPlaying)))[0],sArr=data[1];resetAllParameters(scenePlaying,levelPlaying),gameInfo={...gInfo},stepArray=[...sArr],g.setReplayMode(!0),g.setGameInfo(gameInfo),g.setStepArray(stepArray),updateGameInfoMsgs();let i=1;intervalId=setInterval(()=>{"u"===stepArray[i].d?yo.move("up",blocks,yo,walk):"d"===stepArray[i].d?yo.move("down",blocks,yo,walk):"r"===stepArray[i].d?yo.move("right",blocks,yo,walk):"l"===stepArray[i].d&&yo.move("left",blocks,yo,walk),++i===stepArray.length&&(clearInterval(intervalId),g.setReplayMode(!1))},100)}g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30)},saveCancelButton.press=()=>{g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30)},(saveOkCancelGroup=g.group(saveImgInBorder,saveMsg_11,saveMsg_21,saveMsg_31,saveOkButton,saveCancelButton)).x=.5*g.canvas.width-.5*saveImgInBorder.width,saveOkCancelGroup.y=g.canvas.height,saveOkCancelGroup.layer=50,(saveInButton=g.button([g.assets["images/save_512_in_up.png"],g.assets["images/save_512_in_over.png"],g.assets["images/save_512_in_up.png"]])).press=()=>{let msg1,msg2,msg3;fromOpen=!1,fromSave=!0,g.slide(saveOkCancelGroup,saveOkCancelGroup.x,.5*g.canvas.height-.5*saveImgInBorder.height,30),g.slide(saveGroup,saveGroup.x,-g.canvas.height,30),msg3=isSaved?(msg1="Already saved",msg2="Want to save anyway !","The last saved game will be lost."):(msg1="Save !",msg2="First time saved.","Only one saved game at a time."),updateSaveOkCancelGoup(msg1,msg2,msg3)},saveInButton.x=.25*saveImgBorder.width-.5*saveInButton.width*scaleButton,saveInButton.y=saveImgBorder.height-1.2*saveInButton.height*scaleButton-32,saveInButton.scaleX=scaleButton,saveInButton.scaleY=scaleButton,(saveOutButton=g.button([g.assets["images/save_512_out_up.png"],g.assets["images/save_512_out_over.png"],g.assets["images/save_512_out_up.png"]])).x=.75*saveImgBorder.width-.5*saveOutButton.width*scaleButton,saveOutButton.y=saveImgBorder.height-1.2*saveOutButton.height*scaleButton-32,saveOutButton.scaleX=scaleButton,saveOutButton.scaleY=scaleButton,saveOutButton.press=()=>{let msg1,msg2,msg3;fromOpen=!0,fromSave=!1,g.slide(saveOkCancelGroup,saveOkCancelGroup.x,.5*g.canvas.height-.5*saveImgInBorder.height,30),g.slide(saveGroup,saveGroup.x,-g.canvas.height,30),msg3=isSaved?(msg1="Load the game !",msg2="Present data will be lost.","Load anyway !"):(msg1="Can not open this game !",msg2="Not saved yet.","Only saved game can be opened."),updateSaveOkCancelGoup(msg1,msg2,msg3)},(saveGroup=g.group(saveImgBorder,saveMsg_1,saveMsg_2,saveMsg_3,saveMsg_4,saveMsg_5,saveInButton,saveOutButton)).x=.5*g.canvas.width-.5*saveImgBorder.width,saveGroup.y=-g.canvas.height}function updateSaveGoup(msg_1,msg_2,msg_3,msg_4,msg_5){let font="40px puzzler",fontTitle="60px puzzler";isMobile&&(font="40px puzzler",fontTitle="50px puzzler"),fromOpen=fromSave=!1,(dataSave=[]).push(gameInfo),dataSave.push(stepArray),msg_5=(data=JSON.parse(localStorage.getItem("data"+scenePlaying+levelPlaying)))?(isSaved=!0,isExit=!0,msg_1="Open the game !",msg_2=sceneMsgDim[scenePlaying-1]+" Level:"+levelPlaying,msg_3="Time : "+timeToString(data[0].t),msg_4="Steps : "+data[0].s,"Bananas : "+data[0].b):(isSaved=!1,isExit=!1,msg_1="Save the game !",msg_2=sceneMsgDim[scenePlaying-1]+" Level:"+levelPlaying,msg_3="Time : "+timeToString(gameInfo.t),msg_4="Steps : "+gameInfo.s,"Bananas : "+gameInfo.b),saveMsg_1.font=fontTitle,saveMsg_1.content=msg_1,saveMsg_1.width=measureText(fontTitle,msg_1).width,saveMsg_1.height=measureText(fontTitle,msg_1).height,saveMsg_1.x=.5*saveImgBorder.width-.5*saveMsg_1.width,saveMsg_1.y=32,saveMsg_2.font=fontTitle,saveMsg_2.content=msg_2,saveMsg_2.width=measureText(fontTitle,msg_2).width,saveMsg_2.height=measureText(fontTitle,msg_2).height,saveMsg_2.x=.5*saveImgBorder.width-.5*saveMsg_2.width,saveMsg_2.y=saveMsg_1.y+saveMsg_1.height+10,saveMsg_3.content=msg_3,saveMsg_3.font=font,saveMsg_3.width=measureText(font,msg_3).width,saveMsg_3.height=measureText(font,msg_3).height,saveMsg_3.x=.5*saveImgBorder.width-.5*saveMsg_3.width,saveMsg_3.y=saveMsg_2.y+saveMsg_2.height+20,saveMsg_4.content=msg_4,saveMsg_4.font=font,saveMsg_4.width=measureText(font,msg_4).width,saveMsg_4.height=measureText(font,msg_4).height,saveMsg_4.x=.5*saveImgBorder.width-.5*saveMsg_4.width,saveMsg_4.y=saveMsg_3.y+saveMsg_3.height+10,saveMsg_5.content=msg_5,saveMsg_5.font=font,saveMsg_5.width=measureText(font,msg_5).width,saveMsg_5.height=measureText(font,msg_5).height,saveMsg_5.x=.5*saveImgBorder.width-.5*saveMsg_5.width,saveMsg_5.y=saveMsg_4.y+saveMsg_4.height+10}function updateSaveOkCancelGoup(msg_11,msg_21,msg_31){let font="40px puzzler",fontTitle="60px puzzler";isMobile&&(font="40px puzzler",fontTitle="50px puzzler"),saveMsg_11.font=fontTitle,saveMsg_11.content=msg_11,saveMsg_11.width=measureText(fontTitle,msg_11).width,saveMsg_11.height=measureText(fontTitle,msg_11).height,saveMsg_11.x=.5*saveImgInBorder.width-.5*saveMsg_11.width,saveMsg_11.y=32,saveMsg_21.font=fontTitle,saveMsg_21.content=msg_21,saveMsg_21.width=measureText(fontTitle,msg_21).width,saveMsg_21.height=measureText(fontTitle,msg_21).height,saveMsg_21.x=.5*saveImgInBorder.width-.5*saveMsg_21.width,saveMsg_21.y=saveMsg_11.y+saveMsg_11.height+10,saveMsg_31.content=msg_31,saveMsg_31.font=font,saveMsg_31.width=measureText(font,msg_31).width,saveMsg_31.height=measureText(font,msg_31).height,saveMsg_31.x=.5*saveImgInBorder.width-.5*saveMsg_31.width,saveMsg_31.y=saveMsg_21.y+saveMsg_21.height+20}async function saveToDisk(what){var deviceInfo={is_M:isMobile,is_T:isTouch,DPI:pixelRatio,WA:window.screen.availWidth,HA:window.screen.availHeight,WW:window.innerWidth,WH:window.innerHeight,DW:document.body.width,DH:document.body.height,S_C:std.scaleCanvas.toFixed(2),S_X:std.scaleX.toFixed(2),S_Y:std.scaleY.toFixed(2),Q:std.quota},infoScene={scene:scenePlaying,level:levelPlaying},arrInfo=[],deviceInfo=(arrInfo.push(deviceInfo,infoScene,gameInfo,stepArray),document.createElement("a")),infoScene=new Blob([JSON.stringify(arrInfo)],{type:"text/plain"});deviceInfo.setAttribute("href",URL.createObjectURL(infoScene)),deviceInfo.setAttribute("download","yo_gameConfig".toLowerCase()+".json"),deviceInfo.click(),URL.revokeObjectURL(deviceInfo.href)}g.start(),g.scaleToWindow(std),window.addEventListener("resize",event=>{g.scaleToWindow(std),updateMsgInfo(),updateCSSVariables(),updateInfoIframe()}),document.addEventListener("fullscreenchange",event=>{g.scaleToWindow(std),updateMsgInfo(),(fullscreenState=!fullscreenState)?btn_1.src=g.assets["images/fullscreen_off_512_over.png"].src:btn_1.src=g.assets["images/fullscreen_on_512_over.png"].src});