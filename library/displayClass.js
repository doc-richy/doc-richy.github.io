import"./utilities.js";import"./typedef.js";let i=[],e=[];class t{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.pivotX=0,this.pivotY=0,this.vx=0,this.vy=0,this._layer=0,this._gridX=0,this._gridY=0,this._type=void 0,this.children=[],this.parent=void 0,this.shadow=!1,this.shadowColor="rgba(100, 100, 100, 0.5",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.blendMode=void 0,this.frames=[],this.loop=!0,this._currentFrame=0,this.playing=!1,this._draggable=void 0,this._circular=!1,this._interactive=!1,this._polygon=void 0,this._points=[]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}get layer(){return this._layer}set layer(t){this._layer=t,this.parent&&this.parent.children.sort((t,i)=>t.layer-i.layer)}set gridX(t){this._gridX=t}get gridX(){return this._gridX}set gridY(t){this._gridY=t}get gridY(){return this._gridY}set type(t){this._type=t}get type(){return this._type}addChild(t){t.parent&&t.parent.removeChild(t),(t.parent=this).children.push(t)}removeChild(t){if(t.parent!==this)throw new Error(t+" is not a child of "+this);this.children.splice(this.children.indexOf(t),1)}get halfWidth(){return this.width/2}get halfHeight(){return this.height/2}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}setPosition(t,i){this.x=t,this.y=i}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get empty(){return 0===this.children.length}putCenter(t,i=0,e=0){var h=this;t.x=h.x+h.halfWidth-t.halfWidth+i,t.y=h.y+h.halfHeight-t.halfHeight+e}putTop(t,i=0,e=0){var h=this;t.x=h.x+h.halfWidth-t.halfWidth+i,t.y=h.y-t.height+e}putRight(t,i=0,e=0){var h=this;t.x=h.x+h.width+i,t.y=h.y+h.halfHeight-t.halfHeight+e}putBottom(t,i=0,e=0){var h=this;t.x=h.x+h.halfWidth-t.halfWidth+i,t.y=h.y+h.height+e}putLeft(t,i=0,e=0){var h=this;t.x=h.x-t.width+i,t.y=h.y+h.halfHeight-t.halfHeight+e}swapChildren(t,i){var e=this.children.indexOf(t),h=this.children.indexOf(i);if(-1===e||-1===h)throw Error("Both objects must be a child of the caller "+this);t.childIndex=h,i.childIndex=e,this.children[e]=i,this.children[h]=t}swapSpritePosition(t,i){var e=i.x,h=i.y,s=i.gridX,r=i.gridY;if(-1===this.children.indexOf(t)||-1===this.children.indexOf(i))throw Error("Both objects must be a child of the caller "+this);i.x=t.x,i.y=t.y,i.gridX=t.gridX,i.gridY=t.gridY,t.x=e,t.y=h,t.gridX=s,t.gridY=r}add(...t){t.forEach(t=>this.addChild(t))}remove(...t){t.forEach(t=>this.removeChild(t))}get currentFrame(){return this._currentFrame}get circular(){return this._circular}set circular(t){!0===t&&!1===this._circular&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(t){this.width=t,this.height=t},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(t){this.width=2*t,this.height=2*t},enumerable:!0,configurable:!0}}),this._circular=!0),!1===t&&!0===this._circular&&(delete this.diameter,delete this.radius,this._circular=!1)}get draggable(){return this._draggable}set draggable(t){!0===t&&(e.push(this),this._draggable=!0),!1===t&&e.splice(e.indexOf(this),1)}get interactive(){return this._interactive}set interactive(t){!0===t&&(k(this),i.push(this),this._interactive=!0),!1===t&&this.interactive&&(i.splice(i.indexOf(this),1),this._interactive=!1)}get polygon(){return this._polygon}set polygon(t){!0===t&&(this._polygon=!0),!1===t&&(i.splice(i.ondexOf(this),1),this._polygon=!1)}get points(){return this._points}set points(t){if(!(t instanceof Array))throw new Error("The points is not an Array, it's a "+typeof t);this._points=JSON.parse(JSON.stringify(t)),!1===t&&(i.splice(i.ondexOf(this),1),this._points=[],this._polygon=!1)}removeAll(...t){t.forEach(t=>{t.parent.removeChild(t)})}}let l=new t;function h(t=256,i=256,e="1px dashed black",h="none"){var s=document.createElement("canvas");return s.width=t,s.height=i,s.style.border=e,s.style.backgroundColor=h,s.ctx=s.getContext("2d"),s}function s(t,i,e,h,s){var r={};return r.image=t,r.x=i,r.y=e,r.width=h,r.height=s,r}function n(t,i,e,h){var s={};return s.image=t,s.data=i,s.width=e,s.height=h,s}function S(...t){t.forEach(t=>{t.parent.removeChild(t)})}class o extends t{constructor(t=32,i=32,e="black",h="none",s=0,r=0,a=0,o=!1,n=0){super(),Object.assign(this,{width:t,height:i,fillStyle:e,strokeStyle:h,lineWidth:s,x:r,y:a,rounded:o,radius:n}),this.mask=!1}render(t){var i,e,h,s,r,a,o,n;t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),this.rounded?(this.width<2*this.radius&&(this.radius=this.width/2),this.height<2*this.radius&&(this.radius=this.height/2),i=-this.width*this.pivotX+this.width,e=-this.height*this.pivotY,h=-this.width*this.pivotX+this.width,s=-this.height*this.pivotY+this.height,r=-this.width*this.pivotX,a=-this.height*this.pivotY+this.height,o=-this.width*this.pivotX,n=-this.height*this.pivotY,t.moveTo(-this.width*this.pivotX+this.radius,e),t.arcTo(i,e,h,s,this.radius),t.arcTo(h,s,r,a,this.radius),t.arcTo(r,a,o,n,this.radius),t.arcTo(o,n,i,e,this.radius),t.closePath()):t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&!0===this.mask&&t.clip()}}function d(t,i,e,h,s,r,a){t=new o(t,i,e,h,s,r,a);return l.addChild(t),t}class a extends t{constructor(t=32,i="gray",e="none",h=0,s=0,r=0){super(),this.circular=!0,Object.assign(this,{diameter:t,fillStyle:i,strokeStyle:e,lineWidth:h,x:s,y:r}),this.mask=!1}render(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&!0===this.mask&&t.clip()}}function _(t,i,e,h,s,r){t=new a(t,i,e,h,s,r);return l.addChild(t),t}class c extends t{constructor(t="none",i=0,e=0,h=0,s=32,r=32){super(),this.circular=!0,Object.assign(this,{strokeStyle:t,lineWidth:i,ax:e,ay:h,bx:s,by:r}),this.lineJoin="round"}render(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineJoin=this.lineJoin,t.beginPath(),t.moveTo(this.ax,this.ay),t.lineTo(this.bx,this.by),"none"!==this.strokeStyle&&t.stroke()}}function r(t,i,e,h,s,r){t=new c(t,i,e,h,s,r);return l.addChild(t),t}class g extends t{constructor(t="Hello",i="12px sans-sherif",e="red",h=0,s=0){super(),Object.assign(this,{content:t,font:i,fillStyle:e,x:h,y:s}),this.textBaseline="top",this.strokeText="none"}render(t){this.visible&&(t.font=this.font,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,0===this.width&&(this.width=t.measureText(this.content).width),0===this.height&&(this.height=t.measureText("M").width),t.translate(-this.width*this.pivotX,-this.height*this.pivotY),t.textBaseline=this.textBaseline,t.fillText(this.content,0,0),"none"!==this.strokeText)&&t.strokeText()}}function f(t,i,e,h,s){t=new g(t,i,e,h,s);return l.addChild(t),t}class u extends t{constructor(...t){super(),t.forEach(t=>this.addChild(t))}addChild(t){t.parent&&t.parent.removeChild(t),(t.parent=this).children.push(t),this.calculateSize()}removeChild(t){if(t.parent!==this)throw new Error(t+" is not a child of "+this);this.children.splice(this.children.indexOf(t),1),this.calculateSize()}calculateSize(){0<this.children.length&&(this._newWidth=0,this._newHeight=0,this.children.forEach(t=>{t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)}),this.width=this._newWidth,this.height=this._newHeight)}}function x(...t){t=new u(...t);return l.addChild(t),t}class p extends t{constructor(t,i=0,e=0){if(super(),Object.assign(this,{x:i,y:e}),t instanceof Image)this.createFromImage(t);else if(t.frame)this.createFromAtlas(t);else if(t.image&&!t.data)this.createFromTileset(t);else if(t.image&&t.data)this.createFromTilesetFrames(t);else{if(!(t instanceof Array))throw new Error(`The image source ${t} is not recognized`);if(t[0]&&t[0].source)this.createFromAtlasFrames(t)`;`;else{if(!(t[0]instanceof Image))throw new Error(`The image sources in ${t} are not recognized`);this.createFromImages(t)}}}createFromImage(t){if(!(t instanceof Image))throw new Error(t+" is not an image object");this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromTileset(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.sourceX=t.x,this.sourceY=t.y,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromTilesetFrames(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.frames=t.data,this.sourceX=this.frames[0][0],this.sourceY=this.frames[0][1],this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlasFrames(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceWidth=t[0].frame.h}createFromImages(t){this.frames=t,this.source=t[0],this.sourceX=0,this.sourceY=0,this.width=t[0].width,this.height=t[0].height,this.sourceWidth=t[0].width,this.sourceHeight=t[0].height}gotoAndStop(t){if(!(0<this.frames.length&&t<this.frames.length))throw new Error(`Frame number ${t} does not exist`);this.frames[0]instanceof Array?(this.sourceX=this.frames[t][0],this.sourceY=this.frames[t][1]):this.frames[t].frame?(this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.sourceWidth=this.frames[t].frame.w,this.sourceHeight=this.frames[t].frame.h,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h):(this.source=this.frames[t],this.sourceX=0,this.sourceY=0,this.width=this.source.width,this.height=this.source.height,this.sourceWidth=this.source.width,this.sourceHeight=this.source.height),this._currentFrame=t}render(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}function X(t,i,e){t=new p(t,i,e);if(0<t.frames.length){var a=t;let i=0,e=0,h=0,s=0,r=void 0;function o(t){n(),h=t[0],s=t[1],e=s-h,0===h&&(e+=1,i+=1),1===e&&(e=2,i+=1),a.fps||(a.fps=12);t=1e3/a.fps;a.gotoAndStop(h),a.playing||(r=setInterval(function(){i<e?(a.gotoAndStop(a.currentFrame+1),i+=1):a.loop&&(a.gotoAndStop(h),i=1)}.bind(this),t),a.playing=!0)}function n(){void 0!==r&&!0===a.playing&&(a.playing=!1,i=0,h=0,s=0,e=0,clearInterval(r))}a.show=function(t){n(),a.gotoAndStop(t)},a.play=function(){o([0,a.frames.length-1])},a.stop=function(){n(),a.gotoAndStop(a.currentFrame)},a.playSequence=o}return l.addChild(t),t}function y(t,i){var e=document.createElement("canvas");return e.width=90,e.height=90,e.getContext("2d").drawImage(t.source,0,0,90,90),t=e.toDataURL("png"),console.log("data url ",t),(e=new Image).width=e.height=90,e.src=t,console.log("width",e.width),X(e)}let v=void 0;function w(e){let h=e.ctx;v||((v=h.createLinearGradient(0,0,0,e.height)).addColorStop(0,"#F7E9B8"),v.addColorStop(1,"#FFEC4B")),h.fillStyle=v,h.fillRect(0,0,e.width,e.height),l.children.forEach(t=>{!function i(t){t.visible&&t.gx<e.width+t.width&&t.gx+t.width>=-t.width&&t.gy<e.height+t.height&&t.gy+t.height>=-t.height&&(h.save(),h.translate(t.x+t.width*t.pivotX,t.y+t.height*t.pivotY),h.rotate(t.rotation),h.globalAlpha=t.alpha*t.parent.alpha,h.scale(t.scaleX,t.scaleY),t.shadow&&(h.shadowColor=t.shadowColor,h.shadowOffsetX=t.shadowOffsetX,h.shadowOffsetY=t.shadowOffsetY,h.shadowBlur=t.shadowBlur),t.blendMode&&(h.globalCompositeOperation=t.blendMode),t.render&&t.render(h),t.children&&0<t.children.length&&(h.translate(-t.width*t.pivotX,-t.height*t.pivotY),t.children.forEach(t=>{i(t)})),h.restore())}(t)})}function m(e,h){let s=e.ctx;s.clearRect(0,0,e.width,e.height),l.children.forEach(t=>{!function i(t){t.visible&&t.gx<e.width+t.width&&t.gx+t.width>-t.width&&t.gy<e.height+t.height&&t.gy+t.height>-t.height&&(s.save(),void 0!==t.previousX?t.renderX=(t.x-t.previousX)*h+t.previousX:t.renderX=t.x,void 0!==t.previousY?t.renderY=(t.y-t.previousY)*h+t.previousY:t.renderY=t.y,s.translate(t.renderX+t.width*t.pivotX,t.renderY+t.height*t.pivotY),s.rotate(t.rotation),s.globalAlpha=t.alpha*t.parent.alpha,s.scale(t.scaleX,t.scaleY),t.shadow&&(s.shadowColor=t.shadowColor,s.shadowOffsetX=t.shadowOffsetX,s.shadowOffsetY=t.shadowOffsetY,s.shadowBlur=t.shadowBlur),t.blendMode&&(s.globalCompositeOperation=t.blendMode),t.render&&t.render(s),t.children&&0<t.children.length&&(s.translate(-t.width*t.pivotX,-t.height*t.pivotY),t.children.forEach(t=>{i(t)})),s.restore())}(t)})}class Y extends p{constructor(t,i,e=0,h=0){super(t,e,h),this.interactive=!0,i instanceof Array&&(this.polygon=!0,this.points=JSON.parse(JSON.stringify(i)))}}function b(t,i,e,h){t=new Y(t,i,e,h);return l.addChild(t),t}function k(h){h.press=h.press||void 0,h.release=h.release||void 0,h.over=h.over||void 0,h.out=h.out||void 0,h.tap=h.tap||void 0,h.state="up",h.action="",h.pressed=!1,h.hoverOver=!1,h.update=(t,i)=>{let e;e=h.polygon?t.hitTestPolygon(h.points):t.hitTestSprite(h),t.isUp&&(h.state="up",h instanceof Y)&&h.gotoAndStop(0),e&&(h.state="over",h.frames&&3===h.frames.length&&h instanceof Y&&h.gotoAndStop(1),t.isDown)&&(h.state="down",h instanceof Y)&&(3===h.frames.length?h.gotoAndStop(2):h.gotoAndStop(1)),"down"!==h.state||h.pressed||(h.press&&h.press(),h.pressed=!0,h.action="pressed"),"over"===h.state&&(h.pressed&&(h.release&&h.release(),h.pressed=!1,h.action="released",t.tapped)&&h.tap&&h.tap(),h.hoverOver||(h.over&&h.over(),h.hoverOver=!0)),"up"===h.state&&(h.pressed&&(h.release&&h.release(),h.pressed=!1,h.action="released"),h.hoverOver)&&(h.out&&h.out(),h.hoverOver=!1)}}function C(i=0,t=0,e=32,h=32,s=!1,r=0,a=0,o=void 0,n=void 0){let l=x();var d=i*t;for(let t=0;t<d;t++){var c=t%i*e,g=Math.floor(t/i)*h,f=o();l.addChild(f),s?(f.x=c+e/2-f.halfWidth+r,f.y=g+h/2-f.halfHeight+a):(f.x=c+r,f.y=g+a),n&&n(f)}return l}function W(h=0,t=0,s=32,r=32,a="",o=[],n,l,d,c=!1,g=0,f=0,u=void 0){let p=x(),y=[],i;if(0===l.length)for(let t=0;t<16;t++)(i=X(o[t+5],-30*s,0)).scaleX=i.scaleY=d,i.pivotX=i.pivotY=0,i.type="yo",i.gridX=-10,i.gridY=-10,i.visible=!1,i.layer=3,c?(i.x=s/2-s-i.halfWidth+g,i.y=0+r/2-i.halfHeight+f):(i.x=-s+g,i.y=0+f),l.push(i);{var v=h*t;let e=void 0;for(let i=0;i<v;i++){var w=i%h*s,m=Math.floor(i/h)*r;let t;if("0"===a.charAt(i))(t=X(o[1],w,m)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="road",t.gridX=i%h,t.gridY=Math.floor(i/h),l[4].gridX=i%h,l[4].gridY=Math.floor(i/h),l[4].x=w,l[4].y=m,l[4].visible=!0;else if("1"===a.charAt(i))(t=X(o[1],w,m)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="road",t.gridX=i%h,t.gridY=Math.floor(i/h);else if("2"===a.charAt(i))(t=X(o[2],w,m)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="forest",t.gridX=i%h,t.gridY=Math.floor(i/h),t.canMove=!1,t.yo=!1;else{if("3"===a.charAt(i))(t=X(o[1],w,m)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="box",t.gridX=i%h,t.gridY=Math.floor(i/h),t.canMove=!0,(e=X(o[3],w,m)).scaleX=e.scaleY=d,e.pivotX=t.pivotY=0,e.type="box",e.gridX=i%h,e.gridY=Math.floor(i/h),e.canMove=!1,e.yo=!1,e.level=1;else{if("4"!==a.charAt(i))throw Error(a.charAt(i)+" is not allowed for character level");n.bananasToEat+=1,(t=X(o[1],w,m)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="bananas",t.gridX=i%h,t.gridY=Math.floor(i/h),t.canMove=!1,t.yo=!1,(e=X(o[4],w,m)).scaleX=e.scaleY=d,e.pivotX=t.pivotY=0,e.type="bananas",e.gridX=i%h,e.gridY=Math.floor(i/h),e.canMove=!0,e.yo=!1,e.level=2}y.push(e)}p.addChild(t),c?(t.x=w+s/2-t.halfWidth+g,t.y=m+r/2-t.halfHeight+f):(t.x=w+g,t.y=m+f),u&&u(t)}y.forEach(t=>{c?(t.x=t.x+s/2-t.halfWidth+g,t.y=t.y+r/2-t.halfHeight+f):(t.x=t.x+g,t.y=t.y+f),p.addChild(t)}),l.forEach(t=>p.addChild(t))}return p}function O(t,h,s,r=0){var a=[],o=t.width/h,i=o*(t.height/s);for(let e=0;e<i;e++){let t=e%o*h,i=Math.floor(e/o)*s;r&&0<r&&(t+=r+r*e%o,i+=r+r*Math.floor(e/o)),a.push([t,i])}return n(t,a,h,s)}let F=[];function M(t,i){let e={},h=void 0;return e.playing=!1,e.play=function(){e.playing||(i(),h=setInterval(function(){i()}.bind(this),t),e.playing=!0)},e.stop=function(){e.playing&&(clearInterval(h),e.playing=!1)},e}function E(h=0,s=0,r=()=>_(10,"red"),i=10,a=0,e=!0,o=0,n=6.28,l=4,d=16,c=.1,g=1,f=.01,u=.05,p=.02,y=.02,v=.01,w=.03){let m=(t,i)=>t+Math.random()*(i-t),x=(t,i)=>Math.floor(Math.random()*(i-t+1))+t;var X=[];let Y;var b=(n-o)/(i-1);for(let t=0;t<i;t++)e?(Y=m(o,n),X.push(Y)):(void 0===Y&&(Y=o),X.push(Y),Y+=b);X.forEach(i=>{{let t=r();0<t.frames.length&&t.gotoAndStop(x(0,t.frames.length-1)),t.x=h-t.halfWidth,t.y=s-t.halfHeight;var e=x(l,d),e=(t.width=e,t.height=e,t.scaleSpeed=m(f,u),t.alphaSpeed=m(p,y),t.rotationSpeed=m(v,w),m(c,g));t.vx=e*Math.cos(i),t.vy=e*Math.sin(i),t.update=()=>{t.vy+=a,t.x+=t.vx,t.y+=t.vy,0<t.scaleX-t.scaleSpeed&&(t.scaleX-=t.scaleSpeed),0<t.scaleY-t.scaleSpeed&&(t.scaleY-=t.scaleSpeed),t.rotation+=t.rotationSpeed,t.alpha-=t.alphaSpeed,t.alpha<=0&&(S(t),F.splice(F.indexOf(t),1))},F.push(t)}})}function B(t,i,e,h=0,s=0){let r,a;a=e.frame?(r=e.frame.w,e.frame.h):(r=e.width,e.height);let o,n,l=(o=t>=r?Math.round(t/r)+1:2,n=i>=a?Math.round(i/a)+1:2,C(o,n,r,a,!1,0,0,()=>{return X(e)}));l._tileX=0,l._tileY=0;t=d(t,i,"none","none");return t.x=h,t.y=s,t.mask=!0,t.addChild(l),Object.defineProperties(t,{tileX:{get(){return l._tileX},set(e){l.children.forEach(t=>{var i=e-l._tileX;t.x+=i,t.x>(o-1)*r&&(t.x=0-r+i),t.x<0-r-i&&(t.x=(o-1)*r)}),l._tileX=e%l.width},enumerable:!0,configurable:!0},tileY:{get(){return l._tileY},set(e){l.children.forEach(t=>{var i=e-l._tileY;t.y+=i,t.y>(n-1)*a&&(t.y=0-a+i),t.y<0-a-i&&(t.y=(n-1)*a)}),l._tileY=e%l.height},enumerable:!0,configurable:!0}}),t}let A=[];function H(t,i=16,e=!1){let h=1,s=t.x,r=t.y,a=t.rotation,o=i/10,n=(t,i)=>Math.floor(Math.random()*(i-t+1))+t;-1===A.indexOf(t)&&(A.push(t),t.updateShake=()=>{e?(h<10&&(t.rotation=a,i-=o,t.rotation=i*l,h+=1,l*=-1),10<=h&&(t.rotation=a,A.splice(A.indexOf(t),1))):(h<10&&(t.x=s,t.y=r,i-=o,t.x+=n(-i,i),t.y+=n(-i,i),h+=1),10<=h&&(t.x=s,t.y=r,A.splice(A.indexOf(t),1)))});let l=1}var T={maxWidth:0,height:0,backgroundColor:"black",foregroundColor:"white",backBar:null,frontBar:null,percentage:null,loading:null,assets:null,initialized:!1,counter:0,canvas:void 0,gif:[],interval:void 0,loop:0,setBackgroundColor:function(t){this.backgroundColor=t},setForegroundColor:function(t){this.foregroundColor=t},create(t,i,e,h){this.width=e,this.height=h,this.counter=0,this.canvas=t,this.initialized||(this.assets=i,this.maxWidth=t.width/2,this.backBar=d(this.maxWidth,this.height,this.backgroundColor),this.backBar.x=t.width/2-this.maxWidth/2,this.backBar.y=t.height/4*3-this.height/2,this.backBar.radius=40,this.backBar.rounded=!0,this.frontBar=d(0,this.height-40,this.foregroundColor),this.frontBar.x=t.width/2-this.maxWidth/2,this.frontBar.y=t.height/4*3-this.height/2+20,this.frontBar.radius=20,this.frontBar.rounded=!0,this.percentage=f("0%","24px sans-serif","black"),this.percentage.x=t.width/2,this.percentage.y=t.height/4*3-this.height/2+40,this.loading=f("Loading ","48px sans-serif","black"),this.loading.x=t.width/2-100,this.loading.y=t.height/4*3-this.backBar.height-40,this.initialized=!0)},update(){this.counter++;let t=(this.assets.loaded+1)/this.assets.toLoad;0===this.assets.toLoad?t=1:(this.loading.content=this.loading.content+".",this.counter%10==0&&(this.loading.content="Loading ")),this.frontBar.width=this.maxWidth*t,this.percentage.content=Math.floor(100*t)+" %"},remove(){S(this.frontBar),S(this.backBar),S(this.percentage),S(this.loading),clearInterval(this.interval),this.gif.forEach(t=>S(t)),this.gif=[]}};export{i as buttons,e as draggableSprites,l as stage,h as makeCanvas,s as frame,n as frames,S as remove,d as rectangle,_ as circle,r as line,f as text,x as group,X as sprite,y as spriteNewTransform,w as render,m as renderWithInterpolation,b as button,C as grid,W as gridSpecial,O as filmstrip,F as particles,M as emitter,E as particleEffect,B as tilingSprite,A as shakingSprites,H as shake,T as progressBar};