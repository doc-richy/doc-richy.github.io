import{contain}from"./utilities.js";import"../typedef.js";let buttons=[],draggableSprites=[];class DisplayObject{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.pivotX=0,this.pivotY=0,this.vx=0,this.vy=0,this._layer=0,this._gridX=0,this._gridY=0,this._type=void 0,this.children=[],this.parent=void 0,this.shadow=!1,this.shadowColor="rgba(100, 100, 100, 0.5",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.blendMode=void 0,this.frames=[],this.loop=!0,this._currentFrame=0,this.playing=!1,this._draggable=void 0,this._circular=!1,this._interactive=!1,this._polygon=void 0,this._points=[]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}get layer(){return this._layer}set layer(t){this._layer=t,this.parent&&this.parent.children.sort((t,e)=>t.layer-e.layer)}set gridX(t){this._gridX=t}get gridX(){return this._gridX}set gridY(t){this._gridY=t}get gridY(){return this._gridY}set type(t){this._type=t}get type(){return this._type}addChild(t){t.parent&&t.parent.removeChild(t),(t.parent=this).children.push(t)}removeChild(t){if(t.parent!==this)throw new Error(t+" is not a child of "+this);this.children.splice(this.children.indexOf(t),1)}get halfWidth(){return this.width/2}get halfHeight(){return this.height/2}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}setPosition(t,e){this.x=t,this.y=e}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get empty(){return 0===this.children.length}putCenter(t,e=0,i=0){var h=this;t.x=h.x+h.halfWidth-t.halfWidth+e,t.y=h.y+h.halfHeight-t.halfHeight+i}putTop(t,e=0,i=0){var h=this;t.x=h.x+h.halfWidth-t.halfWidth+e,t.y=h.y-t.height+i}putRight(t,e=0,i=0){var h=this;t.x=h.x+h.width+e,t.y=h.y+h.halfHeight-t.halfHeight+i}putBottom(t,e=0,i=0){var h=this;t.x=h.x+h.halfWidth-t.halfWidth+e,t.y=h.y+h.height+i}putLeft(t,e=0,i=0){var h=this;t.x=h.x-t.width+e,t.y=h.y+h.halfHeight-t.halfHeight+i}swapChildren(t,e){var i=this.children.indexOf(t),h=this.children.indexOf(e);if(-1===i||-1===h)throw Error("Both objects must be a child of the caller "+this);t.childIndex=h,e.childIndex=i,this.children[i]=e,this.children[h]=t}swapSpritePosition(t,e){var i=e.x,h=e.y,s=e.gridX,r=e.gridY;if(-1===this.children.indexOf(t)||-1===this.children.indexOf(e))throw Error("Both objects must be a child of the caller "+this);e.x=t.x,e.y=t.y,e.gridX=t.gridX,e.gridY=t.gridY,t.x=i,t.y=h,t.gridX=s,t.gridY=r}add(...t){t.forEach(t=>this.addChild(t))}remove(...t){t.forEach(t=>this.removeChild(t))}get currentFrame(){return this._currentFrame}get circular(){return this._circular}set circular(t){!0===t&&!1===this._circular&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(t){this.width=t,this.height=t},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(t){this.width=2*t,this.height=2*t},enumerable:!0,configurable:!0}}),this._circular=!0),!1===t&&!0===this._circular&&(delete this.diameter,delete this.radius,this._circular=!1)}get draggable(){return this._draggable}set draggable(t){!0===t&&(draggableSprites.push(this),this._draggable=!0),!1===t&&draggableSprites.splice(draggableSprites.indexOf(this),1)}get interactive(){return this._interactive}set interactive(t){!0===t&&(makeInteractive(this),buttons.push(this),this._interactive=!0),!1===t&&this.interactive&&(buttons.splice(buttons.indexOf(this),1),this._interactive=!1)}get polygon(){return this._polygon}set polygon(t){!0===t&&(this._polygon=!0),!1===t&&(buttons.splice(buttons.ondexOf(this),1),this._polygon=!1)}get points(){return this._points}set points(t){if(!(t instanceof Array))throw new Error("The points is not an Array, it's a "+typeof t);this._points=JSON.parse(JSON.stringify(t)),!1===t&&(buttons.splice(buttons.ondexOf(this),1),this._points=[],this._polygon=!1)}removeAll(...t){t.forEach(t=>{t.parent.removeChild(t)})}}let stage=new DisplayObject;function makeCanvas(t=256,e=256,i="1px dashed black",h="none"){var s=document.createElement("canvas");return s.width=t,s.height=e,s.style.border=i,s.style.backgroundColor=h,s.ctx=s.getContext("2d"),document.body.appendChild(s),s}function frame(t,e,i,h,s){var r={};return r.image=t,r.x=e,r.y=i,r.width=h,r.height=s,r}function frames(t,e,i,h){var s={};return s.image=t,s.data=e,s.width=i,s.height=h,s}function remove(...t){t.forEach(t=>{t.parent.removeChild(t)})}class Rectangle extends DisplayObject{constructor(t=32,e=32,i="black",h="none",s=0,r=0,a=0,o=!1,n=0){super(),Object.assign(this,{width:t,height:e,fillStyle:i,strokeStyle:h,lineWidth:s,x:r,y:a,rounded:o,radius:n}),this.mask=!1}render(t){var e,i,h,s,r,a,o,n;t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),this.rounded?(this.width<2*this.radius&&(this.radius=this.width/2),this.height<2*this.radius&&(this.radius=this.height/2),e=-this.width*this.pivotX+this.width,i=-this.height*this.pivotY,h=-this.width*this.pivotX+this.width,s=-this.height*this.pivotY+this.height,r=-this.width*this.pivotX,a=-this.height*this.pivotY+this.height,o=-this.width*this.pivotX,n=-this.height*this.pivotY,t.moveTo(-this.width*this.pivotX+this.radius,i),t.arcTo(e,i,h,s,this.radius),t.arcTo(h,s,r,a,this.radius),t.arcTo(r,a,o,n,this.radius),t.arcTo(o,n,e,i,this.radius),t.closePath()):t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&!0===this.mask&&t.clip()}}function rectangle(t,e,i,h,s,r,a){t=new Rectangle(t,e,i,h,s,r,a);return stage.addChild(t),t}class Circle extends DisplayObject{constructor(t=32,e="gray",i="none",h=0,s=0,r=0){super(),this.circular=!0,Object.assign(this,{diameter:t,fillStyle:e,strokeStyle:i,lineWidth:h,x:s,y:r}),this.mask=!1}render(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&!0===this.mask&&t.clip()}}function circle(t,e,i,h,s,r){t=new Circle(t,e,i,h,s,r);return stage.addChild(t),t}class Line extends DisplayObject{constructor(t="none",e=0,i=0,h=0,s=32,r=32){super(),this.circular=!0,Object.assign(this,{strokeStyle:t,lineWidth:e,ax:i,ay:h,bx:s,by:r}),this.lineJoin="round"}render(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineJoin=this.lineJoin,t.beginPath(),t.moveTo(this.ax,this.ay),t.lineTo(this.bx,this.by),"none"!==this.strokeStyle&&t.stroke()}}function line(t,e,i,h,s,r){t=new Line(t,e,i,h,s,r);return stage.addChild(t),t}class Text extends DisplayObject{constructor(t="Hello",e="12px sans-sherif",i="red",h=0,s=0){super(),Object.assign(this,{content:t,font:e,fillStyle:i,x:h,y:s}),this.textBaseline="top",this.strokeText="none"}render(t){this.visible&&(t.font=this.font,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,0===this.width&&(this.width=t.measureText(this.content).width),0===this.height&&(this.height=t.measureText("M").width),t.translate(-this.width*this.pivotX,-this.height*this.pivotY),t.textBaseline=this.textBaseline,t.fillText(this.content,0,0),"none"!==this.strokeText)&&t.strokeText()}}function text(t,e,i,h,s){t=new Text(t,e,i,h,s);return stage.addChild(t),t}class Group extends DisplayObject{constructor(...t){super(),t.forEach(t=>this.addChild(t))}addChild(t){t.parent&&t.parent.removeChild(t),(t.parent=this).children.push(t),this.calculateSize()}removeChild(t){if(t.parent!==this)throw new Error(t+" is not a child of "+this);this.children.splice(this.children.indexOf(t),1),this.calculateSize()}calculateSize(){0<this.children.length&&(this._newWidth=0,this._newHeight=0,this.children.forEach(t=>{t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)}),this.width=this._newWidth,this.height=this._newHeight)}}function group(...t){t=new Group(...t);return stage.addChild(t),t}class Sprite extends DisplayObject{constructor(t,e=0,i=0){if(super(),Object.assign(this,{x:e,y:i}),t instanceof Image)this.createFromImage(t);else if(t.frame)this.createFromAtlas(t);else if(t.image&&!t.data)this.createFromTileset(t);else if(t.image&&t.data)this.createFromTilesetFrames(t);else{if(!(t instanceof Array))throw new Error(`The image source ${t} is not recognized`);if(t[0]&&t[0].source)this.createFromAtlasFrames(t)`;`;else{if(!(t[0]instanceof Image))throw new Error(`The image sources in ${t} are not recognized`);this.createFromImages(t)}}}createFromImage(t){if(!(t instanceof Image))throw new Error(t+" is not an image object");this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromTileset(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.sourceX=t.x,this.sourceY=t.y,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromTilesetFrames(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.frames=t.data,this.sourceX=this.frames[0][0],this.sourceY=this.frames[0][1],this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlasFrames(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceWidth=t[0].frame.h}createFromImages(t){this.frames=t,this.source=t[0],this.sourceX=0,this.sourceY=0,this.width=t[0].width,this.height=t[0].height,this.sourceWidth=t[0].width,this.sourceHeight=t[0].height}gotoAndStop(t){if(!(0<this.frames.length&&t<this.frames.length))throw new Error(`Frame number ${t} does not exist`);this.frames[0]instanceof Array?(this.sourceX=this.frames[t][0],this.sourceY=this.frames[t][1]):this.frames[t].frame?(this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.sourceWidth=this.frames[t].frame.w,this.sourceHeight=this.frames[t].frame.h,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h):(this.source=this.frames[t],this.sourceX=0,this.sourceY=0,this.width=this.source.width,this.height=this.source.height,this.sourceWidth=this.source.width,this.sourceHeight=this.source.height),this._currentFrame=t}render(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}function sprite(t,e,i){t=new Sprite(t,e,i);return 0<t.frames.length&&addStatePlayer(t),stage.addChild(t),t}function spriteNewTransform(t,e){var i=document.createElement("canvas");return i.width=90,i.height=90,i.getContext("2d").drawImage(t.source,0,0,90,90),t=i.toDataURL("png"),console.log("data url ",t),(i=new Image).width=i.height=90,i.src=t,console.log("width",i.width),sprite(i)}let grd=void 0;function render(i){let h=i.ctx;grd||((grd=h.createLinearGradient(0,0,0,i.height)).addColorStop(0,"#F7E9B8"),grd.addColorStop(1,"#FFEC4B")),h.fillStyle=grd,h.fillRect(0,0,i.width,i.height),stage.children.forEach(t=>{!function e(t){t.visible&&t.gx<i.width+t.width&&t.gx+t.width>=-t.width&&t.gy<i.height+t.height&&t.gy+t.height>=-t.height&&(h.save(),h.translate(t.x+t.width*t.pivotX,t.y+t.height*t.pivotY),h.rotate(t.rotation),h.globalAlpha=t.alpha*t.parent.alpha,h.scale(t.scaleX,t.scaleY),t.shadow&&(h.shadowColor=t.shadowColor,h.shadowOffsetX=t.shadowOffsetX,h.shadowOffsetY=t.shadowOffsetY,h.shadowBlur=t.shadowBlur),t.blendMode&&(h.globalCompositeOperation=t.blendMode),t.render&&t.render(h),t.children&&0<t.children.length&&(h.translate(-t.width*t.pivotX,-t.height*t.pivotY),t.children.forEach(t=>{e(t)})),h.restore())}(t)})}function renderWithInterpolation(i,h){let s=i.ctx;s.clearRect(0,0,i.width,i.height),stage.children.forEach(t=>{!function e(t){t.visible&&t.gx<i.width+t.width&&t.gx+t.width>-t.width&&t.gy<i.height+t.height&&t.gy+t.height>-t.height&&(s.save(),void 0!==t.previousX?t.renderX=(t.x-t.previousX)*h+t.previousX:t.renderX=t.x,void 0!==t.previousY?t.renderY=(t.y-t.previousY)*h+t.previousY:t.renderY=t.y,s.translate(t.renderX+t.width*t.pivotX,t.renderY+t.height*t.pivotY),s.rotate(t.rotation),s.globalAlpha=t.alpha*t.parent.alpha,s.scale(t.scaleX,t.scaleY),t.shadow&&(s.shadowColor=t.shadowColor,s.shadowOffsetX=t.shadowOffsetX,s.shadowOffsetY=t.shadowOffsetY,s.shadowBlur=t.shadowBlur),t.blendMode&&(s.globalCompositeOperation=t.blendMode),t.render&&t.render(s),t.children&&0<t.children.length&&(s.translate(-t.width*t.pivotX,-t.height*t.pivotY),t.children.forEach(t=>{e(t)})),s.restore())}(t)})}class Button extends Sprite{constructor(t,e,i=0,h=0){super(t,i,h),this.interactive=!0,e instanceof Array&&(this.polygon=!0,this.points=JSON.parse(JSON.stringify(e)))}}function button(t,e,i,h){t=new Button(t,e,i,h);return stage.addChild(t),t}function makeInteractive(h){h.press=h.press||void 0,h.release=h.release||void 0,h.over=h.over||void 0,h.out=h.out||void 0,h.tap=h.tap||void 0,h.state="up",h.action="",h.pressed=!1,h.hoverOver=!1,h.update=(t,e)=>{let i;i=h.polygon?t.hitTestPolygon(h.points):t.hitTestSprite(h),t.isUp&&(h.state="up",h instanceof Button)&&h.gotoAndStop(0),i&&(h.state="over",h.frames&&3===h.frames.length&&h instanceof Button&&h.gotoAndStop(1),t.isDown)&&(h.state="down",h instanceof Button)&&(3===h.frames.length?h.gotoAndStop(2):h.gotoAndStop(1)),"down"!==h.state||h.pressed||(h.press&&h.press(),h.pressed=!0,h.action="pressed"),"over"===h.state&&(h.pressed&&(h.release&&h.release(),h.pressed=!1,h.action="released",t.tapped)&&h.tap&&h.tap(),h.hoverOver||(h.over&&h.over(),h.hoverOver=!0)),"up"===h.state&&(h.pressed&&(h.release&&h.release(),h.pressed=!1,h.action="released"),h.hoverOver)&&(h.out&&h.out(),h.hoverOver=!1)}}function grid(e=0,t=0,i=32,h=32,s=!1,r=0,a=0,o=void 0,n=void 0){let l=group();var d=e*t;for(let t=0;t<d;t++){var c=t%e*i,g=Math.floor(t/e)*h,p=o();l.addChild(p),s?(p.x=c+i/2-p.halfWidth+r,p.y=g+h/2-p.halfHeight+a):(p.x=c+r,p.y=g+a),n&&n(p)}return l}function gridSpecial(h=0,t=0,s=32,r=32,a="",o=[],n,l,d,c=!1,g=0,p=0,u=void 0){let f=group(),m=[],e;if(0===l.length)for(let t=0;t<16;t++)(e=sprite(o[t+5],-30*s,0)).scaleX=e.scaleY=d,e.pivotX=e.pivotY=0,e.type="yo",e.gridX=-10,e.gridY=-10,e.visible=!1,e.layer=3,c?(e.x=s/2-s-e.halfWidth+g,e.y=0+r/2-e.halfHeight+p):(e.x=-s+g,e.y=0+p),l.push(e);{var y=h*t;let i=void 0;for(let e=0;e<y;e++){var v=e%h*s,w=Math.floor(e/h)*r;let t;if("0"===a.charAt(e))(t=sprite(o[1],v,w)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="road",t.gridX=e%h,t.gridY=Math.floor(e/h),l[4].gridX=e%h,l[4].gridY=Math.floor(e/h),l[4].x=v,l[4].y=w,l[4].visible=!0;else if("1"===a.charAt(e))(t=sprite(o[1],v,w)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="road",t.gridX=e%h,t.gridY=Math.floor(e/h);else if("2"===a.charAt(e))(t=sprite(o[2],v,w)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="forest",t.gridX=e%h,t.gridY=Math.floor(e/h),t.canMove=!1,t.yo=!1;else{if("3"===a.charAt(e))(t=sprite(o[1],v,w)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="box",t.gridX=e%h,t.gridY=Math.floor(e/h),t.canMove=!0,(i=sprite(o[3],v,w)).scaleX=i.scaleY=d,i.pivotX=t.pivotY=0,i.type="box",i.gridX=e%h,i.gridY=Math.floor(e/h),i.canMove=!1,i.yo=!1,i.level=1;else{if("4"!==a.charAt(e))throw Error(a.charAt(e)+" is not allowed for character level");n.bananasToEat+=1,(t=sprite(o[1],v,w)).scaleX=t.scaleY=d,t.pivotX=t.pivotY=0,t.type="bananas",t.gridX=e%h,t.gridY=Math.floor(e/h),t.canMove=!1,t.yo=!1,(i=sprite(o[4],v,w)).scaleX=i.scaleY=d,i.pivotX=t.pivotY=0,i.type="bananas",i.gridX=e%h,i.gridY=Math.floor(e/h),i.canMove=!0,i.yo=!1,i.level=2}m.push(i)}f.addChild(t),c?(t.x=v+s/2-t.halfWidth+g,t.y=w+r/2-t.halfHeight+p):(t.x=v+g,t.y=w+p),u&&u(t)}m.forEach(t=>{c?(t.x=t.x+s/2-t.halfWidth+g,t.y=t.y+r/2-t.halfHeight+p):(t.x=t.x+g,t.y=t.y+p),f.addChild(t)}),l.forEach(t=>f.addChild(t))}return f}function filmstrip(t,h,s,r=0){var a=[],o=t.width/h,e=o*(t.height/s);for(let i=0;i<e;i++){let t=i%o*h,e=Math.floor(i/o)*s;r&&0<r&&(t+=r+r*i%o,e+=r+r*Math.floor(i/o)),a.push([t,e])}return frames(t,a,h,s)}function addStatePlayer(e){let i=0,h=0,s=0,r=0,a=void 0;function t(t){o(),s=t[0],r=t[1],h=r-s,0===s&&(h+=1,i+=1),1===h&&(h=2,i+=1),e.fps||(e.fps=12);t=1e3/e.fps;e.gotoAndStop(s),e.playing||(a=setInterval(function(){i<h?(e.gotoAndStop(e.currentFrame+1),i+=1):e.loop&&(e.gotoAndStop(s),i=1)}.bind(this),t),e.playing=!0)}function o(){void 0!==a&&!0===e.playing&&(e.playing=!1,i=0,s=0,r=0,h=0,clearInterval(a))}e.show=function(t){o(),e.gotoAndStop(t)},e.play=function(){t([0,e.frames.length-1])},e.stop=function(){o(),e.gotoAndStop(e.currentFrame)},e.playSequence=t}let particles=[];function emitter(t,e){let i={},h=void 0;return i.playing=!1,i.play=function(){i.playing||(e(),h=setInterval(function(){e()}.bind(this),t),i.playing=!0)},i.stop=function(){i.playing&&(clearInterval(h),i.playing=!1)},i}function particleEffect(h=0,s=0,r=()=>circle(10,"red"),e=10,a=0,i=!0,o=0,n=6.28,l=4,d=16,c=.1,g=1,p=.01,u=.05,f=.02,m=.02,y=.01,v=.03){let w=(t,e)=>t+Math.random()*(e-t),x=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;var b=[];let S;var X=(n-o)/(e-1);for(let t=0;t<e;t++)i?(S=w(o,n),b.push(S)):(void 0===S&&(S=o),b.push(S),S+=X);b.forEach(e=>{{let t=r();0<t.frames.length&&t.gotoAndStop(x(0,t.frames.length-1)),t.x=h-t.halfWidth,t.y=s-t.halfHeight;var i=x(l,d),i=(t.width=i,t.height=i,t.scaleSpeed=w(p,u),t.alphaSpeed=w(f,m),t.rotationSpeed=w(y,v),w(c,g));t.vx=i*Math.cos(e),t.vy=i*Math.sin(e),t.update=()=>{t.vy+=a,t.x+=t.vx,t.y+=t.vy,0<t.scaleX-t.scaleSpeed&&(t.scaleX-=t.scaleSpeed),0<t.scaleY-t.scaleSpeed&&(t.scaleY-=t.scaleSpeed),t.rotation+=t.rotationSpeed,t.alpha-=t.alphaSpeed,t.alpha<=0&&(remove(t),particles.splice(particles.indexOf(t),1))},particles.push(t)}})}function tilingSprite(t,e,i,h=0,s=0){let r,a;a=i.frame?(r=i.frame.w,i.frame.h):(r=i.width,i.height);let o,n,l=(o=t>=r?Math.round(t/r)+1:2,n=e>=a?Math.round(e/a)+1:2,grid(o,n,r,a,!1,0,0,()=>{return sprite(i)}));l._tileX=0,l._tileY=0;t=rectangle(t,e,"none","none");return t.x=h,t.y=s,t.mask=!0,t.addChild(l),Object.defineProperties(t,{tileX:{get(){return l._tileX},set(i){l.children.forEach(t=>{var e=i-l._tileX;t.x+=e,t.x>(o-1)*r&&(t.x=0-r+e),t.x<0-r-e&&(t.x=(o-1)*r)}),l._tileX=i%l.width},enumerable:!0,configurable:!0},tileY:{get(){return l._tileY},set(i){l.children.forEach(t=>{var e=i-l._tileY;t.y+=e,t.y>(n-1)*a&&(t.y=0-a+e),t.y<0-a-e&&(t.y=(n-1)*a)}),l._tileY=i%l.height},enumerable:!0,configurable:!0}}),t}let shakingSprites=[];function shake(t,e=16,i=!1){let h=1,s=t.x,r=t.y,a=t.rotation,o=e/10,n=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;-1===shakingSprites.indexOf(t)&&(shakingSprites.push(t),t.updateShake=()=>{i?(h<10&&(t.rotation=a,e-=o,t.rotation=e*l,h+=1,l*=-1),10<=h&&(t.rotation=a,shakingSprites.splice(shakingSprites.indexOf(t),1))):(h<10&&(t.x=s,t.y=r,e-=o,t.x+=n(-e,e),t.y+=n(-e,e),h+=1),10<=h&&(t.x=s,t.y=r,shakingSprites.splice(shakingSprites.indexOf(t),1)))});let l=1}let progressBar={maxWidth:0,height:0,backgroundColor:"black",foregroundColor:"white",backBar:null,frontBar:null,percentage:null,loading:null,assets:null,initialized:!1,counter:0,canvas:void 0,gif:[],interval:void 0,loop:0,setBackgroundColor:function(t){this.backgroundColor=t},setForegroundColor:function(t){this.foregroundColor=t},create(t,e,i,h){this.width=i,this.height=h,this.counter=0,this.canvas=t,this.initialized||(this.assets=e,this.maxWidth=t.width/2,this.backBar=rectangle(this.maxWidth,this.height,this.backgroundColor),this.backBar.x=t.width/2-this.maxWidth/2,this.backBar.y=t.height/4*3-this.height/2,this.backBar.radius=40,this.backBar.rounded=!0,this.frontBar=rectangle(0,this.height-40,this.foregroundColor),this.frontBar.x=t.width/2-this.maxWidth/2,this.frontBar.y=t.height/4*3-this.height/2+20,this.frontBar.radius=20,this.frontBar.rounded=!0,this.percentage=text("0%","24px sans-serif","black"),this.percentage.x=t.width/2,this.percentage.y=t.height/4*3-this.height/2+40,this.loading=text("Loading ","48px sans-serif","black"),this.loading.x=t.width/2-100,this.loading.y=t.height/4*3-this.backBar.height-40,this.initialized=!0)},update(){this.counter++;let t=(this.assets.loaded+1)/this.assets.toLoad;0===this.assets.toLoad?t=1:(this.loading.content=this.loading.content+".",this.counter%10==0&&(this.loading.content="Loading ")),this.frontBar.width=this.maxWidth*t,this.percentage.content=Math.floor(100*t)+" %"},remove(){remove(this.frontBar),remove(this.backBar),remove(this.percentage),remove(this.loading),clearInterval(this.interval),this.gif.forEach(t=>remove(t)),this.gif=[]}};export{buttons,draggableSprites,stage,makeCanvas,frame,frames,remove,rectangle,circle,line,text,group,sprite,spriteNewTransform,render,renderWithInterpolation,button,grid,gridSpecial,filmstrip,particles,emitter,particleEffect,tilingSprite,shakingSprites,shake,progressBar};