import{game}from"./engine.js";import*as scene from"./level.js";import*as moveModule from"./move.js";import"./typedef.js";let main=document.getElementById("main"),infoDiv=document.getElementById("infodiv"),infoIframe=document.getElementById("infoframe"),video=document.getElementById("wait-video"),std={scaleCanvas:1,scaleX:1,scaleY:2,boxSize:90,boxViewQuantity:12,scaleFactor:()=>std.boxSize/512,quota:void 0},gameInfo={t:0,s:0,b:-1},gameInfoLast={t:0,bt:-1,s:0,bs:-1,b:-1,bb:-1},dataSave=[],data=void 0,isSaved=!1,isExit=!1,fromOpen=!1,fromSave=!1,btn_1=document.getElementById("btn-1"),btn_2=document.getElementById("btn-2"),menu=document.getElementsByClassName("floating-menu")[0],btn_2_hideS_up,btn_2_hideS_over,btn_2_showS_up,btn_2_showS_over,isSoundOn=!1,gameWidth=1920,gameHeight=1080,cellWidth=90,cellHeight=90,gridWidth=12,gridHeight=12,stepWidth=64,scaleButton=.2,scalePad=.75,estimateKeyboard=[[{s:70,t:15.93,csec:15930},{s:106,t:80.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}],[{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}],[{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}]],estimateCell=[[{s:65,t:1918.02},{s:76,t:80.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}],[{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}],[{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}]],music,bounceSound,message,titleScene,title,playButton,resetButton,infoButton,menuShow,menuHide,fullscreenState,levelInfoBox,levelMsg,levelUpButton,levelDownButton,levelInfoBoxGroup,sceneInfoBox,sceneMsg,sceneUpButton,sceneDownButton,sceneInfoBoxGroup,blocks,arrayImages,img1,gameScene,img2,img3,blocksImg_12,blocksImg_14,blocksImg_16,infoBox1,msgGroup,msg11,msg21,msg31,MsgInfo,MsgInfo1,MsgInfo2,homeButton,restartButton,saveToDiskButton,pauseButton,pauseOnButton,saveButton,saveButtonCancel,saveInButton,saveOutButton,replay,replaySpeed=100,slow,fast,veryFast,checkedBoxButton_0,checkedBoxButton_1,checkedBoxButton_2,checkedImg,checkedGroup,checkedChoice=1,saveGroup,saveOkCancelGroup,saveMsgGroup,saveImgBorder,saveImgInBorder,saveMsg_1,saveMsg_2,saveMsg_3,saveMsg_4,saveMsg_5,saveMsg_6,saveMsg_11,saveMsg_21,saveMsg_31,saveOkButton,saveCancelButton,infoGameButton,infoBox1Group,infoBox2,msgGroup2,infoBox2Group,infoBox3,infoBox3Group,infoBox4,msg41,sceneMsgDim=["12x12","14x14","16x16"],msg42,infoBox4Group,groupInfo,secondPage,infoGamePNG,infoGameMsg,infoGameGroup,yo={},walk=[],stepArray=[],scenePlaying=1,levelPlaying=1,levelToPlay=scene.level[scenePlaying-1][levelPlaying-1],scaleAllButtons=1,scaleText=1,intervalId=setInterval(()=>g.progressBar.update(),5),padDimension=(document.addEventListener("myProper",e=>console.log("From my proper ",e.text)),512),padArray=[],buttonsMoveArr=[],buttonsToShowHide=[],pad_1_group,pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_group,pad_2_up,pad_2_down,pad_2_right,pad_2_left,isMobile=/Mobile/i.test(navigator.userAgent),pixelRatio=window.devicePixelRatio.toFixed(2),isTouch=!1,g=(("ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints||"ontouchstart"in document.documentElement||"touchstart"in document.documentElement)&&(isTouch=!0),isMobile&&(scaleText=3.5<=pixelRatio&&pixelRatio<=4.2?scaleAllButtons=1.2:2.8<=pixelRatio&&pixelRatio<3.5?(scaleAllButtons=1.5,1.2):(scaleAllButtons=1.6,1.5)),new game(gameWidth,gameHeight,setup,["images/walk_512.json","images/info_box.png","images/info_level_box.png","images/view_420x1080.png","images/blocksBorder_12x12.png","images/blocksBorder_14x14.png","images/blocksBorder_16x16.png","images/b_info_up.png","images/b_info_over.png","images/b_scene_up.png","images/b_scene_over.png","images/b_scene_top_up.png","images/b_scene_top_over.png","images/b_play_up.png","images/b_play_over.png","images/b_reset.png","images/infogame.png","images/yo_level_512.png","images/save_img.png","images/save_img_in.png","images/save_ok_512_up.png","images/save_ok_512_over.png","images/save_cancel_512_up.png","images/save_cancel_512_over.png","images/save_512_up.png","images/save_512_over.png","images/save_512_in_up.png","images/save_512_in_over.png","images/save_512_out_up.png","images/save_512_out_over.png","images/infogame_512_up.png","images/infogame_512_over.png","images/restart_512_up.png","images/restart_512_over.png","images/pause_512_up.png","images/pause_512_over.png","images/pause_on_512_up.png","images/pause_on_512_over.png","images/home_512_up.png","images/home_512_over.png","images/menu_512_up.png","images/menu_512_over.png","images/menu_open_512_up.png","images/menu_open_512_over.png","images/road_512.png","images/forest_512.png","images/forest.png","images/forest24.jpg","images/box_512.png","images/bananas_0_512.png","images/bananas_512_neutral.png","images/fond_ecran_950.jpg","images/emoji_yo.png","sounds/bounce.wav","sounds/music.wav","fonts/puzzler.otf","images/pad_512_up_up.png","images/pad_512_up_over.png","images/pad_512_down_up.png","images/pad_512_down_over.png","images/pad_512_right_up.png","images/pad_512_right_over.png","images/pad_512_left_up.png","images/pad_512_left_over.png","images/step_512_neutral.png","images/time_512_neutral.png","images/fullscreen_on_512_up.png","images/fullscreen_on_512_over.png","images/fullscreen_off_512_up.png","images/fullscreen_off_512_over.png","images/sound_yes_240_up.png","images/sound_yes_240_over.png","images/sound_no_240_up.png","images/sound_no_240_over.png","images/b_about_up_128.png","images/b_about_over_128.png","images/checked_512_up.png","images/checked_512_over.png","images/checked_box_512.png"],load)),leftArrow=(main.appendChild(g.canvas),window.infoHide=e=>{infoDiv.classList.remove("show"),infoDiv.classList.add("hide")},window.about=e=>{infoIframe.src="./html_page/about.html"},window.general=e=>{infoIframe.src="./html_page/general.html"},window.buttonsExplained=e=>{infoIframe.src="./html_page/buttonsexplained.html"},window.spareButton=e=>{infoIframe.src="./html_page/sparebutton.html"},g.keyboard(37)),leftNumPad=g.keyboard(100),upArrow=g.keyboard(38),upNumPad=g.keyboard(104),rightArrow=g.keyboard(39),rightNumPad=g.keyboard(102),downArrow=g.keyboard(40),downNumPad=g.keyboard(98),wKey=g.keyboard(87),aKey=g.keyboard(65),sKey=g.keyboard(83),dKey=g.keyboard(68),iKey=g.keyboard(73),jKey=g.keyboard(74),kKey=g.keyboard(75),lKey=g.keyboard(76);function load(){0===g.progressBar.counter&&(g.progressBar.setBackgroundColor("#FFA80F"),g.progressBar.setForegroundColor("#FFEC4B"),g.progressBar.create(g.canvas,g.assets,g.canvas.width/2,100)),g.progressBar.update()}function setup(){document.body.removeChild(video),g.progressBar.remove(),clearInterval(intervalId),createButtonMenu(),arrayImages=[g.assets["walkDownRight.png"],g.assets["images/road_512.png"],g.assets["images/forest_512.png"],g.assets["images/box_512.png"],g.assets["images/bananas_0_512.png"],g.assets["walkUpRight.png"],g.assets["walkUpLeft.png"],g.assets["walkUpRightPush.png"],g.assets["walkUpLeftPush.png"],g.assets["walkDownRight.png"],g.assets["walkDownLeft.png"],g.assets["walkDownRightPush.png"],g.assets["walkDownLeftPush.png"],g.assets["walkRightRight.png"],g.assets["walkRightLeft.png"],g.assets["walkRightRightPush.png"],g.assets["walkRightLeftPush.png"],g.assets["walkLeftRight.png"],g.assets["walkLeftLeft.png"],g.assets["walkLeftRightPush.png"],g.assets["walkLeftLeftPush.png"]],yo.setVisible=()=>{walk.forEach(e=>{e===yo.activeSprite?e.visible=!0:(e.visible=!1,e.gridX=-10,e.gridY=-10)})},yo.layer=3,yo.bananasToEat=0,yo.move=moveModule.moveScene,initialiseMusic(),buildFirstPage(),buildGroupInfo1(),setFirstTime(1,1),buildSaveGoup(),updateCSSVariables(),rightArrow.press=rightNumPad.press=dKey.press=lKey.press=()=>{yo.move("right",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"r"})},upArrow.press=upNumPad.press=wKey.press=iKey.press=()=>{yo.move("up",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"u"})},leftArrow.press=leftNumPad.press=aKey.press=jKey.press=()=>{yo.move("left",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"l"})},downArrow.press=downNumPad.press=sKey.press=kKey.press=()=>{yo.move("down",blocks,yo,walk),stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"d"})},buttonsMoveArr=[upArrow,upNumPad,wKey,iKey,downArrow,downNumPad,sKey,kKey,rightArrow,rightNumPad,aKey,jKey,leftArrow,leftNumPad,dKey,lKey,pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_up,pad_2_down,pad_2_right,pad_2_left],g.setButtonsMove(buttonsMoveArr,pauseButton)}function play(){0===yo.bananasToEat&&(g.pause(),g.endGame(),g.wait(1e3).then(()=>end()))}function end(){music.volume=.3,updateGameInfo("end")}function homePress(){MsgInfo.visible=!0,MsgInfo1.visible=!0,MsgInfo2.visible=!0,infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)),resetAllParameters(scenePlaying,levelPlaying,"homePress"),updateFirstPage(scenePlaying,levelPlaying),g.slide(secondPage,-g.canvas.width,g.canvas.height,30,["decelerationCubed"]).onComplete=()=>{updatePolygonPoinst()},g.slide(titleScene,0,0,30,["decelerationCubed"]),g.endGame()}function stopAllPressed(){0!==gameInfo.t&&g.isPlaying?(pauseButton.visible?(g.pause(),pauseButton.visible=!1,pauseOnButton.visible=!0):(g.resume(),pauseButton.visible=!0,pauseOnButton.visible=!1),resetAllParameters(scenePlaying,levelPlaying,"restart"),g.slide(secondPage,0,0,30,["decelerationCubed"]),g.state=play):(pauseButton.visible=!0,pauseOnButton.visible=!1)}function restart(){resetAllParameters(scenePlaying,levelPlaying,"restart"),g.slide(secondPage,0,0,30,["decelerationCubed"]),g.state=play}function menuShowPress(){infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)),setTimeout(()=>{menuShow.visible?(menuShow.visible=!1,menuShow.interactive=!1,menuHide.visible=!0,menuHide.interactive=!0,g.fadeIn(menuHide,30),g.fadeOut(menuShow,30),menu.classList.remove("hide"),menu.classList.add("show")):(menuShow.visible=!0,menuShow.interactive=!0,menuHide.visible=!1,menuHide.interactive=!1,g.fadeIn(menuShow,30),g.fadeOut(menuHide,30),menu.classList.remove("show"),menu.classList.add("hide"))},200)}function savePress(){infoGameGroup.visible&&(infoGameGroup.visible=!1),updateSaveGoup(),g.slide(saveGroup,.5*g.canvas.width-380,.5*g.canvas.height-256,30)}function pausePressed(){infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)),pauseButton.visible?(pauseButton.visible=!1,pauseOnButton.visible=!0,setTimeout(()=>{pauseButton.interactive=!1,g.isPlaying&&g.pause(),pauseOnButton.interactive=!0,buttonsToShowHide.forEach((e,s)=>{s<=2?(e.visible=!0,e.interactive=!0):e.visible=!0})},200)):(pauseButton.visible=!0,pauseOnButton.visible=!1,setTimeout(()=>{pauseButton.interactive=!0,pauseOnButton.interactive=!1,buttonsToShowHide.forEach((e,s)=>{s<=2?(e.visible=!1,e.interactive=!1):e.visible=!1})},200))}function home(){resetAllParameters(scenePlaying,levelPlaying,"home"),updateFirstPage(scenePlaying,levelPlaying),g.slide(secondPage,-g.canvas.width,g.canvas.height,30,["decelerationCubed"]),g.slide(titleScene,0,0,30,["decelerationCubed"]),g.endGame(),end()}function resetAllParameters(e,s,t){if(e<1&&4<e)throw new Error(`This level : ${e} is not developped yet.`);if(1===e){if(s<1&&9<s)throw new Error(`This level : ${s} is not developped yet.`);gridWidth=gridHeight=12}else if(2===e){if(s<1&&9<s)throw new Error(`This levelToSet : ${s} is not developped yet.`);gridWidth=gridHeight=14}else{if(3!==e)throw new Error(`This scene : ${e} is not developped yet.`);if(s<1&&9<s)throw new Error(`This levelToSet : ${s} is not developped yet.`);gridWidth=gridHeight=16}if(levelToPlay=scene.level[e-1][s-1],levelPlaying=s,scenePlaying=e,saveGameInfoLast(),gameScene.remove(blocks),yo.bananasToEat=0,blocks=g.gridSpecial(gridWidth,gridHeight,cellWidth,cellHeight,levelToPlay,arrayImages,yo,walk,std.scaleFactor(),!1,0,0),yo.activeSprite=walk[4],yo.setVisible(),(stepArray=[]).push({x:yo.activeSprite.gridX,y:yo.activeSprite.gridY,d:"s"}),g.setYo(yo),g.setStepArray(stepArray),updateGameInfo("resetAll"),gameInfo.t=0,gameInfo.s=0,gameInfo.b=yo.bananasToEat,g.setGameInfo(gameInfo),updateGameInfoMsgs(),1===scenePlaying)blocksImg_12.visible=!0,blocksImg_14.visible=!1,blocksImg_16.visible=!1,blocks.addChild(blocksImg_12);else if(2===scenePlaying)blocksImg_12.visible=!1,blocksImg_14.visible=!0,blocksImg_16.visible=!1,blocks.addChild(blocksImg_14);else{if(3!==scenePlaying)throw new Error(`Scene playing : ${scenePlaying} not possible.`);blocksImg_12.visible=!1,blocksImg_14.visible=!1,blocksImg_16.visible=!0,blocks.addChild(blocksImg_16)}gameScene.addChild(blocks),moveModule.setScene(e,std),msg11.content=" "+(stepArray.length-1),msg31.content=" "+yo.bananasToEat}function setFirstTime(e,s){if(e<1&&3<e)throw new Error(`This level : ${e} is not developped yet.`);if(1===e){if(s<1&&9<s)throw new Error(`This level : ${s} is not developped yet.`);gridWidth=gridHeight=12}else if(2===e){if(s<1&&9<s)throw new Error(`This levelToSet : ${s} is not developped yet.`);gridWidth=gridHeight=14}else{if(3!==e)throw new Error(`This scene : ${e} is not developped yet.`);if(s<1&&9<s)throw new Error(`This levelToSet : ${s} is not developped yet.`);gridWidth=gridHeight=16}if(levelToPlay=scene.level[e-1][s-1],levelPlaying=s,scenePlaying=e,blocks=g.gridSpecial(gridWidth,gridHeight,cellWidth,cellHeight,levelToPlay,arrayImages,yo,walk,std.scaleFactor(),!1,0,0),yo.activeSprite=walk[4],yo.setVisible(),stepArray=[],g.setYo(yo),g.setStepArray(stepArray),gameInfo.b=yo.bananasToEat,g.setGameInfo(gameInfo),(img1=g.sprite(g.assets["images/forest24.jpg"])).layer=-1,img1.pivotX=0,img1.pivotY=0,blocksImg_12=g.sprite(g.assets["images/blocksBorder_12x12.png"]),blocksImg_14=g.sprite(g.assets["images/blocksBorder_14x14.png"]),blocksImg_16=g.sprite(g.assets["images/blocksBorder_16x16.png"]),blocksImg_12.layer=blocksImg_14.layer=blocksImg_16.layer=4,1===scenePlaying)blocksImg_12.visible=!0,blocksImg_14.visible=!1,blocksImg_16.visible=!1,blocks.addChild(blocksImg_12);else if(2===scenePlaying)blocksImg_12.visible=!1,blocksImg_14.visible=!0,blocksImg_16.visible=!1,blocks.addChild(blocksImg_14);else{if(3!==scenePlaying)throw new Error(`Scene playing : ${scenePlaying} not possible.`);blocksImg_12.visible=!1,blocksImg_14.visible=!1,blocksImg_16.visible=!0,blocks.addChild(blocksImg_16)}(gameScene=g.group(img1,blocks)).x=420,gameScene.layer=2,(secondPage=g.group(gameScene,groupInfo)).x=-g.canvas.width,secondPage.y=g.canvas.height,secondPage.layer=-1,updatePolygonPoinst(),moveModule.setScene(e,std),menuShowPress()}function initialiseMusic(){bounceSound=g.assets["sounds/bounce.wav"],(music=g.assets["sounds/music.wav"]).loop=!0}function buildFirstPage(){(MsgInfo=g.text("First","40px puzzler","deepskyblue")).y=g.canvas.height-135,(MsgInfo1=g.text("First","40px puzzler","deepskyblue")).y=g.canvas.height-90,(MsgInfo2=g.text("First","40px puzzler","deepskyblue")).y=g.canvas.height-45;(title=g.sprite(g.assets["images/fond_ecran_950.jpg"])).x=(g.canvas.width-title.width)/2,title.y=(g.canvas.height-title.height)/2,scenePlaying=scenePlaying||1,levelPlaying=levelPlaying||1;(menuHide=g.button([g.assets["images/menu_open_512_up.png"],g.assets["images/menu_open_512_over.png"],g.assets["images/menu_open_512_up.png"]])).x=10,menuHide.y=10,menuHide.pivotX=0,menuHide.pivotY=0,menuHide.scaleX=scaleButton,menuHide.scaleY=scaleButton,menuHide.layer=20,menuHide.visible=!1,menuHide.interactive=!1,menuHide.press=()=>menuShowPress(),(menuShow=g.button([g.assets["images/menu_512_up.png"],g.assets["images/menu_512_over.png"],g.assets["images/menu_512_up.png"]])).x=10,menuShow.y=10,menuShow.pivotX=0,menuShow.pivotY=0,menuShow.scaleX=scaleButton,menuShow.scaleY=scaleButton,menuShow.layer=20,menuShow.press=()=>menuShowPress(),sceneInfoBox=g.sprite(g.assets["images/info_level_box.png"]),(sceneMsg=g.text("12x12","50px puzzler","black",20,40)).content=sceneMsgDim[scenePlaying-1],sceneMsg.x=sceneInfoBox.width/4,sceneMsg.y=sceneInfoBox.height/2-25,(sceneUpButton=g.button([g.assets["images/b_scene_top_up.png"],g.assets["images/b_scene_top_over.png"],g.assets["images/b_scene_top_up.png"]])).x=sceneInfoBox.width/2-sceneUpButton.width/2,sceneUpButton.y=sceneInfoBox.height/4-sceneUpButton.height/2,sceneUpButton.press=()=>{scenePlaying<3&&(resetAllParameters(scenePlaying+=1,levelPlaying,"scenePress"),g.slide(sceneMsg,sceneMsg.x,sceneMsg.y-40,10,["smoothstep"]),g.fadeOut(sceneMsg,10),setTimeout(()=>{sceneMsg.content=sceneMsgDim[scenePlaying-1],sceneMsg.y+=80,g.slide(sceneMsg,sceneMsg.x,sceneInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(sceneMsg,15)},100))},(sceneDownButton=g.button([g.assets["images/b_scene_up.png"],g.assets["images/b_scene_over.png"],g.assets["images/b_scene_up.png"]])).x=sceneInfoBox.width/2-sceneDownButton.width/2,sceneDownButton.y=3*sceneInfoBox.height/4-sceneUpButton.height/2,sceneDownButton.press=()=>{1<scenePlaying&&(resetAllParameters(--scenePlaying,levelPlaying,"scenePress"),g.slide(sceneMsg,sceneMsg.x,sceneMsg.y+40,10,["smoothstep"]),g.fadeOut(sceneMsg,10),setTimeout(()=>{sceneMsg.content=sceneMsgDim[scenePlaying-1],sceneMsg.y-=80,g.slide(sceneMsg,sceneMsg.x,sceneInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(sceneMsg,15)},200))},(sceneInfoBoxGroup=g.group(sceneInfoBox,sceneMsg,sceneUpButton,sceneDownButton)).x=-g.canvas.width,sceneInfoBoxGroup.y=-g.canvas.height,levelInfoBox=g.sprite(g.assets["images/info_level_box.png"]),(levelMsg=g.text("Level "+levelPlaying,"50px puzzler","black",20,40)).x=sceneInfoBox.width/4,levelMsg.y=sceneInfoBox.height/2-25,(levelUpButton=g.button([g.assets["images/b_scene_top_up.png"],g.assets["images/b_scene_top_over.png"],g.assets["images/b_scene_top_up.png"]])).press=()=>{levelPlaying<9&&(levelPlaying+=1,resetAllParameters(scenePlaying,levelPlaying,"levelPress"),g.slide(levelMsg,levelMsg.x,levelMsg.y-40,10,["smoothstep"]),g.fadeOut(levelMsg,10),setTimeout(()=>{levelMsg.content="Level "+levelPlaying,levelMsg.y+=80,g.slide(levelMsg,levelMsg.x,levelInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(levelMsg,15)},100))},levelUpButton.x=levelInfoBox.width/2-levelUpButton.width/2,levelUpButton.y=levelInfoBox.height/4-levelUpButton.height/2,(levelDownButton=g.button([g.assets["images/b_scene_up.png"],g.assets["images/b_scene_over.png"],g.assets["images/b_scene_up.png"]])).x=levelInfoBox.width/2-levelDownButton.width/2,levelDownButton.y=3*levelInfoBox.height/4-levelUpButton.height/2,levelDownButton.press=()=>{1<levelPlaying&&(--levelPlaying,resetAllParameters(scenePlaying,levelPlaying,"levelPress"),g.slide(levelMsg,levelMsg.x,levelMsg.y+40,10,["smoothstep"]),g.fadeOut(levelMsg,10),setTimeout(()=>{levelMsg.content="Level "+levelPlaying,levelMsg.y-=80,g.slide(levelMsg,levelMsg.x,levelInfoBox.height/2-25,15,["smoothstep"]),g.fadeIn(levelMsg,15)},100))},levelMsg.y=levelInfoBox.height/2-25,(levelInfoBoxGroup=g.group(levelInfoBox,levelMsg,levelUpButton,levelDownButton)).x=g.canvas.width,levelInfoBoxGroup.y=-g.canvas.height,(infoButton=g.button([g.assets["images/b_info_up.png"],g.assets["images/b_info_over.png"],g.assets["images/b_info_up.png"]])).x=(g.canvas.width-title.width)/4-.5*infoButton.width*scaleAllButtons/2,infoButton.y=gameHeight-infoButton.width,infoButton.scaleX=.5*scaleAllButtons,infoButton.scaleY=.5*scaleAllButtons,infoButton.press=()=>{let e=g.rectangle(10,10,"#F7E9B8");e.pivotX=0,e.pivotY=0,e.x=infoButton.x+infoButton.width/2,e.y=infoButton.y+infoButton.height/2;var s=g.slide(e,e.x,100,30);g.tweenProperty(e,"scaleX",e.scaleX,180,30),g.tweenProperty(e,"scaleY",e.scaleY,80,30);s.onComplete=()=>{infoDiv.classList.remove("hide"),infoDiv.classList.add("show"),updateInfoIframe(),g.remove(e)}},(resetButton=g.button([g.assets["images/b_reset.png"],g.assets["images/b_reset.png"],g.assets["images/b_reset.png"]])).x=g.canvas.width-resetButton.width*scaleAllButtons,resetButton.y=0,resetButton.scaleX=scaleAllButtons,resetButton.scaleY=scaleAllButtons,resetButton.press=()=>{for(let s=1;s<4;s++)for(let e=1;e<10;e++)localStorage.removeItem("data"+s+e)},(playButton=g.button([g.assets["images/b_play_up.png"],g.assets["images/b_play_over.png"],g.assets["images/b_play_up.png"]])).x=gameWidth,playButton.y=gameHeight,playButton.scaleX=scaleAllButtons,playButton.scaleY=scaleAllButtons,playButton.press=()=>{menu.classList.contains("show")&&(menu.classList.remove("show"),menu.classList.add("hide"),menuShowPress()),MsgInfo.visible=!1,MsgInfo1.visible=!1,MsgInfo2.visible=!1,g.slide(titleScene,g.canvas.width,g.canvas.height,30,["decelerationCubed"]),g.slide(secondPage,0,0,30,["decelerationCubed"]).onComplete=()=>{updatePolygonPoinst()},scenePlaying=scenePlaying||1,levelPlaying=levelPlaying||1,sceneMsg.content=sceneMsgDim[scenePlaying-1],levelMsg.content="Level "+levelPlaying,resetAllParameters(scenePlaying,levelPlaying,"playPress"),updateFirstPage(scenePlaying,levelPlaying),loadGameInfoLast(),g.state=play},g.slide(playButton,g.canvas.width-(g.canvas.width-title.width)/4-playButton.width/2,.75*g.canvas.height-playButton.width/2,30,["decelerationCubed"]),g.slide(sceneInfoBoxGroup,(g.canvas.width-title.width)/4-sceneInfoBoxGroup.width/2,title.y+sceneInfoBoxGroup.height/2,30,["decelerationCubed"]),g.slide(levelInfoBoxGroup,g.canvas.width-(g.canvas.width-title.width)/4-levelInfoBoxGroup.width/2,title.y+levelInfoBoxGroup.height/2,30,["decelerationCubed"]),titleScene=g.group(title,infoButton,playButton,resetButton,levelInfoBoxGroup,sceneInfoBoxGroup,menuShow,menuHide)}function updateFirstPage(e,s){scenePlaying=e,levelPlaying=s,sceneMsg.content=sceneMsgDim[scenePlaying-1],levelMsg.content="Level "+levelPlaying}function updateMsgInfo(){MsgInfo.layer=100,MsgInfo1.layer=100,MsgInfo2.layer=100,MsgInfo.content=`is_M=${isMobile} & is_T=${isTouch} | DPI=${pixelRatio} `,MsgInfo1.content=`WA=${window.screen.availWidth},HA=`+window.screen.availHeight,MsgInfo1.content+=` | WW=${window.innerWidth},WH=`+window.innerHeight,MsgInfo1.content+=` | VW=${visualViewport.width},VH=`+visualViewport.height,MsgInfo2.content=`S_C=${std.scaleCanvas.toFixed(2)} & S_X= ${std.scaleX.toFixed(2)} & S_Y= `+std.scaleY.toFixed(2)}function buildGroupInfo1(){infoGamePNG=g.sprite(g.assets["images/infogame.png"]),infoGameGroup=g.group(infoGamePNG);var e="60px puzzler",s="black";(infoGameMsg=[[g.text("First",e,s,355,337),g.text("First",e,s,621,337),g.text("First",e,s,789,337),g.text("First",e,s,1077,337),g.text("First",e,s,1240,337),g.text("First",e,s,1489,337),g.text("First",e,s,1656,337)],[g.text("First",e,s,355,564),g.text("First",e,s,621,564),g.text("First",e,s,789,564),g.text("First",e,s,1077,564),g.text("First",e,s,1240,564),g.text("First",e,s,1489,564),g.text("First",e,s,1656,564)],[g.text("First",e,s,355,786),g.text("First",e,s,621,786),g.text("First",e,s,789,786),g.text("First",e,s,1077,786),g.text("First",e,s,1240,786),g.text("First",e,s,1489,786),g.text("First",e,s,1656,786)]]).forEach(e=>{e.forEach(e=>{e.pivotX=e.pivotY=.5})}),infoGameMsg[0][0].content="23.82",infoGameMsg[0][1].content="=";for(let s=0;s<3;s++)for(let e=0;e<7;e++)infoGameGroup.add(infoGameMsg[s][e]);infoGameGroup.visible=!1,infoGameGroup.x=(g.canvas.width-1888)/2,infoGameGroup.y=menuShow.y+menuShow.height*scaleButton+10,(homeButton=g.button([g.assets["images/home_512_up.png"],g.assets["images/home_512_over.png"],g.assets["images/home_512_up.png"]])).press=()=>homePress(),homeButton.x=g.canvas.width-1.1*homeButton.width*scaleButton,homeButton.y=10,homeButton.scaleX=scaleButton,homeButton.scaleY=scaleButton,(infoGameButton=g.button([g.assets["images/infogame_512_up.png"],g.assets["images/infogame_512_over.png"],g.assets["images/infogame_512_up.png"]])).press=()=>{infoGameGroup.visible?(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)):(infoGameGroup.visible=!0,updateGameInfo("infoBtn"),padArray.forEach(e=>e.interactive=!1))},infoGameButton.x=homeButton.x-1.1*infoGameButton.width*scaleButton,infoGameButton.y=10,infoGameButton.scaleX=scaleButton,infoGameButton.scaleY=scaleButton,infoGameButton.visible=!1,infoGameButton.interactive=!1,buttonsToShowHide.push(infoGameButton),(pauseButton=g.button([g.assets["images/pause_512_up.png"],g.assets["images/pause_512_over.png"],g.assets["images/pause_512_up.png"]])).press=()=>pausePressed(),infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)),pauseButton.x=menuShow.x,pauseButton.y=10,pauseButton.scaleX=scaleButton,pauseButton.scaleY=scaleButton,(pauseOnButton=g.button([g.assets["images/pause_on_512_up.png"],g.assets["images/pause_on_512_over.png"],g.assets["images/pause_on_512_up.png"]])).press=()=>pausePressed(),infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)),pauseOnButton.x=menuShow.x,pauseOnButton.y=10,pauseOnButton.scaleX=scaleButton,pauseOnButton.scaleY=scaleButton,pauseOnButton.visible=!1,pauseOnButton.interactive=!1,(restartButton=g.button([g.assets["images/restart_512_up.png"],g.assets["images/restart_512_over.png"],g.assets["images/restart_512_up.png"]])).press=()=>{infoGameGroup.visible&&(infoGameGroup.visible=!1,padArray.forEach(e=>e.interactive=!0)),restart()},restartButton.x=menuShow.x+1.1*menuShow.width*scaleButton,restartButton.y=10,restartButton.scaleX=scaleButton,restartButton.scaleY=scaleButton,restartButton.visible=!1,restartButton.interactive=!1,buttonsToShowHide.push(restartButton),(saveButton=g.button([g.assets["images/save_512_up.png"],g.assets["images/save_512_over.png"],g.assets["images/save_512_up.png"]])).press=()=>savePress(),saveButton.x=restartButton.x+1.1*saveButton.width*scaleButton,saveButton.y=10,saveButton.scaleX=scaleButton,saveButton.scaleY=scaleButton,saveButton.visible=!1,saveButton.interactive=!1,buttonsToShowHide.push(saveButton),(saveToDiskButton=g.button([g.assets["images/b_about_up_128.png"],g.assets["images/b_about_over_128.png"],g.assets["images/b_about_up_128.png"]])).press=()=>saveToDisk(),saveToDiskButton.x=restartButton.x,saveToDiskButton.y=g.canvas.height-saveToDiskButton.height-10,img2=g.sprite(g.assets["images/view_420x1080.png"]),(img3=g.sprite(g.assets["images/view_420x1080.png"])).x=1500,(infoBox1=g.sprite(g.assets["images/step_512_neutral.png"])).x=0,infoBox1.y=0,infoBox1.scaleX=scaleButton,infoBox1.scaleY=scaleButton,(msg11=g.text(" : "+(stepArray.length-1),"60px puzzler","black")).x=infoBox1.width*scaleButton+10,msg11.y=infoBox1.height*scaleButton/2-30,msg11.pivotX=0,msg11.pivotY=0,msg11.scaleX=scaleText,msg11.scaleY=scaleText,g.pushMessage(msg11),(infoBox2=g.sprite(g.assets["images/time_512_neutral.png"])).x=0,infoBox2.y=0,infoBox2.scaleX=scaleButton,infoBox2.scaleY=scaleButton,(msg21=g.text(" : ","60px puzzler","black")).x=infoBox2.width*scaleButton+10,msg21.y=infoBox2.height*scaleButton/2-30,msg21.pivotX=0,msg21.pivotY=0,msg21.scaleX=scaleText,msg21.scaleY=scaleText,g.pushMessage(msg21),(infoBox3=g.sprite(g.assets["images/bananas_512_neutral.png"])).x=0,infoBox3.y=0,infoBox3.scaleX=scaleButton,infoBox3.scaleY=scaleButton,(msg31=g.text(" : "+yo.bananasToEat,"60px puzzler","black")).x=infoBox3.width*scaleButton+10,msg31.y=infoBox3.height*scaleButton/2-30,msg31.pivotX=0,msg31.pivotY=0,msg31.scaleX=scaleText,msg31.scaleY=scaleText,g.pushMessage(msg31),(infoBox4=g.sprite(g.assets["images/yo_level_512.png"])).x=0,infoBox4.y=0,infoBox4.scaleX=scaleButton,infoBox4.scaleY=scaleButton,(msg41=g.text("","40px puzzler","black")).x=infoBox4.width*scaleButton+10,msg41.y=infoBox4.height*scaleButton/2-40,msg41.pivotX=0,msg41.pivotY=0,msg41.scaleX=scaleText,msg41.scaleY=scaleText,(msg42=g.text("","40px puzzler","black")).x=infoBox4.width*scaleButton+10,msg42.y=infoBox4.height*scaleButton/2+10,msg42.pivotX=0,msg42.pivotY=0,msg42.scaleX=scaleText,msg42.scaleY=scaleText,updateGameInfoMsgs(),updateMsgInfo(),(infoBox1Group=g.group(infoBox1,msg11)).x=0,infoBox1Group.y=0,(infoBox2Group=g.group(infoBox2,msg21)).x=0,infoBox2Group.y=0,(infoBox3Group=g.group(infoBox3,msg31)).x=0,infoBox3Group.y=infoBox1Group.height*scaleButton*1.1+infoBox1Group.y,infoBox3Group.visible=!1,buttonsToShowHide.push(infoBox3Group),(infoBox4Group=g.group(infoBox4,msg41,msg42)).x=0,infoBox4Group.y=infoBox2Group.height*scaleButton*1.1+infoBox2Group.y,infoBox4Group.visible=!1,buttonsToShowHide.push(infoBox4Group),(pad_1_up=g.button([g.assets["images/pad_512_up_up.png"],g.assets["images/pad_512_up_over.png"],g.assets["images/pad_512_up_up.png"]],[])).press=()=>{upArrow.press()},(pad_1_down=g.button([g.assets["images/pad_512_down_up.png"],g.assets["images/pad_512_down_over.png"],g.assets["images/pad_512_down_up.png"]],[])).press=()=>{downArrow.press()},(pad_1_right=g.button([g.assets["images/pad_512_right_up.png"],g.assets["images/pad_512_right_over.png"],g.assets["images/pad_512_right_up.png"]],[])).press=()=>{rightArrow.press()},(pad_1_left=g.button([g.assets["images/pad_512_left_up.png"],g.assets["images/pad_512_left_over.png"],g.assets["images/pad_512_left_up.png"]],[])).press=()=>{leftArrow.press()},(pad_1_group=g.group(pad_1_up,pad_1_down,pad_1_right,pad_1_left)).x=10,pad_1_group.y=g.canvas.height/2-pad_1_group.height/4*scalePad,pad_1_group.scaleX=pad_1_group.scaleY=scalePad,(pad_2_up=g.button([g.assets["images/pad_512_up_up.png"],g.assets["images/pad_512_up_over.png"],g.assets["images/pad_512_up_up.png"]],[])).press=()=>{upArrow.press()},(pad_2_down=g.button([g.assets["images/pad_512_down_up.png"],g.assets["images/pad_512_down_over.png"],g.assets["images/pad_512_down_up.png"]],[])).press=()=>{downArrow.press()},(pad_2_right=g.button([g.assets["images/pad_512_right_up.png"],g.assets["images/pad_512_right_over.png"],g.assets["images/pad_512_right_up.png"]],[])).press=()=>{rightArrow.press()},(pad_2_left=g.button([g.assets["images/pad_512_left_up.png"],g.assets["images/pad_512_left_over.png"],g.assets["images/pad_512_left_up.png"]],[])).press=()=>{leftArrow.press()},(pad_2_group=g.group(pad_2_up,pad_2_down,pad_2_right,pad_2_left)).x=g.canvas.width-pad_2_group.width*scalePad-10,pad_2_group.y=g.canvas.height/2-pad_2_group.height/4*scalePad,pad_2_group.scaleX=scalePad,pad_2_group.scaleY=scalePad,padArray.push(pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_up,pad_2_down,pad_2_right,pad_2_left),(msgGroup=g.group(infoBox1Group,infoBox3Group)).x=10,msgGroup.y=1.1*menuShow.height*scaleButton,(msgGroup2=g.group(infoBox2Group,infoBox4Group)).x=g.canvas.width-img2.width+10,msgGroup2.y=1.1*infoGameButton.height*scaleButton,(groupInfo=g.group(img2,img3,msgGroup,msgGroup2,homeButton,infoGameButton,restartButton,pauseButton,pauseOnButton,saveButton,pad_1_group,pad_2_group,infoGameGroup,saveToDiskButton)).layer=5,updatePolygonPoinst()}function updateGameInfoMsgs(){msg11.content=" "+(stepArray.length-1),msg21.content=gameInfo.t<=0?" : .....":timeToString(gameInfo.t),msg31.content=" "+gameInfo.b,msg41.content=sceneMsgDim[scenePlaying-1],msg42.content="     "+levelPlaying}function updatePolygonPoinst(){var e=padDimension*scalePad;pad_1_up.points=[{x:pad_1_group.gx+.406*e,y:pad_1_group.gy+.406*e},{x:pad_1_group.gx+0*e,y:pad_1_group.gy+0*e},{x:pad_1_group.gx+e,y:pad_1_group.gy+0*e},{x:pad_1_group.gx+.6*e,y:pad_1_group.gy+.406*e}],pad_1_down.points=[{x:pad_1_group.gx+.406*e,y:pad_1_group.gy+.6*e},{x:pad_1_group.gx+.6*e,y:pad_1_group.gy+.6*e},{x:pad_1_group.gx+e,y:pad_1_group.gy+e},{x:pad_1_group.gx+0*e,y:pad_1_group.gy+e}],pad_1_right.points=[{x:pad_1_group.gx+.6*e,y:pad_1_group.gy+.406*e},{x:pad_1_group.gx+e,y:pad_1_group.gy+0*e},{x:pad_1_group.gx+e,y:pad_1_group.gy+e},{x:pad_1_group.gx+.6*e,y:pad_1_group.gy+.6*e}],pad_1_left.points=[{x:pad_1_group.gx+.406*e,y:pad_1_group.gy+.406*e},{x:pad_1_group.gx+.406*e,y:pad_1_group.gy+.6*e},{x:pad_1_group.gx+0*e,y:pad_1_group.gy+e},{x:pad_1_group.gx+0*e,y:pad_1_group.gy+0*e}],pad_2_up.points=[{x:pad_2_group.gx+.406*e,y:pad_2_group.gy+.406*e},{x:pad_2_group.gx+0*e,y:pad_2_group.gy+0*e},{x:pad_2_group.gx+e,y:pad_2_group.gy+0*e},{x:pad_2_group.gx+.6*e,y:pad_2_group.gy+.406*e}],pad_2_down.points=[{x:pad_2_group.gx+.406*e,y:pad_2_group.gy+.6*e},{x:pad_2_group.gx+.6*e,y:pad_2_group.gy+.6*e},{x:pad_2_group.gx+e,y:pad_2_group.gy+e},{x:pad_2_group.gx+0*e,y:pad_2_group.gy+e}],pad_2_right.points=[{x:pad_2_group.gx+.6*e,y:pad_2_group.gy+.406*e},{x:pad_2_group.gx+e,y:pad_2_group.gy+0*e},{x:pad_2_group.gx+e,y:pad_2_group.gy+e},{x:pad_2_group.gx+.6*e,y:pad_2_group.gy+.6*e}],pad_2_left.points=[{x:pad_2_group.gx+.406*e,y:pad_2_group.gy+.406*e},{x:pad_2_group.gx+.406*e,y:pad_2_group.gy+.6*e},{x:pad_2_group.gx+0*e,y:pad_2_group.gy+e},{x:pad_2_group.gx+0*e,y:pad_2_group.gy+0*e}]}function setResart(){}function putBackgroundCanvas(e,s,t,a,o){g.canvas.style.background=`url(${e}) no-repeat`,g.canvas.style.backgroundPosition=s+`px ${t}px`,g.canvas.style.backgroundSize=a+`px ${o}px`}function pixelToVw(e){return(e/window.innerWidth*100).toFixed(2)}function pixelToVh(e){return(e/window.innerHeight*100).toFixed(2)}function updateWaitCSS(){var e=document.querySelector(":root");video.width=g.canvas.width*std.scaleCanvas,e.style.setProperty("--wait-width",video.width+"px"),e.style.setProperty("--wait-left",g.canvas.offsetLeft+"px"),e.style.setProperty("--wait-top",g.canvas.offsetTop+"px")}function updateCSSVariables(){var e=document.querySelector(":root"),s=(getComputedStyle(e),Math.floor(menuShow.width*scaleButton*std.scaleCanvas)),t=Math.floor(menuShow.width*scaleButton*std.scaleCanvas),a=(g.canvas.offsetTop,10*std.scaleCanvas);let o=10;var n=g.canvas.offsetTop+menuShow.y*std.scaleY,i=g.canvas.offsetLeft+(menuShow.width*scaleButton+10)*std.scaleX;isMobile&&(o=5),e.style.setProperty("--btn-width",s+"px"),e.style.setProperty("--btn-height",t+"px"),e.style.setProperty("--menu-top",n+"px"),e.style.setProperty("--menu-left",i+"px"),e.style.setProperty("--menu-gap",a+"px"),e.style.setProperty("--border-iframe",o+"px")}function updateInfoIframe(){var e=g.canvas.offsetTop+menuShow.height*scaleButton*std.scaleCanvas+10,s=.95*(window.innerHeight-e),t=.8*window.innerWidth,a=document.getElementById("infoframe").contentWindow.document.querySelector(":root"),a=(isMobile&&(a.style.setProperty("--font-p","15px"),a.style.setProperty("--margin-p-v","5px"),a.style.setProperty("--margin-p-h","10px"),a.style.setProperty("--font-header","15px"),a.style.setProperty("--font-footer","15px"),a.style.setProperty("--font-buttons","12px"),a.style.setProperty("--btn-width","80px"),a.style.setProperty("--bnt-height","25px"),a.style.setProperty("--img-w","64px"),a.style.setProperty("--img-h","64px"),a.style.setProperty("--margin-flex","5%"),a.style.setProperty("--margin-line","5px")),.1*window.innerWidth);infoDiv.style.top=e+"px",infoDiv.style.width=t+"px",infoDiv.style.height=s+"px",infoDiv.style.margin=`0  ${a}px`}function createButtonMenu(){btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src,btn_1.style.width="64px",btn_2.src=g.assets["images/sound_no_240_up.png"].src,btn_2.style.width="64px",btn_1.onpointerdown=e=>(document.fullscreenElement?(document.exitFullscreen(),btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src):(main.requestFullscreen().catch(e=>console.log(e)),btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src),e.preventDefault&&e.preventDefault(),e.returnValue&&(e.returnValue=!1),e.stopPropagation(),e.target.releasePointerCapture(e.pointerId),!1),btn_1.addEventListener("mouseover",()=>{fullscreenState?btn_1.src=g.assets["images/fullscreen_off_512_over.png"].src:btn_1.src=g.assets["images/fullscreen_on_512_over.png"].src}),btn_1.addEventListener("mouseleave",()=>{fullscreenState?btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src:btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src}),btn_2.onpointerdown=e=>((isSoundOn=!isSoundOn)?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src,e.preventDefault&&e.preventDefault(),e.returnValue&&(e.returnValue=!1),e.stopPropagation(),e.target.releasePointerCapture(e.pointerId),!1),btn_2.addEventListener("mouseover",()=>{isSoundOn?btn_2.src=g.assets["images/sound_yes_240_over.png"].src:btn_2.src=g.assets["images/sound_no_240_over.png"].src}),btn_2.addEventListener("mouseleave",()=>{isSoundOn?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src})}function saveGameInfoLast(){1e3<gameInfo.t&&(gameInfoLast.t=Object.values(gameInfo)[0],gameInfoLast.s=Object.values(gameInfo)[1],gameInfoLast.b=Object.values(gameInfo)[2])}function loadGameInfoLast(){(data=JSON.parse(localStorage.getItem("data"+scenePlaying+levelPlaying)))&&(gameInfoLast={...data[1]})}function timeToString(e){var e=(e/1e3).toFixed(1),s=e.toString().substring(e.toString().indexOf(".")+1),e=Math.floor(e),t=Math.floor(e/60);let a="0",o=9<t?"":"0";return 9<e%60&&(a=""),t<=0?""+a+e%60+"."+s:""+o+t+`:${a}${e%60}.`+s}function updateGameInfo(e){let s={};function t(o,n){if(0===o){let e=void 0,s=void 0,t=void 0,a=void 0;n.first<=0?(infoGameMsg[o][0].content="?",infoGameMsg[o][0].x=400,infoGameMsg[o][1].content="?"):(e=+(n.first/1e3).toFixed(1),infoGameMsg[o][0].content=timeToString(n.first),infoGameMsg[o][0].x=415-15*timeToString(n.first).length),n.second<0?(infoGameMsg[o][2].content="?",infoGameMsg[o][2].x=849,infoGameMsg[o][3].content="?"):(s=+(n.second/1e3).toFixed(1),infoGameMsg[o][2].content=timeToString(n.second),infoGameMsg[o][2].x=864-15*timeToString(n.second).length),void 0!==e&&void 0!==s&&(e===s?infoGameMsg[o][1].content="=":e<s?infoGameMsg[o][1].content="<":infoGameMsg[o][1].content=">"),n.third<=0?(infoGameMsg[o][4].content="?",infoGameMsg[o][4].x=1285,infoGameMsg[o][3].content="?",infoGameMsg[o][5].content="?"):(t=+(n.third/1e3).toFixed(1),infoGameMsg[o][4].content=timeToString(n.third),infoGameMsg[o][4].x=1300-15*timeToString(n.third).length),void 0!==s&&void 0!==t&&(s===t?infoGameMsg[o][3].content="=":s<t?infoGameMsg[o][3].content="<":infoGameMsg[o][3].content=">"),n.fourth<=0?(infoGameMsg[o][6].content="?",infoGameMsg[o][6].x=1701):(a=+(n.fourth/1e3).toFixed(1),infoGameMsg[o][6].content=timeToString(n.fourth),infoGameMsg[o][6].x=1716-15*timeToString(n.fourth).length),void 0!==t&&void 0!==a&&(t===a?infoGameMsg[o][5].content="=":t<a?infoGameMsg[o][5].content="<":infoGameMsg[o][5].content=">")}else if(1===o){let e=void 0,s=void 0,t=void 0,a=void 0;n.first<=0?(infoGameMsg[o][0].content="?",infoGameMsg[o][0].x=400,infoGameMsg[o][1].content="?"):(e=n.first,infoGameMsg[o][0].content=n.first.toString(),infoGameMsg[o][0].x=415-15*n.first.toString().length),n.second<0?(infoGameMsg[o][2].content="?",infoGameMsg[o][2].x=849):(s=n.second,infoGameMsg[o][2].content=n.second.toString(),infoGameMsg[o][2].x=864-15*n.second.toString().length),void 0!==e&&void 0!==s&&(n.first===n.second?infoGameMsg[o][1].content="=":n.first<n.second?infoGameMsg[o][1].content="<":infoGameMsg[o][1].content=">"),n.third<=0?(infoGameMsg[o][4].content="?",infoGameMsg[o][4].x=1285,infoGameMsg[o][3].content="?",infoGameMsg[o][5].content="?"):(t=n.third,infoGameMsg[o][4].content=n.third.toString(),infoGameMsg[o][4].x=1300-15*n.third.toString().length),void 0!==s&&void 0!==t&&(n.second===n.third?infoGameMsg[o][3].content="=":n.second<n.third?infoGameMsg[o][3].content="<":infoGameMsg[o][3].content=">"),n.fourth<=0?(infoGameMsg[o][6].content="?",infoGameMsg[o][6].x=1701,infoGameMsg[o][5].content="?"):(a=n.fourth,infoGameMsg[o][6].content=n.fourth.toString(),infoGameMsg[o][6].x=1716-15*n.fourth.toString().length),void 0!==t&&void 0!==a&&(n.third===n.fourth?infoGameMsg[o][5].content="=":n.third<n.fourth?infoGameMsg[o][5].content="<":infoGameMsg[o][5].content=">")}else if(2===o){let e=void 0,s=void 0,t=void 0,a=void 0;n.first<0?(infoGameMsg[o][0].content="?",infoGameMsg[o][0].x=400,infoGameMsg[o][1].content="?"):(e=n.first,infoGameMsg[o][0].content=n.first.toString(),infoGameMsg[o][0].x=415-15*n.first.toString().length),n.second<0?(infoGameMsg[o][2].content="?",infoGameMsg[o][2].x=849):(s=n.second,infoGameMsg[o][2].content=n.second.toString(),infoGameMsg[o][2].x=864-15*n.second.toString().length),void 0!==e&&void 0!==s&&(n.first===n.second?infoGameMsg[o][1].content="=":n.first<n.second?infoGameMsg[o][1].content="<":infoGameMsg[o][1].content=">"),n.third<0?(infoGameMsg[o][4].content="?",infoGameMsg[o][4].x=1285,infoGameMsg[o][3].content="?",infoGameMsg[o][5].content="?"):(t=n.third,infoGameMsg[o][4].content=n.third.toString(),infoGameMsg[o][4].x=1300-15*n.third.toString().length),void 0!==s&&void 0!==t&&(n.second===n.third?infoGameMsg[o][3].content="=":n.second<n.third?infoGameMsg[o][3].content="<":infoGameMsg[o][3].content=">"),n.fourth<0?(infoGameMsg[o][6].content="?",infoGameMsg[o][6].x=1701,infoGameMsg[o][5].content="?"):(a=n.fourth,infoGameMsg[o][6].content=n.fourth.toString(),infoGameMsg[o][6].x=1716-15*n.fourth.toString().length),void 0!==t&&void 0!==a&&(n.third===n.fourth?infoGameMsg[o][5].content="=":n.third<n.fourth?infoGameMsg[o][5].content="<":infoGameMsg[o][5].content=">")}}!async function(){var e;navigator.storage&&navigator.storage.estimate&&((e=await navigator.storage.estimate()).usage,e.quota,e=e.quota-e.usage,std.quota=(e/1024/1024).toFixed(1))}();function a(){s.first=gameInfoLast.t,s.second=gameInfo.t,s.third=gameInfoLast.bt,s.fourth=estimateKeyboard[scenePlaying-1][levelPlaying-1].csec,t(0,s),s.first=gameInfoLast.s,s.second=gameInfo.s,s.third=gameInfoLast.bs,s.fourth=estimateKeyboard[scenePlaying-1][levelPlaying-1].s,t(1,s),s.first=gameInfoLast.b,s.second=gameInfo.b,s.third=gameInfoLast.bb,s.fourth=0,t(2,s)}"restart"===e||"infoBtn"===e?a():"end"===e&&(gameInfoLast.bt=Math.min(gameInfoLast.bt<=0?1/0:gameInfoLast.bt,gameInfo.t),gameInfoLast.bs=Math.min(gameInfoLast.bs<=0?1/0:gameInfoLast.bs,gameInfo.s),gameInfoLast.bb=Math.min(gameInfoLast.bb<=0?1/0:gameInfoLast.bb,gameInfo.b),a())}function measureText(e,s){return g.canvas.ctx.font=e,{width:g.canvas.ctx.measureText(s).width,height:g.canvas.ctx.measureText("M").width}}function buildSaveGoup(){dataSave=[],saveImgBorder=g.sprite(g.assets["images/save_img.png"]),saveImgInBorder=g.sprite(g.assets["images/save_img_in.png"]),saveMsg_1=g.text("temp","30px puzzler","black"),saveMsg_2=g.text("temp","30px puzzler","black"),saveMsg_3=g.text("temp","30px puzzler","black"),saveMsg_4=g.text("temp","30px puzzler","black"),saveMsg_5=g.text("temp","30px puzzler","black"),saveMsg_11=g.text("temp","30px puzzler","black"),saveMsg_21=g.text("temp","30px puzzler","black"),saveMsg_31=g.text("temp","30px puzzler","black"),updateSaveGoup(),(saveCancelButton=g.button([g.assets["images/save_cancel_512_up.png"],g.assets["images/save_cancel_512_over.png"],g.assets["images/save_cancel_512_up.png"]])).x=.25*saveImgInBorder.width-.5*saveCancelButton.width*scaleButton,saveCancelButton.y=saveImgInBorder.height-1.2*saveCancelButton.height*scaleButton-32,saveCancelButton.scaleX=scaleButton,saveCancelButton.scaleY=scaleButton,(saveOkButton=g.button([g.assets["images/save_ok_512_up.png"],g.assets["images/save_ok_512_over.png"],g.assets["images/save_ok_512_up.png"]])).x=.75*saveImgInBorder.width-.5*saveOkButton.width*scaleButton,saveOkButton.y=saveImgInBorder.height-1.2*saveOkButton.height*scaleButton-32,saveOkButton.scaleX=scaleButton,saveOkButton.scaleY=scaleButton,saveOkButton.press=()=>{if(fromSave)(dataSave=[]).push(gameInfo),dataSave.push(gameInfoLast),dataSave.push(stepArray),localStorage.removeItem("data"+scenePlaying+levelPlaying),console.log("before saving ",dataSave),localStorage.setItem("data"+scenePlaying+levelPlaying,JSON.stringify(dataSave));else{if(!(data=JSON.parse(localStorage.getItem("data"+scenePlaying+levelPlaying))))return resetAllParameters(scenePlaying,levelPlaying),void g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30);resetAllParameters(scenePlaying,levelPlaying),gameInfo={...data[0]},gameInfoLast={...data[1]},stepArray=[...data[2]],g.setGameInfo(gameInfo),g.setStepArray(stepArray),updateGameInfoMsgs();let e=1;if(1===stepArray.length)return void g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30);g.setReplayMode(!0),intervalId=setInterval(()=>{"u"===stepArray[e].d?yo.move("up",blocks,yo,walk):"d"===stepArray[e].d?yo.move("down",blocks,yo,walk):"r"===stepArray[e].d?yo.move("right",blocks,yo,walk):"l"===stepArray[e].d&&yo.move("left",blocks,yo,walk),++e===stepArray.length&&(clearInterval(intervalId),g.setReplayMode(!1))},replaySpeed)}g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30)},saveCancelButton.press=()=>{g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30)};var e="30px puzzler";replay=g.text("Replay > ",e,"black"),slow=g.text(" Slow: ",e,"black"),fast=g.text(" Fast: ",e,"black"),veryFast=g.text(" Faster: ",e,"black"),checkedBoxButton_0=g.button([g.assets["images/checked_box_512.png"],g.assets["images/checked_box_512.png"]]),checkedBoxButton_1=g.button([g.assets["images/checked_box_512.png"],g.assets["images/checked_box_512.png"]]),checkedBoxButton_2=g.button([g.assets["images/checked_box_512.png"],g.assets["images/checked_box_512.png"]]),checkedImg=g.sprite(g.assets["images/checked_512_up.png"]),checkedBoxButton_0.press=()=>{checkedImg.x=slow.x+slow.width,replaySpeed=200},checkedBoxButton_1.press=()=>{checkedImg.x=fast.x+fast.width,replaySpeed=100},checkedBoxButton_2.press=()=>{checkedImg.x=veryFast.x+veryFast.width,replaySpeed=50},checkedGroup=g.group(replay,checkedImg,slow,checkedBoxButton_0,fast,checkedBoxButton_1,veryFast,checkedBoxButton_2),(saveOkCancelGroup=g.group(saveImgInBorder,saveMsg_11,saveMsg_21,saveMsg_31,checkedGroup,saveOkButton,saveCancelButton)).x=.5*g.canvas.width-.5*saveImgInBorder.width,saveOkCancelGroup.y=g.canvas.height,saveOkCancelGroup.layer=50,(saveButtonCancel=g.button([g.assets["images/save_cancel_512_up.png"],g.assets["images/save_cancel_512_over.png"],g.assets["images/save_cancel_512_up.png"]])).x=.5*saveImgBorder.width-.5*saveButtonCancel.width*scaleButton,saveButtonCancel.y=saveImgBorder.height-1.2*saveButtonCancel.height*scaleButton-32,saveButtonCancel.scaleX=scaleButton,saveButtonCancel.scaleY=scaleButton,saveButtonCancel.press=()=>{g.slide(saveGroup,saveGroup.x,-g.canvas.height,30)},(saveInButton=g.button([g.assets["images/save_512_in_up.png"],g.assets["images/save_512_in_over.png"],g.assets["images/save_512_in_up.png"]])).press=()=>{let e,s,t;fromOpen=!1,fromSave=!0,g.slide(saveOkCancelGroup,saveOkCancelGroup.x,.5*g.canvas.height-.5*saveImgInBorder.height,30),g.slide(saveGroup,saveGroup.x,-g.canvas.height,30),checkedGroup.visible=!1,t=isSaved?(e="Already saved",s="Want to save anyway !","The last saved game will be lost."):(e="Save !",s="First time saved.","Only one saved game at a time."),updateSaveOkCancelGoup(e,s,t)},saveInButton.x=.25*saveImgBorder.width-.5*saveInButton.width*scaleButton,saveInButton.y=saveImgBorder.height-1.2*saveInButton.height*scaleButton-32,saveInButton.scaleX=scaleButton,saveInButton.scaleY=scaleButton,(saveOutButton=g.button([g.assets["images/save_512_out_up.png"],g.assets["images/save_512_out_over.png"],g.assets["images/save_512_out_up.png"]])).x=.75*saveImgBorder.width-.5*saveOutButton.width*scaleButton,saveOutButton.y=saveImgBorder.height-1.2*saveOutButton.height*scaleButton-32,saveOutButton.scaleX=scaleButton,saveOutButton.scaleY=scaleButton,saveOutButton.press=()=>{let e,s,t;fromOpen=!0,fromSave=!1,g.slide(saveOkCancelGroup,saveOkCancelGroup.x,.5*g.canvas.height-.5*saveImgInBorder.height,30),g.slide(saveGroup,saveGroup.x,-g.canvas.height,30),isSaved?(e="Load the game !",s="Present data will be lost.",t="Load anyway !",checkedGroup.visible=!0):(e="Can not open this game !",s="Not saved yet.",t="Only saved game can be opened.",checkedGroup.visible=!1),updateSaveOkCancelGoup(e,s,t)},(saveGroup=g.group(saveImgBorder,saveMsg_1,saveMsg_2,saveMsg_3,saveMsg_4,saveMsg_5,saveInButton,saveButtonCancel,saveOutButton)).x=.5*g.canvas.width-.5*saveImgBorder.width,saveGroup.y=-g.canvas.height}function updateSaveGoup(e,s,t,a,o){let n="40px puzzler",g="60px puzzler";isMobile&&(n="40px puzzler",g="50px puzzler"),fromOpen=fromSave=!1,o=(data=JSON.parse(localStorage.getItem("data"+scenePlaying+levelPlaying)))?(isSaved=!0,isExit=!0,e="Open the game !",s=sceneMsgDim[scenePlaying-1]+" Level:"+levelPlaying,t="Time : "+timeToString(data[0].t),a="Steps : "+data[0].s,"Bananas : "+data[0].b):(isSaved=!1,isExit=!1,e="Save the game !",s=sceneMsgDim[scenePlaying-1]+" Level:"+levelPlaying,t="Time : "+timeToString(gameInfo.t),a="Steps : "+gameInfo.s,"Bananas : "+gameInfo.b),saveMsg_1.font=g,saveMsg_1.content=e,saveMsg_1.width=measureText(g,e).width,saveMsg_1.height=measureText(g,e).height,saveMsg_1.x=.5*saveImgBorder.width-.5*saveMsg_1.width,saveMsg_1.y=32,saveMsg_2.font=g,saveMsg_2.content=s,saveMsg_2.width=measureText(g,s).width,saveMsg_2.height=measureText(g,s).height,saveMsg_2.x=.5*saveImgBorder.width-.5*saveMsg_2.width,saveMsg_2.y=saveMsg_1.y+saveMsg_1.height+10,saveMsg_3.content=t,saveMsg_3.font=n,saveMsg_3.width=measureText(n,t).width,saveMsg_3.height=measureText(n,t).height,saveMsg_3.x=.5*saveImgBorder.width-.5*saveMsg_3.width,saveMsg_3.y=saveMsg_2.y+saveMsg_2.height+20,saveMsg_4.content=a,saveMsg_4.font=n,saveMsg_4.width=measureText(n,a).width,saveMsg_4.height=measureText(n,a).height,saveMsg_4.x=.5*saveImgBorder.width-.5*saveMsg_4.width,saveMsg_4.y=saveMsg_3.y+saveMsg_3.height+10,saveMsg_5.content=o,saveMsg_5.font=n,saveMsg_5.width=measureText(n,o).width,saveMsg_5.height=measureText(n,o).height,saveMsg_5.x=.5*saveImgBorder.width-.5*saveMsg_5.width,saveMsg_5.y=saveMsg_4.y+saveMsg_4.height+10}function updateSaveOkCancelGoup(e,s,t){let a="40px puzzler",o="60px puzzler";var n="30px puzzler",e=(isMobile&&(a="40px puzzler",o="50px puzzler"),saveMsg_11.font=o,saveMsg_11.content=e,saveMsg_11.width=measureText(o,e).width,saveMsg_11.height=measureText(o,e).height,saveMsg_11.x=.5*saveImgInBorder.width-.5*saveMsg_11.width,saveMsg_11.y=32,saveMsg_21.font=o,saveMsg_21.content=s,saveMsg_21.width=measureText(o,s).width,saveMsg_21.height=measureText(o,s).height,saveMsg_21.x=.5*saveImgInBorder.width-.5*saveMsg_21.width,saveMsg_21.y=saveMsg_11.y+saveMsg_11.height+10,saveMsg_31.content=t,saveMsg_31.font=a,saveMsg_31.width=measureText(a,t).width,saveMsg_31.height=measureText(a,t).height,saveMsg_31.x=.5*saveImgInBorder.width-.5*saveMsg_31.width,saveMsg_31.y=saveMsg_21.y+saveMsg_21.height+20,replay.font=n,replay.width=measureText(n,"Replay > ").width,replay.height=measureText(n,"Replay > ").height,slow.font=n,slow.width=measureText(n," Slow: ").width,slow.height=measureText(n," Slow: ").height,fast.font=n,fast.width=measureText(n," Fast: ").width,fast.height=measureText(n," Fast: ").height,veryFast.font=n,veryFast.width=measureText(n," Faster: ").width,veryFast.height=measureText(n," Faster: ").height,checkedBoxButton_0.scaleX=checkedBoxButton_0.scaleY=.5*scaleButton,checkedBoxButton_1.scaleX=checkedBoxButton_1.scaleY=.5*scaleButton,checkedBoxButton_2.scaleX=checkedBoxButton_2.scaleY=.5*scaleButton,checkedImg.scaleX=checkedImg.scaleY=.5*scaleButton,slow.x=replay.width,checkedBoxButton_0.x=slow.x+slow.width,fast.x=slow.x+slow.width+checkedBoxButton_0.width*scaleButton*.5,checkedBoxButton_1.x=fast.x+fast.width,0===checkedImg.x&&(checkedImg.x=checkedBoxButton_1.x),veryFast.x=fast.x+fast.width+checkedBoxButton_1.width*scaleButton*.5,checkedBoxButton_2.x=veryFast.x+veryFast.width,replay.y=slow.y=fast.y=veryFast.y=checkedBoxButton_0.height*scaleButton*.5*.5-.5*replay.height,checkedGroup.y=saveMsg_31.y+saveMsg_31.height+20,replay.width+slow.width+fast.width+veryFast.width+3*checkedBoxButton_1.width*scaleButton*.5);checkedGroup.x=.5*saveImgInBorder.width-.5*e}async function saveToDisk(e){var s={is_M:isMobile,is_T:isTouch,DPI:pixelRatio,WA:window.screen.availWidth,HA:window.screen.availHeight,WW:window.innerWidth,WH:window.innerHeight,DW:document.body.width,DH:document.body.height,S_C:std.scaleCanvas.toFixed(2),S_X:std.scaleX.toFixed(2),S_Y:std.scaleY.toFixed(2),Q:std.quota},t={scene:scenePlaying,level:levelPlaying},a=[],s=(a.push(s,t,gameInfo,stepArray),document.createElement("a")),t=new Blob([JSON.stringify(a)],{type:"text/plain"});s.setAttribute("href",URL.createObjectURL(t)),s.setAttribute("download","yo_gameConfig".toLowerCase()+".json"),s.click(),URL.revokeObjectURL(s.href)}g.start(),g.scaleToWindow(std),updateWaitCSS(),window.addEventListener("resize",e=>{g.scaleToWindow(std),updateMsgInfo(),updateCSSVariables(),updateInfoIframe(),updateWaitCSS()}),document.addEventListener("fullscreenchange",e=>{g.scaleToWindow(std),updateMsgInfo(),(fullscreenState=!fullscreenState)?btn_1.src=g.assets["images/fullscreen_off_512_over.png"].src:btn_1.src=g.assets["images/fullscreen_on_512_over.png"].src});