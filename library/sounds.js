let actx=new AudioContext;"suspended"===actx.state&&actx.resume();class Sound{constructor(e,t){this.source=e,this.loadHandler=t,this.actx=actx,this.volumeNode=this.actx.createGain(),this.panNode=this.actx.createStereoPanner(),this.convolverNode=this.actx.createConvolver(),this.delayNode=this.actx.createDelay(),this.feedbackNode=this.actx.createGain(),this.filterNode=this.actx.createBiquadFilter(),this.soundNode=null,this.buffer=null,this.loop=!1,this.playing=!1,this.panValue=0,this.volumeValue=1,this.startTime=0,this.startOffset=0,this.playbackRate=1,this.randomPitch=!0,this.reverb=!1,this.reverbImpulse=null,this.echo=!1,this.delayValue=.3,this.feebackValue=.3,this.filterValue=0,this.load()}load(){let e=new XMLHttpRequest;e.open("GET",this.source,!0),e.responseType="arraybuffer",e.addEventListener("load",()=>{this.actx.decodeAudioData(e.response,e=>{this.buffer=e,this.hasLoaded=!0,this.loadHandler&&this.loadHandler()},e=>{throw new Error("Audio could not be decoded: "+e)})}),e.send()}play(){this.startTime=this.actx.currentTime,this.soundNode=this.actx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.connect(this.volumeNode),!1===this.reverb?this.volumeNode.connect(this.panNode):(this.volumeNode.connect(this.convolverNode),this.convolverNode.connect(this.panNode),this.convolverNode.buffer=this.reverbImpulse),this.panNode.connect(this.actx.destination),this.echo&&(this.feedbackNode.gain.value=this.feebackValue,this.delayNode.delayTime.value=this.delayValue,this.filterNode.frequency.value=this.filterValue,this.delayNode.connect(this.feedbackNode),(0<this.filterValue?(this.feedbackNode.connect(this.filterNode),this.filterNode):this.feedbackNode).connect(this.delayNode),this.volumeNode.connect(this.delayNode),this.delayNode.connect(this.panNode)),this.soundNode.loop=this.loop,this.soundNode.playbackRate.value=this.playbackRate,this.soundNode.start(this.startTime,this.startOffset%this.buffer.duration),this.playing=!0}setReverb(e=2,t=2,a=!1){this.reverbImpulse=impulseResponse(e,t,a),this.reverb=!0}setEcho(e=.3,t=.3,a=0){this.delayValue=e,this.feebackValue=t,this.filterValue=a,this.echo=!0}pause(){this.playing&&(this.soundNode.stop(this.actx.currentTime),this.startOffset+=this.actx.currentTime-this.startTime,this.playing=!1,console.log(this.startOffset))}restart(){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=0,this.startPoint=0,this.endPoint=this.buffer.duration,this.play()}playFrom(e){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=e,this.play()}playSection(e,t){this.playing&&this.soundNode.stop(this.actx.currentTime),0===this.startOffset&&(this.startOffset=e),this.startTime=this.actx.currentTime,this.soundNode=this.actx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.connect(this.panNode),this.panNode.connect(this.volumeNode),this.volumeNode.connect(this.actx.destination),this.soundNode.loop=this.loop,this.soundNode.loopStart=e,this.soundNode.loopEnd=t,this.soundNode.start(this.startTime,this.startOffset%this.buffer.duration,t-e),this.playing=!0}get volume(){return this.volumeValue}set volume(e){this.volumeNode.gain.value=e,this.volumeValue=e}get pan(){return this.panNode.pan.value}set pan(e){this.panNode.pan.value=e}}function makeSound(e,t){return new Sound(e,t)}function soundEffect(e,a=0,i=1,t="sine",n=1,s=0,o=0,r=0,c=!1,l=0,u=0,h=void 0,d=void 0){let f=actx.createOscillator(),p=actx.createGain(),m=actx.createStereoPanner();f.connect(p),p.connect(m),m.connect(actx.destination),p.gain.value=n,m.pan.value=s,f.type=t;let v;if(v=0<l?(s=e-l/2,t=e+l/2,Math.floor(Math.random()*(t-s+1))+s):e,f.frequency.value=v,0<a&&x(p),0<i&&T(p),0<r&&b(f),h&&N(p),d&&y(p),0<u){l=actx.createOscillator(),t=actx.createOscillator(),s=actx.createGain(),e=actx.createGain();s.gain.value=n,e.gain.value=n,l.connect(s),s.connect(actx.destination),t.connect(e),e.connect(actx.destination),l.type="sawtooth",t.type="sawtooth",l.frequency.value=v+u,t.frequency.value=v-u,0<a&&(x(s),x(e)),0<i&&(T(s),T(e)),0<r&&(b(l),b(t)),h&&(N(s),N(e)),d&&(y(s),y(e)),g(l),g(t)}function y(e){var t=actx.createConvolver();t.buffer=impulseResponse(d[0],d[1],d[2]),e.connect(t),t.connect(m)}function N(e){var t=actx.createGain(),a=actx.createDelay(),i=actx.createBiquadFilter();a.delayTime.value=h[0],t.gain.value=h[1],h[2]&&(i.frequency.value=h[2]),a.connect(t),(h[2]?(t.connect(i),i):t).connect(a),e.connect(a),a.connect(m)}function x(e){e.gain.value=0,e.gain.linearRampToValueAtTime(0,actx.currentTime+o),e.gain.linearRampToValueAtTime(n,actx.currentTime+o+a)}function T(e){e.gain.linearRampToValueAtTime(n,actx.currentTime+a+o),e.gain.linearRampToValueAtTime(0,actx.currentTime+o+a+i)}function b(e){var t=e.frequency.value;c?(e.frequency.linearRampToValueAtTime(t,actx.currentTime+o),e.frequency.linearRampToValueAtTime(t+r,actx.currentTime+o+a+i)):(e.frequency.linearRampToValueAtTime(t,actx.currentTime+o),e.frequency.linearRampToValueAtTime(t-r,actx.currentTime+o+a+i))}function g(e){e.start(actx.currentTime+o)}g(f)}function impulseResponse(e=2,a=2,i=!1){var n=actx.sampleRate*e,e=actx.createBuffer(2,n,actx.sampleRate),s=e.getChannelData(0),o=e.getChannelData(1);for(let t=0;t<n;t++){let e;e=i?n-t:t,s[t]=(2*Math.random()-1)*Math.pow(1-e/n,a),o[t]=(2*Math.random()-1)*Math.pow(1-e/n,a)}return e}function playAll(a){if(0===a.length)throw new Error("Array to play sounds must be greater than 0.");let i=!0;for(let t=0;t<a.length;t++)for(let e=0;e<13;e++)[0,1,2,4,5,6,7,9,10].includes(e)?"number"!=typeof a[t][e]&&(i=!1):[3].includes(e)?["sine","triangle","square","sawtooth"].includes(a[t][e])||(i=!1):[8].includes(e)?"boolean"!=typeof a[t][e]&&(i=!1):[11,12].includes(e)&&void 0!==a[t][e]&&a[t][e].constructor!==Array&&(i=!1);if(!i)throw new Error("Some sounds can not be played. Check the array");a.forEach(e=>soundEffect(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12]))}let intervalId=[];function playAllNonTransform(a,e=!1,t="0"){if(0===a.length)throw new Error("Array to play sounds must be greater than 0.");let i=[];var n=[];let s=0;for(let t=0;t<a.length;t++){n=[];for(let e=0;e<13;e++)[0,1,2,4,5,6,7,9,10].includes(e)?(n.push(+a[t][e]),6===e&&(s=Math.max(s,a[t][e]))):[11,12].includes(e)?n.push([void 0,null,"undefined","u","null"].includes(a[t][e])?void 0:JSON.parse(a[t][e])):[8].includes(e)?n.push(!![!0,"true","yes"].includes(a[t][e])):[3].includes(e)&&n.push(["sine","triangle","square","sawtooth"].includes(a[t][e])?a[t][e]:"sine");13===n.length&&i.push(n)}e?(e=setInterval(()=>{i.forEach(e=>soundEffect(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12]))},1e3*s),intervalId.push({id:t,interval:e})):i.forEach(e=>soundEffect(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12]))}export{actx,makeSound,soundEffect,playAll,intervalId,playAllNonTransform};