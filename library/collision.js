function hitTestPoint(t,e){let i,l,n,r,a,o,h,d,y;return"rectangle"===(i=e.radius?"circle":"rectangle")&&(l=e.x,n=e.x+e.width,r=e.y,a=e.y+e.height,y=t.x>l&&t.x<n&&t.y>r&&t.y<a),"circle"===i&&(o=t.x-e.centerX,h=t.y-e.centerY,d=Math.sqrt(o*o+h*h),y=d<e.radius),y}function hitTestCircle(t,e,i=!1){let l,n;return n=i?(l=e.gx+e.radius-(t.gx+t.radius),e.gy+e.radius-(t.gy+t.radius)):(l=e.centerX-t.centerX,e.centerY-t.centerY),Math.sqrt(l*l+n*n)<t.radius+e.radius}function circleCollision(t,e,i=!1,l=!1){let n,r,a,o,h,d,y,c={},x=!1;return h=l?(o=e.gx+e.radius-(t.gx+t.radius),e.gy+e.radius-(t.gy+t.radius)):(o=e.centerX-t.centerX,e.centerY-t.centerY),(n=Math.sqrt(o*o+h*h))<(r=t.radius+e.radius)&&(x=!0,a=r-n,a+=.3,d=o/n,y=h/n,t.x-=a*d,t.y-=a*y,i)&&(c.x=h,c.y=-o,bounceOffSurface(t,c)),x}function movingCircleCollision(t,e,i=!1){let l,n,r,a,o={},h={},d={},y={},c={},x=!1;return t.mass=t.mass||1,e.mass=e.mass||1,i?(o.vx=e.gx+e.radius-(t.gx+t.radius),o.vy=e.gy+e.radius-(t.gy+t.radius)):(o.vx=e.centerX-t.centerX,o.vy=e.centerY-t.centerY),o.magnitude=Math.sqrt(o.vx*o.vx+o.vy*o.vy),l=t.radius+e.radius,o.magnitude<l&&(x=!0,n=l-o.magnitude,n+=.3,o.dx=o.vx/o.magnitude,o.dy=o.vy/o.magnitude,o.vxHalf=Math.abs(o.dx*n/2),o.vyHalf=Math.abs(o.dy*n/2),r=t.x>e.x?1:-1,a=t.y>e.y?1:-1,t.x=t.x+o.vxHalf*r,t.y=t.y+o.vyHalf*a,e.x=e.x+o.vxHalf*-r,e.y=e.y+o.vyHalf*-a,o.lx=o.vy,o.ly=-o.vx,i=t.vx*o.dx+t.vy*o.dy,h.x=i*o.dx,h.y=i*o.dy,i=t.vx*(o.lx/o.magnitude)+t.vy*(o.ly/o.magnitude),d.x=o.lx/o.magnitude*i,d.y=o.ly/o.magnitude*i,i=e.vx*o.dx+e.vy*o.dy,y.x=i*o.dx,y.y=i*o.dy,i=e.vx*(o.lx/o.magnitude)+e.vy*(o.ly/o.magnitude),c.x=o.lx/o.magnitude*i,c.y=o.ly/o.magnitude*i,t.bounce={},t.bounce.x=d.x+y.x,t.bounce.y=d.y+y.y,e.bounce={},e.bounce.x=h.x+c.x,e.bounce.y=h.y+c.y,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass),x}function multipleCircleCollision(i,l=!1){for(let e=0;e<i.length;e++){var n=i[e];for(let t=e+1;t<i.length;t++)movingCircleCollision(n,i[t],l)}}function hitTestRectangle(t,e,i=!1){let l,n,r,a,o;return l=!1,o=i?(a=t.gx+t.halfWidth-(e.gx+e.halfWidth),t.gy+t.halfHeight-(e.gy+e.halfHeight)):(a=t.centerX-e.centerX,t.centerY-e.centerY),n=t.halfWidth+e.halfWidth,r=t.halfHeight+e.halfHeight,l=Math.abs(a)<n&&Math.abs(o)<r}function rectangleCollision(t,e,i=!1,l=!0){let n,r,a,o,h,d,y;return y=l?(d=t.gx+t.halfWidth-(e.gx+e.halfWidth),t.gy+t.halfHeight-(e.gy+e.halfHeight)):(d=t.centerX-e.centerX,t.centerY-e.centerY),r=t.halfWidth+e.halfWidth,a=t.halfHeight+e.halfHeight,Math.abs(d)<r&&Math.abs(y)<a&&(o=r-Math.abs(d),(h=a-Math.abs(y))<=o?(0<y?(n="top",t.y=t.y+h):(n="bottom",t.y=t.y-h),i&&(t.vy*=-1)):(0<d?(n="left",t.x=t.x+o):(n="right",t.x=t.x-o),i&&(t.vx*=-1))),n}function hitTestCircleRectangle(t,e,i=!1){let l,n,r,a,o,h;if(h=i?(r=t.gx,a=t.gy,o=e.gx,e.gy):(r=t.x,a=t.y,o=e.x,e.y),"topMiddle"===(l=a<h-e.halfHeight?r<o-1-e.halfWidth?"topLeft":r>o+1+e.halfWidth?"topRight":"topMiddle":a>h+e.halfHeight?r<o-1-e.halfWidth?"bottomLeft":r>o+1+e.halfWidth?"bottomRight":"bottomMiddle":r<o-e.halfWidth?"leftMiddle":"rightMiddle")||"bottomMiddle"===l||"leftMiddle"===l||"rightMiddle"===l)n=hitTestRectangle(t,e,i);else{var d={};switch(l){case"topLeft":d.x=o,d.y=h;break;case"topRight":d.x=o+e.width,d.y=h;break;case"bottomLeft":d.x=o,d.y=h+e.height;break;case"bottomRight":d.x=o+e.width,d.y=h+e.height}n=hitTestCirclePoint(t,d,i)}return n&&l}function hitTestCirclePoint(t,e,i=!1){return e.diameter=1,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,hitTestCircle(t,e,i)}function circleRectangleCollision(t,e,i=!1,l=!1){let n,r,a,o,h,d;if(d=l?(a=t.gx,o=t.gy,h=e.gx,e.gy):(a=t.x,o=t.y,h=e.x,e.y),"topMiddle"===(n=o<d-e.halfHeight?a<h-1-e.halfWidth?"topLeft":a>h+1+e.halfWidth?"topRight":"topMiddle":o>d+e.halfHeight?a<h-1-e.halfWidth?"bottomLeft":a>h+1+e.halfWidth?"bottomRight":"bottomMiddle":a<h-e.halfWidth?"leftMiddle":"rightMiddle")||"bottomMiddle"===n||"leftMiddle"===n||"rightMiddle"===n)r=rectangleCollision(t,e,i,l);else{var y={};switch(n){case"topLeft":y.x=h,y.y=d;break;case"topRight":y.x=h+e.width,y.y=d;break;case"bottomLeft":y.x=h,y.y=d+e.height;break;case"bottomRight":y.x=h+e.width,y.y=d+e.height}r=circlePointCollision(t,y,i,l)}return r&&n}function circlePointCollision(t,e,i=!1,l=!1){return e.diameter=1,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,circleCollision(t,e,i,l)}function bounceOffSurface(t,e){var i,l={},n={},r={},a=t.mass||1;e.lx=e.y,e.ly=-e.x,e.magnitude=Math.sqrt(e.x*e.x+e.y*e.y),e.dx=e.x/e.magnitude,e.dy=e.y/e.magnitude,i=t.vx*e.dx+t.vy*e.dy,l.vx=i*e.dx,l.vy=i*e.dy,i=t.vx*(e.lx/e.magnitude)+t.vy*(e.ly/e.magnitude),n.vx=i*(e.lx/e.magnitude),n.vy=i*(e.ly/e.magnitude),n.vx*=-1,n.vy*=-1,r.x=l.vx+n.vx,r.y=l.vy+n.vy,t.vx=r.x/a,t.vy=r.y/a}function hit(e,i,a=!1,o=!1,h,l=void 0){let n,t=void 0!==e.parent,r=void 0!==i.parent;if(t&&i instanceof Array||r&&e instanceof Array){if(e instanceof Array){let[t,e]=[e,t]}for(let t=i.length-1;0<=t;t--){var d=i[t];(n=y(e,d))&&l&&l(n,d)}}else(n=y(e,i))&&l&&l(n);return n;function y(t,e){var i,l,n=void 0!==t.parent,r=void 0!==e.parent;if(n&&r)return t.diameter&&e.diameter?(n=t,l=e,a?n.vx+n.vy!==0&&l.vx+l.vy!==0?movingCircleCollision(n,l,h):circleCollision(n,l,o,h):hitTestCircle(n,l)):t.diameter&&!e.diameter?(n=t,l=e,a?circleRectangleCollision(n,l,o,h):hitTestCircleRectangle(n,l,h)):(n=t,i=e,a?rectangleCollision(n,i,o,h):hitTestRectangle(n,i,h));if(r&&void 0!==t.x&&void 0!==t.y)return hitTestPoint(t,e);throw new Error(`I'm sorry, ${t} and ${e} cannot be use together in a collision test.'`)}}function hitPolygonConvex(e,i){let t,l=void 0,n=void 0,r=void 0;if(i.length<=2)return!1;t=(e.y-i[0].y)*(i[1].x-i[0].x)-(e.x-i[0].x)*(i[1].y-i[0].y),l=t<0?"right":"left";for(let t=1;t<i.length-1;t++)if(n=(e.y-i[t].y)*(i[t+1].x-i[t].x)-(e.x-i[t].x)*(i[t+1].y-i[t].y),(r=n<0?"right":"left")!==l)return!1;return n=(e.y-i[i.length-1].y)*(i[0].x-i[i.length-1].x)-(e.x-i[i.length-1].x)*(i[0].y-i[i.length-1].y),(r=n<0?"right":"left")===l}export{hitTestPoint,hitTestCircle,circleCollision,movingCircleCollision,multipleCircleCollision,hitTestRectangle,rectangleCollision,hitTestCircleRectangle,hitTestCirclePoint,circleRectangleCollision,circlePointCollision,hit,hitPolygonConvex};