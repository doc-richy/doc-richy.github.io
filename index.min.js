import{game}from"./library/engine.js";import*as scene from"./library/level.js";import*as moveModule from"./library/move.js";import"./typedef.js";let main=document.getElementById("main");let infoDiv=document.getElementById("infodiv");let infoIframe=document.getElementById("infoframe");let std={scaleCanvas:1,scaleX:1,scaleY:2,boxSize:90,boxViewQuantity:12,scaleFactor:()=>std.boxSize/512,quota:undefined};let gameInfo={t:0,s:0,b:-1};let gameInfoLast={t:0,bt:-1,s:0,bs:-1,b:-1,bb:-1};let dataSave=[],data=undefined,isSaved=false,isExit=false,fromOpen=false,fromSave=false;let btn_1=document.getElementById("btn-1");let btn_2=document.getElementById("btn-2");let menu=document.getElementsByClassName("floating-menu")[0];let btn_2_hideS_up,btn_2_hideS_over,btn_2_showS_up,btn_2_showS_over;let isSoundOn=false;let gameWidth=1920,gameHeight=1080,cellWidth=90,cellHeight=90;let gridWidth=12,gridHeight=12,stepWidth=64,scaleButton=.2,scalePad=.75;let estimateKeyboard=[[{s:70,t:15.93,csec:15930},{s:106,t:80.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}],[{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}],[{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930},{s:65,t:18.02,csec:15930}]];let estimateCell=[[{s:65,t:1918.02},{s:76,t:80.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}],[{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}],[{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02},{s:65,t:18.02}]];let music,bounceSound,message;let titleScene,title,playButton,infoButton,menuShow,menuHide,fullscreenState;let levelInfoBox,levelMsg,levelUpButton,levelDownButton,levelInfoBoxGroup;let sceneInfoBox,sceneMsg,sceneUpButton,sceneDownButton,sceneInfoBoxGroup;let blocks,arrayImages,img1,gameScene,img2,img3,blocksImg_12,blocksImg_14,blocksImg_16,infoBox1,msgGroup,msg11,msg21,msg31,MsgInfo,MsgInfo1,MsgInfo2,homeButton,restartButton,saveToDiskButton,pauseButton,pauseOnButton,saveButton,saveInButton,saveOutButton,saveGroup,saveOkCancelGroup,saveMsgGroup,saveImgBorder,saveImgInBorder,saveMsg_1,saveMsg_2,saveMsg_3,saveMsg_4,saveMsg_5,saveMsg_6,saveMsg_11,saveMsg_21,saveMsg_31,saveOkButton,saveCancelButton,infoGameButton,infoBox1Group,infoBox2,msgGroup2,infoBox2Group,infoBox3,infoBox3Group,infoBox4,msg41,sceneMsgDim=["12x12","14x14","16x16"],msg42,infoBox4Group,groupInfo,secondPage,infoGamePNG,infoGameMsg,infoGameGroup;let yo={},walk=[],stepArray=[];let scenePlaying=1,levelPlaying=1,levelToPlay=scene.level[scenePlaying-1][levelPlaying-1];let scaleAllButtons=1,scaleText=1;let intervalId=setInterval(()=>g.progressBar.update(),5);document.addEventListener("myProper",e=>console.log("From my proper ",e.text));let padDimension=512,padArray=[],buttonsMoveArr=[],buttonsToShowHide=[];let pad_1_group,pad_1_up,pad_1_down,pad_1_right,pad_1_left;let pad_2_group,pad_2_up,pad_2_down,pad_2_right,pad_2_left;let isMobile=/Mobile/i.test(navigator.userAgent),pixelRatio=window.devicePixelRatio.toFixed(2),isTouch=false;if("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0||"ontouchstart"in document.documentElement||"touchstart"in document.documentElement){isTouch=true}if(isMobile){if(pixelRatio>=3.5&&pixelRatio<=4.2){scaleAllButtons=1.2;scaleText=1.2}else if(pixelRatio>=2.8&&pixelRatio<3.5){scaleAllButtons=1.5;scaleText=1.2}else{scaleAllButtons=1.6;scaleText=1.5}}let g=new game(gameWidth,gameHeight,setup,["images/walk_512.json","images/info_box.png","images/info_level_box.png","images/view_420x1080.png","images/blocksBorder_12x12.png","images/blocksBorder_14x14.png","images/blocksBorder_16x16.png","images/b_info_up.png","images/b_info_over.png","images/b_scene_up.png","images/b_scene_over.png","images/b_scene_top_up.png","images/b_scene_top_over.png","images/b_play_up.png","images/b_play_over.png","images/infogame.png","images/yo_level_512.png","images/save_img.png","images/save_img_in.png","images/save_ok_512_up.png","images/save_ok_512_over.png","images/save_cancel_512_up.png","images/save_cancel_512_over.png","images/save_512_up.png","images/save_512_over.png","images/save_512_in_up.png","images/save_512_in_over.png","images/save_512_out_up.png","images/save_512_out_over.png","images/infogame_512_up.png","images/infogame_512_over.png","images/restart_512_up.png","images/restart_512_over.png","images/pause_512_up.png","images/pause_512_over.png","images/pause_on_512_up.png","images/pause_on_512_over.png","images/home_512_up.png","images/home_512_over.png","images/menu_512_up.png","images/menu_512_over.png","images/menu_open_512_up.png","images/menu_open_512_over.png","images/road_512.png","images/forest_512.png","images/forest.png","images/forest24.jpg","images/box_512.png","images/bananas_0_512.png","images/bananas_512_neutral.png","images/fond_ecran_950.jpg","images/emoji_yo.png","sounds/bounce.wav","sounds/music.wav","fonts/puzzler.otf","images/pad_512_up_up.png","images/pad_512_up_over.png","images/pad_512_down_up.png","images/pad_512_down_over.png","images/pad_512_right_up.png","images/pad_512_right_over.png","images/pad_512_left_up.png","images/pad_512_left_over.png","images/step_512_neutral.png","images/time_512_neutral.png","images/fullscreen_on_512_up.png","images/fullscreen_on_512_over.png","images/fullscreen_off_512_up.png","images/fullscreen_off_512_over.png","images/sound_yes_240_up.png","images/sound_yes_240_over.png","images/sound_no_240_up.png","images/sound_no_240_over.png","images/b_about_up_128.png","images/b_about_over_128.png"],load);main.appendChild(g.canvas);window.infoHide=event=>{infoDiv.classList.remove("show");infoDiv.classList.add("hide")};window.about=event=>{infoIframe.src="./html_page/about.html"};window.general=event=>{infoIframe.src="./html_page/general.html"};window.buttonsExplained=event=>{infoIframe.src="./html_page/buttonsexplained.html"};window.spareButton=event=>{infoIframe.src="./html_page/sparebutton.html"};let leftArrow=g.keyboard(37),upArrow=g.keyboard(38),rightArrow=g.keyboard(39),downArrow=g.keyboard(40);let keyboard={leftArrow:leftArrow,upArrow:upArrow,rightArrow:rightArrow,downArrow:downArrow};g.start();g.scaleToWindow(std);window.addEventListener("resize",event=>{g.scaleToWindow(std);updateMsgInfo();updateCSSVariables();updateInfoIframe()});document.addEventListener("fullscreenchange",event=>{g.scaleToWindow(std);updateMsgInfo();fullscreenState?fullscreenState=false:fullscreenState=true;if(!fullscreenState){btn_1.src=g.assets["images/fullscreen_on_512_over.png"].src}else{btn_1.src=g.assets["images/fullscreen_off_512_over.png"].src}});function load(){if(g.progressBar.counter===0){g.progressBar.setBackgroundColor("#FFA80F");g.progressBar.setForegroundColor("#FFEC4B");g.progressBar.create(g.canvas,g.assets,g.canvas.width/2,100)}g.progressBar.update()}function setup(){g.progressBar.remove();clearInterval(intervalId);createButtonMenu();arrayImages=[g.assets["walkDownRight.png"],g.assets["images/road_512.png"],g.assets["images/forest_512.png"],g.assets["images/box_512.png"],g.assets["images/bananas_0_512.png"],g.assets["walkUpRight.png"],g.assets["walkUpLeft.png"],g.assets["walkUpRightPush.png"],g.assets["walkUpLeftPush.png"],g.assets["walkDownRight.png"],g.assets["walkDownLeft.png"],g.assets["walkDownRightPush.png"],g.assets["walkDownLeftPush.png"],g.assets["walkRightRight.png"],g.assets["walkRightLeft.png"],g.assets["walkRightRightPush.png"],g.assets["walkRightLeftPush.png"],g.assets["walkLeftRight.png"],g.assets["walkLeftLeft.png"],g.assets["walkLeftRightPush.png"],g.assets["walkLeftLeftPush.png"]];yo.setVisible=()=>{walk.forEach(pose=>{if(pose===yo.activeSprite){pose.visible=true}else{pose.visible=false;pose.gridX=-10;pose.gridY=-10}})};yo.layer=3;yo.bananasToEat=0;yo.move=moveModule.moveScene;initialiseMusic();buildFirstPage();buildGroupInfo1();setFirstTime(1,1);buildSaveGoup();updateCSSVariables();rightArrow.press=()=>{yo.move("right",blocks,yo,walk);stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"r"})};upArrow.press=()=>{yo.move("up",blocks,yo,walk);stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"u"})};leftArrow.press=()=>{yo.move("left",blocks,yo,walk);stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"l"})};downArrow.press=()=>{yo.move("down",blocks,yo,walk);stepArray.push({x:this.yo.activeSprite.gridX,y:this.yo.activeSprite.gridY,d:"d"})};buttonsMoveArr=[upArrow,downArrow,rightArrow,leftArrow,pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_up,pad_2_down,pad_2_right,pad_2_left];g.setButtonsMove(buttonsMoveArr,pauseButton)}function play(){if(yo.bananasToEat===0){g.pause();g.endGame();g.wait(1e3).then(()=>end())}}function end(){music.volume=.3;updateGameInfo("end")}function homePress(){MsgInfo.visible=true;MsgInfo1.visible=true;MsgInfo2.visible=true;if(infoGameGroup.visible){infoGameGroup.visible=false;padArray.forEach(pad=>pad.interactive=true)}resetAllParameters(scenePlaying,levelPlaying,"homePress");updateFirstPage(scenePlaying,levelPlaying);let tweenTest=g.slide(secondPage,-g.canvas.width,g.canvas.height,30,["decelerationCubed"]);tweenTest.onComplete=()=>{updatePolygonPoinst()};g.slide(titleScene,0,0,30,["decelerationCubed"]);g.endGame()}function stopAllPressed(){if(gameInfo.t===0||!g.isPlaying){pauseButton.visible=true;pauseOnButton.visible=false;return}if(pauseButton.visible){g.pause();pauseButton.visible=false;pauseOnButton.visible=true}else{g.resume();pauseButton.visible=true;pauseOnButton.visible=false}resetAllParameters(scenePlaying,levelPlaying,"restart");g.slide(secondPage,0,0,30,["decelerationCubed"]);g.state=play}function restart(){resetAllParameters(scenePlaying,levelPlaying,"restart");g.slide(secondPage,0,0,30,["decelerationCubed"]);g.state=play}function menuShowPress(){if(infoGameGroup.visible){infoGameGroup.visible=false;padArray.forEach(pad=>pad.interactive=true)}if(menuShow.visible){menuShow.visible=false;menuHide.visible=true;g.fadeIn(menuHide,30);let tween=g.fadeOut(menuShow,30);menu.classList.remove("hide");menu.classList.add("show")}else{menuShow.visible=true;menuHide.visible=false;g.fadeIn(menuShow,30);let tween=g.fadeOut(menuHide,30);menu.classList.remove("show");menu.classList.add("hide")}}function savePress(){if(infoGameGroup.visible)infoGameGroup.visible=false;updateSaveGoup();g.slide(saveGroup,g.canvas.width*.5-760*.5,g.canvas.height*.5-512*.5,30)}function pausePressed(){if(gameInfo.t>10){if(g.isPlaying)g.pause();else g.resume()}if(pauseButton.visible){pauseButton.visible=false;pauseOnButton.visible=true;setTimeout(()=>{pauseButton.interactive=false;pauseOnButton.interactive=true;buttonsToShowHide.forEach((btn,i)=>{if(i<=2){btn.visible=true;btn.interactive=true}else{btn.visible=true}})},200)}else{pauseButton.visible=true;pauseOnButton.visible=false;setTimeout(()=>{pauseButton.interactive=true;pauseOnButton.interactive=false;buttonsToShowHide.forEach((btn,i)=>{if(i<=2){btn.visible=false;btn.interactive=false}else{btn.visible=false}})},200)}}function home(){resetAllParameters(scenePlaying,levelPlaying,"home");updateFirstPage(scenePlaying,levelPlaying);g.slide(secondPage,-g.canvas.width,g.canvas.height,30,["decelerationCubed"]);g.slide(titleScene,0,0,30,["decelerationCubed"]);g.endGame();end()}function resetAllParameters(sceneToSet,levelToSet,from){if(sceneToSet<1&&sceneToSet>4){throw new Error(`This level : ${sceneToSet} is not developped yet.`)}if(sceneToSet===1){if(levelToSet<1&&levelToSet>9)throw new Error(`This level : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=12}else if(sceneToSet===2){if(levelToSet<1&&levelToSet>9)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=14}else if(sceneToSet===3){if(levelToSet<1&&levelToSet>9)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=16}else throw new Error(`This scene : ${sceneToSet} is not developped yet.`);levelToPlay=scene.level[sceneToSet-1][levelToSet-1];levelPlaying=levelToSet;scenePlaying=sceneToSet;saveGameInfoLast();gameScene.remove(blocks);yo.bananasToEat=0;blocks=g.gridSpecial(gridWidth,gridHeight,cellWidth,cellHeight,levelToPlay,arrayImages,yo,walk,std.scaleFactor(),false,0,0);yo.activeSprite=walk[4];yo.setVisible();stepArray=[];stepArray.push({x:yo.activeSprite.gridX,y:yo.activeSprite.gridY,d:"s"});g.setYo(yo);g.setStepArray(stepArray);updateGameInfo("resetAll");gameInfo.t=0;gameInfo.s=0;gameInfo.b=yo.bananasToEat;g.setGameInfo(gameInfo);updateGameInfoMsgs();if(scenePlaying===1){blocksImg_12.visible=true;blocksImg_14.visible=false;blocksImg_16.visible=false;blocks.addChild(blocksImg_12)}else if(scenePlaying===2){blocksImg_12.visible=false;blocksImg_14.visible=true;blocksImg_16.visible=false;blocks.addChild(blocksImg_14)}else if(scenePlaying===3){blocksImg_12.visible=false;blocksImg_14.visible=false;blocksImg_16.visible=true;blocks.addChild(blocksImg_16)}else throw new Error(`Scene playing : ${scenePlaying} not possible.`);gameScene.addChild(blocks);moveModule.setScene(sceneToSet,std);msg11.content=` ${stepArray.length-1}`;msg31.content=` ${yo.bananasToEat}`;menu.classList.contains("show")?menuShow.press():null}function setFirstTime(sceneToSet,levelToSet){if(sceneToSet<1&&sceneToSet>3){throw new Error(`This level : ${sceneToSet} is not developped yet.`)}if(sceneToSet===1){if(levelToSet<1&&levelToSet>9)throw new Error(`This level : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=12}else if(sceneToSet===2){if(levelToSet<1&&levelToSet>9)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=14}else if(sceneToSet===3){if(levelToSet<1&&levelToSet>9)throw new Error(`This levelToSet : ${levelToSet} is not developped yet.`);gridWidth=gridHeight=16}else throw new Error(`This scene : ${sceneToSet} is not developped yet.`);levelToPlay=scene.level[sceneToSet-1][levelToSet-1];levelPlaying=levelToSet;scenePlaying=sceneToSet;blocks=g.gridSpecial(gridWidth,gridHeight,cellWidth,cellHeight,levelToPlay,arrayImages,yo,walk,std.scaleFactor(),false,0,0);yo.activeSprite=walk[4];yo.setVisible();stepArray=[];g.setYo(yo);g.setStepArray(stepArray);gameInfo.b=yo.bananasToEat;g.setGameInfo(gameInfo);img1=g.sprite(g.assets["images/forest24.jpg"]);img1.layer=-1;img1.pivotX=0;img1.pivotY=0;blocksImg_12=g.sprite(g.assets["images/blocksBorder_12x12.png"]);blocksImg_14=g.sprite(g.assets["images/blocksBorder_14x14.png"]);blocksImg_16=g.sprite(g.assets["images/blocksBorder_16x16.png"]);blocksImg_12.layer=blocksImg_14.layer=blocksImg_16.layer=4;if(scenePlaying===1){blocksImg_12.visible=true;blocksImg_14.visible=false;blocksImg_16.visible=false;blocks.addChild(blocksImg_12)}else if(scenePlaying===2){blocksImg_12.visible=false;blocksImg_14.visible=true;blocksImg_16.visible=false;blocks.addChild(blocksImg_14)}else if(scenePlaying===3){blocksImg_12.visible=false;blocksImg_14.visible=false;blocksImg_16.visible=true;blocks.addChild(blocksImg_16)}else throw new Error(`Scene playing : ${scenePlaying} not possible.`);gameScene=g.group(img1,blocks);gameScene.x=420;gameScene.layer=2;secondPage=g.group(gameScene,groupInfo);secondPage.x=-g.canvas.width;secondPage.y=g.canvas.height;secondPage.layer=-1;updatePolygonPoinst();moveModule.setScene(sceneToSet,std);menuShowPress()}function initialiseMusic(){bounceSound=g.assets["sounds/bounce.wav"];music=g.assets["sounds/music.wav"];music.loop=true}function buildFirstPage(){MsgInfo=g.text(`First`,"40px puzzler","deepskyblue");MsgInfo.y=g.canvas.height-135;MsgInfo1=g.text(`First`,"40px puzzler","deepskyblue");MsgInfo1.y=g.canvas.height-90;MsgInfo2=g.text(`First`,"40px puzzler","deepskyblue");MsgInfo2.y=g.canvas.height-45;let deltaButtom=200;title=g.sprite(g.assets["images/fond_ecran_950.jpg"]);title.x=(g.canvas.width-title.width)/2;title.y=(g.canvas.height-title.height)/2;if(!scenePlaying)scenePlaying=1;if(!levelPlaying)levelPlaying=1;let posX=20,posY=40,delta=20;menuHide=g.button([g.assets["images/menu_open_512_up.png"],g.assets["images/menu_open_512_over.png"],g.assets["images/menu_open_512_up.png"]]);menuHide.x=10;menuHide.y=10;menuHide.pivotX=0;menuHide.pivotY=0;menuHide.scaleX=scaleButton;menuHide.scaleY=scaleButton;menuHide.layer=20;menuHide.visible=false;menuHide.interactive=false;menuShow=g.button([g.assets["images/menu_512_up.png"],g.assets["images/menu_512_over.png"],g.assets["images/menu_512_up.png"]]);menuShow.x=10,menuShow.y=10;menuShow.pivotX=0;menuShow.pivotY=0;menuShow.scaleX=scaleButton;menuShow.scaleY=scaleButton;menuShow.layer=20;menuShow.press=()=>menuShowPress();sceneInfoBox=g.sprite(g.assets["images/info_level_box.png"]);sceneMsg=g.text(`12x12`,"50px puzzler","black",posX,posY);sceneMsg.content=sceneMsgDim[scenePlaying-1];sceneMsg.x=sceneInfoBox.width/4;sceneMsg.y=sceneInfoBox.height/2-50/2;sceneUpButton=g.button([g.assets["images/b_scene_top_up.png"],g.assets["images/b_scene_top_over.png"],g.assets["images/b_scene_top_up.png"]]);sceneUpButton.x=sceneInfoBox.width/2-sceneUpButton.width/2;sceneUpButton.y=sceneInfoBox.height/4-sceneUpButton.height/2;sceneUpButton.press=()=>{if(scenePlaying<3){scenePlaying+=1;resetAllParameters(scenePlaying,levelPlaying,"scenePress");g.slide(sceneMsg,sceneMsg.x,sceneMsg.y-2*delta,10,["smoothstep"]);g.fadeOut(sceneMsg,10);setTimeout(()=>{sceneMsg.content=sceneMsgDim[scenePlaying-1];sceneMsg.y+=4*delta;g.slide(sceneMsg,sceneMsg.x,sceneInfoBox.height/2-50/2,15,["smoothstep"]);g.fadeIn(sceneMsg,15)},100)}else return};sceneDownButton=g.button([g.assets["images/b_scene_up.png"],g.assets["images/b_scene_over.png"],g.assets["images/b_scene_up.png"]]);sceneDownButton.x=sceneInfoBox.width/2-sceneDownButton.width/2;sceneDownButton.y=3*sceneInfoBox.height/4-sceneUpButton.height/2;sceneDownButton.press=()=>{if(scenePlaying>1){scenePlaying-=1;resetAllParameters(scenePlaying,levelPlaying,"scenePress");g.slide(sceneMsg,sceneMsg.x,sceneMsg.y+2*delta,10,["smoothstep"]);g.fadeOut(sceneMsg,10);setTimeout(()=>{sceneMsg.content=sceneMsgDim[scenePlaying-1];sceneMsg.y-=4*delta;g.slide(sceneMsg,sceneMsg.x,sceneInfoBox.height/2-50/2,15,["smoothstep"]);g.fadeIn(sceneMsg,15)},200)}else return};sceneInfoBoxGroup=g.group(sceneInfoBox,sceneMsg,sceneUpButton,sceneDownButton);sceneInfoBoxGroup.x=-g.canvas.width;sceneInfoBoxGroup.y=-g.canvas.height;levelInfoBox=g.sprite(g.assets["images/info_level_box.png"]);levelMsg=g.text(`Level ${levelPlaying}`,"50px puzzler","black",posX,posY);levelMsg.x=sceneInfoBox.width/4;levelMsg.y=sceneInfoBox.height/2-50/2;levelUpButton=g.button([g.assets["images/b_scene_top_up.png"],g.assets["images/b_scene_top_over.png"],g.assets["images/b_scene_top_up.png"]]);levelUpButton.press=()=>{if(levelPlaying<9){levelPlaying+=1;resetAllParameters(scenePlaying,levelPlaying,"levelPress");g.slide(levelMsg,levelMsg.x,levelMsg.y-2*delta,10,["smoothstep"]);g.fadeOut(levelMsg,10);setTimeout(()=>{levelMsg.content=`Level ${levelPlaying}`;levelMsg.y+=4*delta;g.slide(levelMsg,levelMsg.x,levelInfoBox.height/2-50/2,15,["smoothstep"]);g.fadeIn(levelMsg,15)},100)}else return};levelUpButton.x=levelInfoBox.width/2-levelUpButton.width/2;levelUpButton.y=levelInfoBox.height/4-levelUpButton.height/2;levelDownButton=g.button([g.assets["images/b_scene_up.png"],g.assets["images/b_scene_over.png"],g.assets["images/b_scene_up.png"]]);levelDownButton.x=levelInfoBox.width/2-levelDownButton.width/2;levelDownButton.y=3*levelInfoBox.height/4-levelUpButton.height/2;levelDownButton.press=()=>{if(levelPlaying>1){levelPlaying-=1;resetAllParameters(scenePlaying,levelPlaying,"levelPress");g.slide(levelMsg,levelMsg.x,levelMsg.y+2*delta,10,["smoothstep"]);g.fadeOut(levelMsg,10);setTimeout(()=>{levelMsg.content=`Level ${levelPlaying}`;levelMsg.y-=4*delta;g.slide(levelMsg,levelMsg.x,levelInfoBox.height/2-50/2,15,["smoothstep"]);g.fadeIn(levelMsg,15)},100)}else return};levelMsg.y=levelInfoBox.height/2-50/2;levelInfoBoxGroup=g.group(levelInfoBox,levelMsg,levelUpButton,levelDownButton);levelInfoBoxGroup.x=g.canvas.width;levelInfoBoxGroup.y=-g.canvas.height;infoButton=g.button([g.assets["images/b_info_up.png"],g.assets["images/b_info_over.png"],g.assets["images/b_info_up.png"]]);infoButton.x=(g.canvas.width-title.width)/4-infoButton.width*.5*scaleAllButtons/2;infoButton.y=gameHeight-infoButton.width;infoButton.scaleX=.5*scaleAllButtons;infoButton.scaleY=.5*scaleAllButtons;infoButton.press=()=>{let s=g.rectangle(10,10,"#F7E9B8");s.pivotX=0;s.pivotY=0;s.x=infoButton.x+infoButton.width/2;s.y=infoButton.y+infoButton.height/2;let tween1=g.slide(s,s.x,100,30);g.tweenProperty(s,"scaleX",s.scaleX,180,30);let tween=g.tweenProperty(s,"scaleY",s.scaleY,80,30);tween1.onComplete=()=>{infoDiv.classList.remove("hide");infoDiv.classList.add("show");updateInfoIframe();g.remove(s)}};playButton=g.button([g.assets["images/b_play_up.png"],g.assets["images/b_play_over.png"],g.assets["images/b_play_up.png"]]);playButton.x=gameWidth;playButton.y=gameHeight;playButton.scaleX=scaleAllButtons;playButton.scaleY=scaleAllButtons;playButton.press=()=>{MsgInfo.visible=false;MsgInfo1.visible=false;MsgInfo2.visible=false;g.slide(titleScene,g.canvas.width,g.canvas.height,30,["decelerationCubed"]);let tween=g.slide(secondPage,0,0,30,["decelerationCubed"]);tween.onComplete=()=>{updatePolygonPoinst()};if(!scenePlaying)scenePlaying=1;if(!levelPlaying)levelPlaying=1;sceneMsg.content=sceneMsgDim[scenePlaying-1];levelMsg.content=`Level ${levelPlaying}`;resetAllParameters(scenePlaying,levelPlaying,"playPress");updateFirstPage(scenePlaying,levelPlaying);g.state=play};g.slide(playButton,g.canvas.width-(g.canvas.width-title.width)/4-playButton.width/2,g.canvas.height*.75-playButton.width/2,30,["decelerationCubed"]);g.slide(sceneInfoBoxGroup,(g.canvas.width-title.width)/4-sceneInfoBoxGroup.width/2,title.y+sceneInfoBoxGroup.height/2,30,["decelerationCubed"]);g.slide(levelInfoBoxGroup,g.canvas.width-(g.canvas.width-title.width)/4-levelInfoBoxGroup.width/2,title.y+levelInfoBoxGroup.height/2,30,["decelerationCubed"]);titleScene=g.group(title,infoButton,playButton,levelInfoBoxGroup,sceneInfoBoxGroup,menuShow,menuHide)}function updateFirstPage(scene,level){scenePlaying=scene;levelPlaying=level;sceneMsg.content=sceneMsgDim[scenePlaying-1];levelMsg.content=`Level ${levelPlaying}`}function updateMsgInfo(){MsgInfo.layer=100;MsgInfo1.layer=100;MsgInfo2.layer=100;MsgInfo.content=`is_M=${isMobile} & is_T=${isTouch} | DPI=${pixelRatio} `;MsgInfo1.content=`WA=${window.screen.availWidth},HA=${window.screen.availHeight}`;MsgInfo1.content+=` | WW=${window.innerWidth},WH=${window.innerHeight}`;MsgInfo1.content+=` | VW=${visualViewport.width},VH=${visualViewport.height}`;MsgInfo2.content=`S_C=${std.scaleCanvas.toFixed(2)} & S_X= ${std.scaleX.toFixed(2)} & S_Y= ${std.scaleY.toFixed(2)}`}function buildGroupInfo1(){function buildButtons(){pad_1_up=g.button([g.assets["images/pad_512_up_up.png"],g.assets["images/pad_512_up_over.png"],g.assets["images/pad_512_up_up.png"]],[]);pad_1_up.press=()=>{upArrow.press()};pad_1_down=g.button([g.assets["images/pad_512_down_up.png"],g.assets["images/pad_512_down_over.png"],g.assets["images/pad_512_down_up.png"]],[]);pad_1_down.press=()=>{downArrow.press()};pad_1_right=g.button([g.assets["images/pad_512_right_up.png"],g.assets["images/pad_512_right_over.png"],g.assets["images/pad_512_right_up.png"]],[]);pad_1_right.press=()=>{rightArrow.press()};pad_1_left=g.button([g.assets["images/pad_512_left_up.png"],g.assets["images/pad_512_left_over.png"],g.assets["images/pad_512_left_up.png"]],[]);pad_1_left.press=()=>{leftArrow.press()};pad_1_group=g.group(pad_1_up,pad_1_down,pad_1_right,pad_1_left);pad_1_group.x=10;pad_1_group.y=g.canvas.height/2-pad_1_group.height/4*scalePad;pad_1_group.scaleX=pad_1_group.scaleY=scalePad;pad_2_up=g.button([g.assets["images/pad_512_up_up.png"],g.assets["images/pad_512_up_over.png"],g.assets["images/pad_512_up_up.png"]],[]);pad_2_up.press=()=>{upArrow.press()};pad_2_down=g.button([g.assets["images/pad_512_down_up.png"],g.assets["images/pad_512_down_over.png"],g.assets["images/pad_512_down_up.png"]],[]);pad_2_down.press=()=>{downArrow.press()};pad_2_right=g.button([g.assets["images/pad_512_right_up.png"],g.assets["images/pad_512_right_over.png"],g.assets["images/pad_512_right_up.png"]],[]);pad_2_right.press=()=>{rightArrow.press()};pad_2_left=g.button([g.assets["images/pad_512_left_up.png"],g.assets["images/pad_512_left_over.png"],g.assets["images/pad_512_left_up.png"]],[]);pad_2_left.press=()=>{leftArrow.press()};pad_2_group=g.group(pad_2_up,pad_2_down,pad_2_right,pad_2_left);pad_2_group.x=g.canvas.width-pad_2_group.width*scalePad-10;pad_2_group.y=g.canvas.height/2-pad_2_group.height/4*scalePad;pad_2_group.scaleX=scalePad;pad_2_group.scaleY=scalePad;padArray.push(pad_1_up,pad_1_down,pad_1_right,pad_1_left,pad_2_up,pad_2_down,pad_2_right,pad_2_left)}function buildInfoGameGroup(){infoGamePNG=g.sprite(g.assets["images/infogame.png"]);infoGameGroup=g.group(infoGamePNG);let fontMsg="60px puzzler";let fontSize=60;let charSize=15;let nbrChar=4;let fontColor="black";infoGameMsg=[[g.text(`First`,`${fontMsg}`,`${fontColor}`,415-nbrChar*charSize,367-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,636-charSize,367-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,864-5*charSize,367-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1092-charSize,367-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1300-fontSize,367-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1504-charSize,367-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1716-fontSize,367-fontSize/2)],[g.text(`First`,`${fontMsg}`,`${fontColor}`,415-nbrChar*charSize,594-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,636-charSize,594-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,864-5*charSize,594-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1092-charSize,594-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1300-fontSize,594-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1504-charSize,594-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1716-fontSize,594-fontSize/2)],[g.text(`First`,`${fontMsg}`,`${fontColor}`,415-nbrChar*charSize,816-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,636-charSize,816-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,864-5*charSize,816-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1092-charSize,816-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1300-fontSize,816-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1504-charSize,816-fontSize/2),g.text(`First`,`${fontMsg}`,`${fontColor}`,1716-fontSize,816-fontSize/2)]];infoGameMsg.forEach(msg=>{msg.forEach(m=>{m.pivotX=m.pivotY=.5})});infoGameMsg[0][0].content="23.82";infoGameMsg[0][1].content="=";for(let i=0;i<3;i++){for(let j=0;j<7;j++){infoGameGroup.add(infoGameMsg[i][j])}}infoGameGroup.visible=false}buildInfoGameGroup();infoGameGroup.x=(g.canvas.width-1888)/2;infoGameGroup.y=menuShow.y+menuShow.height*scaleButton+10;homeButton=g.button([g.assets["images/home_512_up.png"],g.assets["images/home_512_over.png"],g.assets["images/home_512_up.png"]]);homeButton.press=()=>homePress();homeButton.x=g.canvas.width-1.1*homeButton.width*scaleButton;homeButton.y=10;homeButton.scaleX=scaleButton;homeButton.scaleY=scaleButton;infoGameButton=g.button([g.assets["images/infogame_512_up.png"],g.assets["images/infogame_512_over.png"],g.assets["images/infogame_512_up.png"]]);infoGameButton.press=()=>{if(infoGameGroup.visible){infoGameGroup.visible=false;padArray.forEach(pad=>pad.interactive=true)}else{infoGameGroup.visible=true;updateGameInfo("infoBtn");padArray.forEach(pad=>pad.interactive=false)}};infoGameButton.x=homeButton.x-1.1*infoGameButton.width*scaleButton;infoGameButton.y=10;infoGameButton.scaleX=scaleButton;infoGameButton.scaleY=scaleButton;infoGameButton.visible=false;infoGameButton.interactive=false;buttonsToShowHide.push(infoGameButton);pauseButton=g.button([g.assets["images/pause_512_up.png"],g.assets["images/pause_512_over.png"],g.assets["images/pause_512_up.png"]]);pauseButton.press=()=>pausePressed();if(infoGameGroup.visible){infoGameGroup.visible=false;padArray.forEach(pad=>pad.interactive=true)}pauseButton.x=menuShow.x;pauseButton.y=10;pauseButton.scaleX=scaleButton;pauseButton.scaleY=scaleButton;pauseOnButton=g.button([g.assets["images/pause_on_512_up.png"],g.assets["images/pause_on_512_over.png"],g.assets["images/pause_on_512_up.png"]]);pauseOnButton.press=()=>pausePressed();if(infoGameGroup.visible){infoGameGroup.visible=false;padArray.forEach(pad=>pad.interactive=true)}pauseOnButton.x=menuShow.x;pauseOnButton.y=10;pauseOnButton.scaleX=scaleButton;pauseOnButton.scaleY=scaleButton;pauseOnButton.visible=false;pauseOnButton.interactive=false;restartButton=g.button([g.assets["images/restart_512_up.png"],g.assets["images/restart_512_over.png"],g.assets["images/restart_512_up.png"]]);restartButton.press=()=>{if(infoGameGroup.visible){infoGameGroup.visible=false;padArray.forEach(pad=>pad.interactive=true)}restart()};restartButton.x=menuShow.x+1.1*menuShow.width*scaleButton;restartButton.y=10;restartButton.scaleX=scaleButton;restartButton.scaleY=scaleButton;restartButton.visible=false;restartButton.interactive=false;buttonsToShowHide.push(restartButton);saveButton=g.button([g.assets["images/save_512_up.png"],g.assets["images/save_512_over.png"],g.assets["images/save_512_up.png"]]);saveButton.press=()=>savePress();saveButton.x=restartButton.x+1.1*saveButton.width*scaleButton;saveButton.y=10;saveButton.scaleX=scaleButton;saveButton.scaleY=scaleButton;saveButton.visible=false;saveButton.interactive=false;buttonsToShowHide.push(saveButton);saveToDiskButton=g.button([g.assets["images/b_about_up_128.png"],g.assets["images/b_about_over_128.png"],g.assets["images/b_about_up_128.png"]]);saveToDiskButton.press=()=>saveToDisk();saveToDiskButton.x=restartButton.x;saveToDiskButton.y=g.canvas.height-saveToDiskButton.height-10;img2=g.sprite(g.assets["images/view_420x1080.png"]);img3=g.sprite(g.assets["images/view_420x1080.png"]);img3.x=1500;infoBox1=g.sprite(g.assets["images/step_512_neutral.png"]);infoBox1.x=0;infoBox1.y=0;infoBox1.scaleX=scaleButton;infoBox1.scaleY=scaleButton;msg11=g.text(` : ${stepArray.length-1}`,"60px puzzler","black");msg11.x=infoBox1.width*scaleButton+10;msg11.y=infoBox1.height*scaleButton/2-30;msg11.pivotX=0;msg11.pivotY=0;msg11.scaleX=scaleText;msg11.scaleY=scaleText;g.pushMessage(msg11);infoBox2=g.sprite(g.assets["images/time_512_neutral.png"]);infoBox2.x=0;infoBox2.y=0;infoBox2.scaleX=scaleButton;infoBox2.scaleY=scaleButton;msg21=g.text(` : `,"60px puzzler","black");msg21.x=infoBox2.width*scaleButton+10;msg21.y=infoBox2.height*scaleButton/2-30;msg21.pivotX=0;msg21.pivotY=0;msg21.scaleX=scaleText;msg21.scaleY=scaleText;g.pushMessage(msg21);infoBox3=g.sprite(g.assets["images/bananas_512_neutral.png"]);infoBox3.x=0;infoBox3.y=0;infoBox3.scaleX=scaleButton;infoBox3.scaleY=scaleButton;msg31=g.text(` : ${yo.bananasToEat}`,"60px puzzler","black");msg31.x=infoBox3.width*scaleButton+10;msg31.y=infoBox3.height*scaleButton/2-30;msg31.pivotX=0;msg31.pivotY=0;msg31.scaleX=scaleText;msg31.scaleY=scaleText;g.pushMessage(msg31);infoBox4=g.sprite(g.assets["images/yo_level_512.png"]);infoBox4.x=0;infoBox4.y=0;infoBox4.scaleX=scaleButton;infoBox4.scaleY=scaleButton;msg41=g.text(``,"40px puzzler","black");msg41.x=infoBox4.width*scaleButton+10;msg41.y=infoBox4.height*scaleButton/2-40;msg41.pivotX=0;msg41.pivotY=0;msg41.scaleX=scaleText;msg41.scaleY=scaleText;msg42=g.text(``,"40px puzzler","black");msg42.x=infoBox4.width*scaleButton+10;msg42.y=infoBox4.height*scaleButton/2+10;msg42.pivotX=0;msg42.pivotY=0;msg42.scaleX=scaleText;msg42.scaleY=scaleText;updateGameInfoMsgs();updateMsgInfo();infoBox1Group=g.group(infoBox1,msg11);infoBox1Group.x=0;infoBox1Group.y=0;infoBox2Group=g.group(infoBox2,msg21);infoBox2Group.x=0;infoBox2Group.y=0;infoBox3Group=g.group(infoBox3,msg31);infoBox3Group.x=0;infoBox3Group.y=infoBox1Group.height*scaleButton*1.1+infoBox1Group.y;infoBox3Group.visible=false;buttonsToShowHide.push(infoBox3Group);infoBox4Group=g.group(infoBox4,msg41,msg42);infoBox4Group.x=0;infoBox4Group.y=infoBox2Group.height*scaleButton*1.1+infoBox2Group.y;infoBox4Group.visible=false;buttonsToShowHide.push(infoBox4Group);buildButtons();msgGroup=g.group(infoBox1Group,infoBox3Group);msgGroup.x=10;msgGroup.y=1.1*menuShow.height*scaleButton;msgGroup2=g.group(infoBox2Group,infoBox4Group);msgGroup2.x=g.canvas.width-img2.width+10;msgGroup2.y=1.1*infoGameButton.height*scaleButton;groupInfo=g.group(img2,img3,msgGroup,msgGroup2,homeButton,infoGameButton,restartButton,pauseButton,pauseOnButton,saveButton,pad_1_group,pad_2_group,infoGameGroup,saveToDiskButton);groupInfo.layer=5;updatePolygonPoinst()}function updateGameInfoMsgs(){msg11.content=` ${stepArray.length-1}`;msg21.content=gameInfo.t<=0?` : .....`:timeToString(gameInfo.t);msg31.content=` ${yo.bananasToEat}`;msg41.content=sceneMsgDim[scenePlaying-1];msg42.content=`     ${levelPlaying}`}function updatePolygonPoinst(){let padFactor=padDimension*scalePad;pad_1_up.points=[{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.406*padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+0*padFactor},{x:pad_1_group.gx+1*padFactor,y:pad_1_group.gy+0*padFactor},{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.406*padFactor}];pad_1_down.points=[{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.6*padFactor},{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.6*padFactor},{x:pad_1_group.gx+1*padFactor,y:pad_1_group.gy+1*padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+1*padFactor}];pad_1_right.points=[{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.406*padFactor},{x:pad_1_group.gx+1*padFactor,y:pad_1_group.gy+0*padFactor},{x:pad_1_group.gx+1*padFactor,y:pad_1_group.gy+1*padFactor},{x:pad_1_group.gx+.6*padFactor,y:pad_1_group.gy+.6*padFactor}];pad_1_left.points=[{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.406*padFactor},{x:pad_1_group.gx+.406*padFactor,y:pad_1_group.gy+.6*padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+1*padFactor},{x:pad_1_group.gx+0*padFactor,y:pad_1_group.gy+0*padFactor}];pad_2_up.points=[{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.406*padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+0*padFactor},{x:pad_2_group.gx+1*padFactor,y:pad_2_group.gy+0*padFactor},{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.406*padFactor}];pad_2_down.points=[{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.6*padFactor},{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.6*padFactor},{x:pad_2_group.gx+1*padFactor,y:pad_2_group.gy+1*padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+1*padFactor}];pad_2_right.points=[{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.406*padFactor},{x:pad_2_group.gx+1*padFactor,y:pad_2_group.gy+0*padFactor},{x:pad_2_group.gx+1*padFactor,y:pad_2_group.gy+1*padFactor},{x:pad_2_group.gx+.6*padFactor,y:pad_2_group.gy+.6*padFactor}];pad_2_left.points=[{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.406*padFactor},{x:pad_2_group.gx+.406*padFactor,y:pad_2_group.gy+.6*padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+1*padFactor},{x:pad_2_group.gx+0*padFactor,y:pad_2_group.gy+0*padFactor}]}function setResart(){}function putBackgroundCanvas(image,x,y,width,height){g.canvas.style.background=`url(${image}) no-repeat`;g.canvas.style.backgroundPosition=`${x}px ${y}px`;g.canvas.style.backgroundSize=`${width}px ${height}px`}function pixelToVw(pixel){return(pixel/window.innerWidth*100).toFixed(2)}function pixelToVh(pixel){return(pixel/window.innerHeight*100).toFixed(2)}function updateCSSVariables(){let r=document.querySelector(":root");let rvar=getComputedStyle(r);let btn_width=Math.floor(menuShow.width*scaleButton*std.scaleCanvas);let btn_height=Math.floor(menuShow.width*scaleButton*std.scaleCanvas);let menu_top=g.canvas.offsetTop;let menu_gap=10;let border_iframe=10;let top=g.canvas.offsetTop+menuShow.y;let left=g.canvas.offsetLeft+menuShow.width*scaleButton*std.scaleX+10;if(isMobile){menu_gap=5;border_iframe=5;top=5;left=left-10}r.style.setProperty("--btn-width",btn_width+"px");r.style.setProperty("--btn-height",btn_height+"px");r.style.setProperty("--menu-top",top+"px");r.style.setProperty("--menu-left",left+"px");r.style.setProperty("--menu-gap",menu_gap+"px");r.style.setProperty("--border-iframe",border_iframe+"px")}function updateInfoIframe(){let top=g.canvas.offsetTop+menuShow.height*scaleButton*std.scaleCanvas+10;let h=.95*(window.innerHeight-top);let w=.8*window.innerWidth;let rootvar=document.getElementById("infoframe").contentWindow.document.querySelector(":root");if(isMobile){rootvar.style.setProperty("--font-p",`15px`);rootvar.style.setProperty("--margin-p-v",`5px`);rootvar.style.setProperty("--margin-p-h",`10px`);rootvar.style.setProperty("--font-header",`15px`);rootvar.style.setProperty("--font-footer",`15px`);rootvar.style.setProperty("--font-buttons",`12px`);rootvar.style.setProperty("--btn-width",`80px`);rootvar.style.setProperty("--bnt-height",`25px`);rootvar.style.setProperty("--img-w",`64px`);rootvar.style.setProperty("--img-h",`64px`);rootvar.style.setProperty("--margin-flex",`5%`);rootvar.style.setProperty("--margin-line",`5px`)}let ten=.1*window.innerWidth;infoDiv.style.top=`${top}px`;infoDiv.style.width=`${w}px`;infoDiv.style.height=`${h}px`;infoDiv.style.margin=`0  ${ten}px`}function createButtonMenu(){btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src;btn_1.style.width="64px";btn_2.src=g.assets["images/sound_no_240_up.png"].src;btn_2.style.width="64px";btn_1.onclick=()=>{if(!document.fullscreenElement){main.requestFullscreen().catch(e=>console.log(e));btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src}else{document.exitFullscreen();btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src}};btn_1.ontouchstart=()=>{if(!document.fullscreenElement){main.requestFullscreen().catch(e=>console.log(e));btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src}else{document.exitFullscreen();btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src}};btn_1.addEventListener("mouseover",()=>{if(!fullscreenState){btn_1.src=g.assets["images/fullscreen_on_512_over.png"].src}else{btn_1.src=g.assets["images/fullscreen_off_512_over.png"].src}});btn_1.addEventListener("mouseleave",()=>{if(!fullscreenState){btn_1.src=g.assets["images/fullscreen_on_512_up.png"].src}else{btn_1.src=g.assets["images/fullscreen_off_512_up.png"].src}});btn_2.onclick=()=>{isSoundOn?isSoundOn=false:isSoundOn=true;isSoundOn?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src};btn_2.ontouchstart=()=>{isSoundOn?isSoundOn=false:isSoundOn=true;isSoundOn?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src};btn_2.addEventListener("mouseover",()=>{isSoundOn?btn_2.src=g.assets["images/sound_yes_240_over.png"].src:btn_2.src=g.assets["images/sound_no_240_over.png"].src});btn_2.addEventListener("mouseleave",()=>{isSoundOn?btn_2.src=g.assets["images/sound_yes_240_up.png"].src:btn_2.src=g.assets["images/sound_no_240_up.png"].src})}function saveGameInfoLast(){if(gameInfo.t>1e3){gameInfoLast.t=Object.values(gameInfo)[0];gameInfoLast.s=Object.values(gameInfo)[1];gameInfoLast.b=Object.values(gameInfo)[2]}}function timeToString(t){let secTotal,second_ten,second,minutes;secTotal=(t/1e3).toFixed(1);second_ten=secTotal.toString().substring(secTotal.toString().indexOf(".")+1);second=Math.floor(secTotal);minutes=Math.floor(second/60);let zeroSec="0",zeroMin="0";if(minutes>9)zeroMin="";if(second%60>9)zeroSec="";if(minutes<=0)return`${zeroSec}${second%60}.${second_ten}`;return`${zeroMin}${minutes}:${zeroSec}${second%60}.${second_ten}`}function updateGameInfo(from){let obj={};function fillLine(line,o){let fontMsg="60px puzzler";let fontSize=60;let charSize=15;let nbrChar=4;let fontColor="black";if(line===0){let first=undefined,second=undefined,third=undefined,fourth=undefined;if(o.first<=0){infoGameMsg[line][0].content="?";infoGameMsg[line][0].x=415-1*charSize;infoGameMsg[line][1].content="?"}else{first=(o.first/1e3).toFixed(1)*1;infoGameMsg[line][0].content=timeToString(o.first);infoGameMsg[line][0].x=415-timeToString(o.first).length*charSize}if(o.second<0){infoGameMsg[line][2].content="?";infoGameMsg[line][2].x=864-1*charSize;infoGameMsg[line][3].content="?"}else{second=(o.second/1e3).toFixed(1)*1;infoGameMsg[line][2].content=timeToString(o.second);infoGameMsg[line][2].x=864-timeToString(o.second).length*charSize}if(first!==undefined&&second!==undefined){first===second?infoGameMsg[line][1].content="=":first<second?infoGameMsg[line][1].content="<":infoGameMsg[line][1].content=">"}if(o.third<=0){infoGameMsg[line][4].content="?";infoGameMsg[line][4].x=1300-1*charSize;infoGameMsg[line][3].content="?";infoGameMsg[line][5].content="?"}else{third=(o.third/1e3).toFixed(1)*1;infoGameMsg[line][4].content=timeToString(o.third);infoGameMsg[line][4].x=1300-timeToString(o.third).length*charSize}if(second!==undefined&&third!==undefined){second===third?infoGameMsg[line][3].content="=":second<third?infoGameMsg[line][3].content="<":infoGameMsg[line][3].content=">"}if(o.fourth<=0){infoGameMsg[line][6].content="?";infoGameMsg[line][6].x=1716-1*charSize}else{fourth=(o.fourth/1e3).toFixed(1)*1;infoGameMsg[line][6].content=timeToString(o.fourth);infoGameMsg[line][6].x=1716-timeToString(o.fourth).length*charSize}if(third!==undefined&&fourth!==undefined){third===fourth?infoGameMsg[line][5].content="=":third<fourth?infoGameMsg[line][5].content="<":infoGameMsg[line][5].content=">"}}else if(line===1){let first=undefined,second=undefined,third=undefined,fourth=undefined;if(o.first<=0){infoGameMsg[line][0].content="?";infoGameMsg[line][0].x=415-1*charSize;infoGameMsg[line][1].content="?"}else{first=o.first;infoGameMsg[line][0].content=o.first.toString();infoGameMsg[line][0].x=415-o.first.toString().length*charSize}if(o.second<0){infoGameMsg[line][2].content="?";infoGameMsg[line][2].x=864-1*charSize}else{second=o.second;infoGameMsg[line][2].content=o.second.toString();infoGameMsg[line][2].x=864-o.second.toString().length*charSize}if(first!==undefined&&second!==undefined){o.first===o.second?infoGameMsg[line][1].content="=":o.first<o.second?infoGameMsg[line][1].content="<":infoGameMsg[line][1].content=">"}if(o.third<=0){infoGameMsg[line][4].content="?";infoGameMsg[line][4].x=1300-1*charSize;infoGameMsg[line][3].content="?";infoGameMsg[line][5].content="?"}else{third=o.third;infoGameMsg[line][4].content=o.third.toString();infoGameMsg[line][4].x=1300-o.third.toString().length*charSize}if(second!==undefined&&third!==undefined){o.second===o.third?infoGameMsg[line][3].content="=":o.second<o.third?infoGameMsg[line][3].content="<":infoGameMsg[line][3].content=">"}if(o.fourth<=0){infoGameMsg[line][6].content="?";infoGameMsg[line][6].x=1716-1*charSize;infoGameMsg[line][5].content="?"}else{fourth=o.fourth;infoGameMsg[line][6].content=o.fourth.toString();infoGameMsg[line][6].x=1716-o.fourth.toString().length*charSize}if(third!==undefined&&fourth!==undefined){o.third===o.fourth?infoGameMsg[line][5].content="=":o.third<o.fourth?infoGameMsg[line][5].content="<":infoGameMsg[line][5].content=">"}}else if(line===2){let first=undefined,second=undefined,third=undefined,fourth=undefined;if(o.first<0){infoGameMsg[line][0].content="?";infoGameMsg[line][0].x=415-1*charSize;infoGameMsg[line][1].content="?"}else{first=o.first;infoGameMsg[line][0].content=o.first.toString();infoGameMsg[line][0].x=415-o.first.toString().length*charSize}if(o.second<0){infoGameMsg[line][2].content="?";infoGameMsg[line][2].x=864-1*charSize}else{second=o.second;infoGameMsg[line][2].content=o.second.toString();infoGameMsg[line][2].x=864-o.second.toString().length*charSize}if(first!==undefined&&second!==undefined){o.first===o.second?infoGameMsg[line][1].content="=":o.first<o.second?infoGameMsg[line][1].content="<":infoGameMsg[line][1].content=">"}if(o.third<0){infoGameMsg[line][4].content="?";infoGameMsg[line][4].x=1300-1*charSize;infoGameMsg[line][3].content="?";infoGameMsg[line][5].content="?"}else{third=o.third;infoGameMsg[line][4].content=o.third.toString();infoGameMsg[line][4].x=1300-o.third.toString().length*charSize}if(second!==undefined&&third!==undefined){o.second===o.third?infoGameMsg[line][3].content="=":o.second<o.third?infoGameMsg[line][3].content="<":infoGameMsg[line][3].content=">"}if(o.fourth<0){infoGameMsg[line][6].content="?";infoGameMsg[line][6].x=1716-1*charSize;infoGameMsg[line][5].content="?"}else{fourth=o.fourth;infoGameMsg[line][6].content=o.fourth.toString();infoGameMsg[line][6].x=1716-o.fourth.toString().length*charSize}if(third!==undefined&&fourth!==undefined){o.third===o.fourth?infoGameMsg[line][5].content="=":o.third<o.fourth?infoGameMsg[line][5].content="<":infoGameMsg[line][5].content=">"}}}async function quota(){if(navigator.storage&&navigator.storage.estimate){const quota=await navigator.storage.estimate();const percentageUsed=quota.usage/quota.quota*100;const remaining=quota.quota-quota.usage;std.quota=(remaining/1024/1024).toFixed(1)}}quota();const localStorageSpace=()=>{let allString="";for(const key of Object.keys(window.localStorage)){allString+=window.localStorage[key]}return allString?Math.ceil(3+allString.length*16/(8*1024))+" KB":"Empty (0 KB"};console.log("local space = ",localStorageSpace());function updateLines(){obj.first=gameInfoLast.t;obj.second=gameInfo.t;obj.third=gameInfoLast.bt;obj.fourth=estimateKeyboard[scenePlaying-1][levelPlaying-1].csec;fillLine(0,obj);obj.first=gameInfoLast.s;obj.second=gameInfo.s;obj.third=gameInfoLast.bs;obj.fourth=estimateKeyboard[scenePlaying-1][levelPlaying-1].s;fillLine(1,obj);obj.first=gameInfoLast.b;obj.second=gameInfo.b;obj.third=gameInfoLast.bb;obj.fourth=0;fillLine(2,obj)}if(from==="restart"||from==="infoBtn"){updateLines()}else if(from==="end"){gameInfoLast.bt=Math.min(gameInfoLast.bt<=0?Infinity:gameInfoLast.bt,gameInfo.t);gameInfoLast.bs=Math.min(gameInfoLast.bs<=0?Infinity:gameInfoLast.bs,gameInfo.s);gameInfoLast.bb=Math.min(gameInfoLast.bb<=0?Infinity:gameInfoLast.bb,gameInfo.b);updateLines()}}function measureText(font,text){g.canvas.ctx.font=font;return{width:g.canvas.ctx.measureText(text).width,height:g.canvas.ctx.measureText("M").width}}function buildSaveGoup(){dataSave=[];saveImgBorder=g.sprite(g.assets["images/save_img.png"]);saveImgInBorder=g.sprite(g.assets["images/save_img_in.png"]);saveMsg_1=g.text("temp",`30px puzzler`,"black");saveMsg_2=g.text("temp",`30px puzzler`,"black");saveMsg_3=g.text("temp",`30px puzzler`,"black");saveMsg_4=g.text("temp",`30px puzzler`,"black");saveMsg_5=g.text("temp",`30px puzzler`,"black");saveMsg_11=g.text("temp",`30px puzzler`,"black");saveMsg_21=g.text("temp",`30px puzzler`,"black");saveMsg_31=g.text("temp",`30px puzzler`,"black");updateSaveGoup();saveCancelButton=g.button([g.assets["images/save_cancel_512_up.png"],g.assets["images/save_cancel_512_over.png"],g.assets["images/save_cancel_512_up.png"]]);saveCancelButton.x=.25*saveImgInBorder.width-.5*saveCancelButton.width*scaleButton;saveCancelButton.y=saveImgInBorder.height-1.2*saveCancelButton.height*scaleButton-32;saveCancelButton.scaleX=scaleButton;saveCancelButton.scaleY=scaleButton;saveOkButton=g.button([g.assets["images/save_ok_512_up.png"],g.assets["images/save_ok_512_over.png"],g.assets["images/save_ok_512_up.png"]]);saveOkButton.x=.75*saveImgInBorder.width-.5*saveOkButton.width*scaleButton;saveOkButton.y=saveImgInBorder.height-1.2*saveOkButton.height*scaleButton-32;saveOkButton.scaleX=scaleButton;saveOkButton.scaleY=scaleButton;saveOkButton.press=()=>{if(fromSave){dataSave=[];dataSave.push(gameInfo);dataSave.push(stepArray);localStorage.removeItem(`data${scenePlaying}${levelPlaying}`);localStorage.setItem(`data${scenePlaying}${levelPlaying}`,JSON.stringify(dataSave))}else{data=JSON.parse(localStorage.getItem(`data${scenePlaying}${levelPlaying}`));let gInfo=data[0];let sArr=data[1];resetAllParameters(scenePlaying,levelPlaying);gameInfo={...gInfo};stepArray=[...sArr];g.setReplayMode(true);g.setGameInfo(gameInfo);g.setStepArray(stepArray);updateGameInfoMsgs();let i=1,interval=100;intervalId=setInterval(()=>{if(stepArray[i].d==="u")yo.move("up",blocks,yo,walk);else if(stepArray[i].d==="d")yo.move("down",blocks,yo,walk);else if(stepArray[i].d==="r")yo.move("right",blocks,yo,walk);else if(stepArray[i].d==="l")yo.move("left",blocks,yo,walk);i++;if(i===stepArray.length){clearInterval(intervalId);g.setReplayMode(false)}},interval)}g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30)};saveCancelButton.press=()=>{g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height,30)};saveOkCancelGroup=g.group(saveImgInBorder,saveMsg_11,saveMsg_21,saveMsg_31,saveOkButton,saveCancelButton);saveOkCancelGroup.x=g.canvas.width*.5-saveImgInBorder.width*.5;saveOkCancelGroup.y=g.canvas.height;saveOkCancelGroup.layer=50;saveInButton=g.button([g.assets["images/save_512_in_up.png"],g.assets["images/save_512_in_over.png"],g.assets["images/save_512_in_up.png"]]);saveInButton.press=()=>{let msg1,msg2,msg3;fromOpen=false;fromSave=true;g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height*.5-saveImgInBorder.height*.5,30);g.slide(saveGroup,saveGroup.x,-g.canvas.height,30);if(isSaved){msg1="Already saved";msg2="Want to save anyway !";msg3="The last saved game will be lost."}else{msg1="Save !";msg2="First time saved.";msg3="Only one saved game at a time."}updateSaveOkCancelGoup(msg1,msg2,msg3)};saveInButton.x=.25*saveImgBorder.width-.5*saveInButton.width*scaleButton;saveInButton.y=saveImgBorder.height-1.2*saveInButton.height*scaleButton-32;saveInButton.scaleX=scaleButton;saveInButton.scaleY=scaleButton;saveOutButton=g.button([g.assets["images/save_512_out_up.png"],g.assets["images/save_512_out_over.png"],g.assets["images/save_512_out_up.png"]]);saveOutButton.x=.75*saveImgBorder.width-.5*saveOutButton.width*scaleButton;saveOutButton.y=saveImgBorder.height-1.2*saveOutButton.height*scaleButton-32;saveOutButton.scaleX=scaleButton;saveOutButton.scaleY=scaleButton;saveOutButton.press=()=>{let msg1,msg2,msg3;fromOpen=true;fromSave=false;g.slide(saveOkCancelGroup,saveOkCancelGroup.x,g.canvas.height*.5-saveImgInBorder.height*.5,30);g.slide(saveGroup,saveGroup.x,-g.canvas.height,30);if(isSaved){msg1="Load the game !";msg2="Present data will be lost.";msg3="Load anyway !"}else{msg1="Can not open this game !";msg2="Not saved yet.";msg3="Only saved game can be opened."}updateSaveOkCancelGoup(msg1,msg2,msg3)};saveGroup=g.group(saveImgBorder,saveMsg_1,saveMsg_2,saveMsg_3,saveMsg_4,saveMsg_5,saveInButton,saveOutButton);saveGroup.x=g.canvas.width*.5-saveImgBorder.width*.5;saveGroup.y=-g.canvas.height}function updateSaveGoup(msg_1,msg_2,msg_3,msg_4,msg_5){let font=`40px puzzler`;let fontTitle=`60px puzzler`;if(isMobile){font=`40px puzzler`;fontTitle=`50px puzzler`}fromOpen=fromSave=false;dataSave=[];dataSave.push(gameInfo);dataSave.push(stepArray);data=JSON.parse(localStorage.getItem(`data${scenePlaying}${levelPlaying}`));if(!data){isSaved=false;isExit=false;msg_1=`Save the game !`;msg_2=`${sceneMsgDim[scenePlaying-1]} Level:${levelPlaying}`;msg_3=`Time : ${timeToString(gameInfo.t)}`;msg_4=`Steps : ${gameInfo.s}`;msg_5=`Bananas : ${gameInfo.b}`}else{isSaved=true;isExit=true;msg_1=`Open the game !`;msg_2=`${sceneMsgDim[scenePlaying-1]} Level:${levelPlaying}`;msg_3=`Time : ${timeToString(data[0].t)}`;msg_4=`Steps : ${data[0].s}`;msg_5=`Bananas : ${data[0].b}`}saveMsg_1.font=fontTitle;saveMsg_1.content=msg_1;saveMsg_1.width=measureText(fontTitle,msg_1).width;saveMsg_1.height=measureText(fontTitle,msg_1).height;saveMsg_1.x=saveImgBorder.width*.5-.5*saveMsg_1.width;saveMsg_1.y=32;saveMsg_2.font=fontTitle;saveMsg_2.content=msg_2;saveMsg_2.width=measureText(fontTitle,msg_2).width;saveMsg_2.height=measureText(fontTitle,msg_2).height;saveMsg_2.x=saveImgBorder.width*.5-.5*saveMsg_2.width;saveMsg_2.y=saveMsg_1.y+saveMsg_1.height+10;saveMsg_3.content=msg_3;saveMsg_3.font=font;saveMsg_3.width=measureText(font,msg_3).width;saveMsg_3.height=measureText(font,msg_3).height;saveMsg_3.x=saveImgBorder.width*.5-.5*saveMsg_3.width;saveMsg_3.y=saveMsg_2.y+saveMsg_2.height+20;saveMsg_4.content=msg_4;saveMsg_4.font=font;saveMsg_4.width=measureText(font,msg_4).width;saveMsg_4.height=measureText(font,msg_4).height;saveMsg_4.x=saveImgBorder.width*.5-.5*saveMsg_4.width;saveMsg_4.y=saveMsg_3.y+saveMsg_3.height+10;saveMsg_5.content=msg_5;saveMsg_5.font=font;saveMsg_5.width=measureText(font,msg_5).width;saveMsg_5.height=measureText(font,msg_5).height;saveMsg_5.x=saveImgBorder.width*.5-.5*saveMsg_5.width;saveMsg_5.y=saveMsg_4.y+saveMsg_4.height+10}function updateSaveOkCancelGoup(msg_11,msg_21,msg_31){let font=`40px puzzler`;let fontTitle=`60px puzzler`;if(isMobile){font=`40px puzzler`;fontTitle=`50px puzzler`}saveMsg_11.font=fontTitle;saveMsg_11.content=msg_11;saveMsg_11.width=measureText(fontTitle,msg_11).width;saveMsg_11.height=measureText(fontTitle,msg_11).height;saveMsg_11.x=saveImgInBorder.width*.5-.5*saveMsg_11.width;saveMsg_11.y=32;saveMsg_21.font=fontTitle;saveMsg_21.content=msg_21;saveMsg_21.width=measureText(fontTitle,msg_21).width;saveMsg_21.height=measureText(fontTitle,msg_21).height;saveMsg_21.x=saveImgInBorder.width*.5-.5*saveMsg_21.width;saveMsg_21.y=saveMsg_11.y+saveMsg_11.height+10;saveMsg_31.content=msg_31;saveMsg_31.font=font;saveMsg_31.width=measureText(font,msg_31).width;saveMsg_31.height=measureText(font,msg_31).height;saveMsg_31.x=saveImgInBorder.width*.5-.5*saveMsg_31.width;saveMsg_31.y=saveMsg_21.y+saveMsg_21.height+20}async function saveToDisk(what){let deviceInfo={is_M:isMobile,is_T:isTouch,DPI:pixelRatio,WA:window.screen.availWidth,HA:window.screen.availHeight,WW:window.innerWidth,WH:window.innerHeight,DW:document.body.width,DH:document.body.height,S_C:std.scaleCanvas.toFixed(2),S_X:std.scaleX.toFixed(2),S_Y:std.scaleY.toFixed(2),Q:std.quota};let infoScene={scene:scenePlaying,level:levelPlaying};let arrInfo=[];arrInfo.push(deviceInfo,infoScene,gameInfo,stepArray);let name="yo_gameConfig";var tempLink=document.createElement("a");var taBlob=new Blob([JSON.stringify(arrInfo)],{type:"text/plain"});tempLink.setAttribute("href",URL.createObjectURL(taBlob));tempLink.setAttribute("download",`${name.toLowerCase()}.json`);tempLink.click();URL.revokeObjectURL(tempLink.href)}